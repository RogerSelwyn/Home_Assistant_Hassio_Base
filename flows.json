[
    {
        "id": "c8979269.83b0b",
        "type": "tab",
        "label": "Circadian",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2bf27921.c09716",
        "type": "tab",
        "label": "Motion",
        "disabled": false,
        "info": ""
    },
    {
        "id": "83b3d59c.0b8848",
        "type": "tab",
        "label": "Change Scene",
        "disabled": false,
        "info": ""
    },
    {
        "id": "e3330cd1.4ad86",
        "type": "tab",
        "label": "SHM",
        "disabled": false,
        "info": ""
    },
    {
        "id": "44e40327.1945ec",
        "type": "tab",
        "label": "Burglar Deterent",
        "disabled": false,
        "info": ""
    },
    {
        "id": "cee05142.c172e8",
        "type": "tab",
        "label": "Error Checking",
        "disabled": false,
        "info": ""
    },
    {
        "id": "26d43138.aa613e",
        "type": "tab",
        "label": "Scheduled",
        "disabled": false,
        "info": ""
    },
    {
        "id": "a2c447a7.7afa68",
        "type": "tab",
        "label": "Ty'r Celyn",
        "disabled": false,
        "info": ""
    },
    {
        "id": "9573fbce.d39958",
        "type": "tab",
        "label": "Logging",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8aaceb10.8ee3e8",
        "type": "tab",
        "label": "Room Occupied",
        "disabled": false,
        "info": ""
    },
    {
        "id": "b56c7f40.a7397",
        "type": "tab",
        "label": "Testing",
        "disabled": false,
        "info": ""
    },
    {
        "id": "36119e75.6c6b12",
        "type": "tab",
        "label": "Hoobs",
        "disabled": false,
        "info": ""
    },
    {
        "id": "2fe83df2.a5c022",
        "type": "subflow",
        "name": "Calculate Kelvin",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 160,
                "wires": [
                    {
                        "id": "9513af06.7f2cd"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1000,
                "y": 160,
                "wires": [
                    {
                        "id": "efcdbb4e.f4e398",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "602c86d0.6ad158",
        "type": "subflow",
        "name": "Presence",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 40,
                "y": 180,
                "wires": [
                    {
                        "id": "483f7ed9.a2362"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 480,
                "y": 180,
                "wires": [
                    {
                        "id": "c16a1b79.52a2a8",
                        "port": 0
                    },
                    {
                        "id": "81cbf332.c942e",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [
            {
                "name": "Room",
                "type": "str",
                "value": ""
            }
        ],
        "color": "#DDAA99"
    },
    {
        "id": "fa60cf0f.5a04b",
        "type": "subflow",
        "name": "Calculate Lux",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 140,
                "y": 180,
                "wires": [
                    {
                        "id": "50406a63.e21e54"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1480,
                "y": 200,
                "wires": [
                    {
                        "id": "36f70cd7.7c6cb4",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "479a43cf.fb458c",
        "type": "subflow",
        "name": "Get Lights",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 120,
                "wires": [
                    {
                        "id": "949032a8.dfc58"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 480,
                "y": 160,
                "wires": [
                    {
                        "id": "2466f954.9a3c66",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "e6937ad1.654d78",
        "type": "subflow",
        "name": "Re-Ping",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 100,
                "y": 140,
                "wires": [
                    {
                        "id": "7411b773.1a2ba8"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 1900,
                "y": 160,
                "wires": [
                    {
                        "id": "b210a724.abd928",
                        "port": 1
                    }
                ]
            },
            {
                "x": 540,
                "y": 320,
                "wires": [
                    {
                        "id": "2bfaad9b.5fcf52",
                        "port": 0
                    }
                ]
            },
            {
                "x": 200,
                "y": 380,
                "wires": [
                    {
                        "id": "22d03c08.128234",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "d49e449c.037e18",
        "type": "subflow",
        "name": "Get Addons",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 60,
                "y": 80,
                "wires": [
                    {
                        "id": "2bd2eeae.bf9542"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 740,
                "y": 80,
                "wires": [
                    {
                        "id": "a737ff94.d8db6",
                        "port": 0
                    }
                ]
            }
        ],
        "env": [],
        "color": "#DDAA99"
    },
    {
        "id": "86fae200.61af7",
        "type": "server",
        "name": "Home Assistant",
        "legacy": false,
        "addon": true,
        "rejectUnauthorizedCerts": true,
        "ha_boolean": "y|yes|true|on|home|open",
        "connectionDelay": true,
        "cacheJson": true
    },
    {
        "id": "9e34fd70.f10fc",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "a502fb56.a9f708",
        "type": "mqtt-broker",
        "name": "sfhassio",
        "broker": "localhost",
        "port": "1883",
        "tls": "56af0000.4f707",
        "clientid": "nodered",
        "usetls": false,
        "compatmode": false,
        "keepalive": "60",
        "cleansession": true,
        "birthTopic": "",
        "birthQos": "0",
        "birthRetain": "false",
        "birthPayload": "",
        "closeTopic": "",
        "closeQos": "0",
        "closeRetain": "false",
        "closePayload": "",
        "willTopic": "",
        "willQos": "0",
        "willRetain": "false",
        "willPayload": ""
    },
    {
        "id": "56af0000.4f707",
        "type": "tls-config",
        "name": "Hassio",
        "cert": "/ssl/fullchain.pem",
        "key": "/ssl/privkey.pem",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "www.selwyn.org.uk",
        "verifyservercert": true
    },
    {
        "id": "2ff2a476.a6d2ec",
        "type": "influxdb",
        "hostname": "127.0.0.1",
        "port": "8086",
        "protocol": "http",
        "database": "database",
        "name": "Node Red OVO",
        "usetls": false,
        "tls": "d50d0c9f.31e858",
        "influxdbVersion": "2.0",
        "url": "http://192.168.1.41:8086",
        "rejectUnauthorized": false
    },
    {
        "id": "d50d0c9f.31e858",
        "type": "tls-config",
        "name": "",
        "cert": "",
        "key": "",
        "ca": "",
        "certname": "",
        "keyname": "",
        "caname": "",
        "servername": "",
        "verifyservercert": false
    },
    {
        "id": "20ca47a2.e52b48",
        "type": "position-config",
        "name": "Home",
        "isValide": "true",
        "longitude": "0",
        "latitude": "0",
        "angleType": "deg",
        "timeZoneOffset": "99",
        "timeZoneDST": "0",
        "stateTimeFormat": "3",
        "stateDateFormat": "12"
    },
    {
        "id": "cdd8d968.81afd8",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "8a0782a1.61a5b",
        "type": "ui_group",
        "name": "Default",
        "tab": "cdd8d968.81afd8",
        "order": 1,
        "disp": true,
        "width": "6",
        "collapse": false
    },
    {
        "id": "49788836.7e7558",
        "type": "change",
        "z": "479a43cf.fb458c",
        "name": "Power Entities",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "item.power.data.attributes.entity_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 80,
        "wires": [
            [
                "3ef84602.b91f5a"
            ]
        ]
    },
    {
        "id": "3ef84602.b91f5a",
        "type": "split",
        "z": "479a43cf.fb458c",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 690,
        "y": 80,
        "wires": [
            [
                "949032a8.dfc58"
            ]
        ]
    },
    {
        "id": "949032a8.dfc58",
        "type": "switch",
        "z": "479a43cf.fb458c",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "regex",
                "v": "^group\\S*$",
                "vt": "str",
                "case": false
            },
            {
                "t": "regex",
                "v": "^light\\S*$",
                "vt": "str",
                "case": false
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 190,
        "y": 120,
        "wires": [
            [
                "3e709c6c.b3f724"
            ],
            [
                "2466f954.9a3c66"
            ],
            []
        ]
    },
    {
        "id": "3e709c6c.b3f724",
        "type": "api-current-state",
        "z": "479a43cf.fb458c",
        "name": "Enity Info",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{payload}}",
        "state_type": "str",
        "state_location": "item.power.state",
        "override_payload": "msg",
        "entity_location": "item.power.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 80,
        "wires": [
            [
                "49788836.7e7558"
            ]
        ]
    },
    {
        "id": "783b7716.8f27f8",
        "type": "change",
        "z": "2fe83df2.a5c022",
        "name": "Workday",
        "rules": [
            {
                "t": "set",
                "p": "item.planned.min",
                "pt": "msg",
                "to": "item.boolean.attributes.workday_min_kelvin",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "item.planned.max",
                "pt": "msg",
                "to": "item.boolean.attributes.workday_max_kelvin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 120,
        "wires": [
            [
                "e2010c89.4906f"
            ]
        ]
    },
    {
        "id": "2cdc1c60.2f1574",
        "type": "switch",
        "z": "2fe83df2.a5c022",
        "name": "Values ?",
        "property": "item.boolean.attributes.workday_min_kelvin",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 360,
        "y": 120,
        "wires": [
            [
                "783b7716.8f27f8"
            ],
            [
                "8a48c7bd.d4c448"
            ]
        ]
    },
    {
        "id": "8a48c7bd.d4c448",
        "type": "change",
        "z": "2fe83df2.a5c022",
        "name": "Other",
        "rules": [
            {
                "t": "set",
                "p": "item.light.min_kelvin",
                "pt": "msg",
                "to": "$round(1000000 / item.light.data.attributes.max_mireds)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.light.max_kelvin",
                "pt": "msg",
                "to": "$round(1000000 / item.light.data.attributes.min_mireds)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.min",
                "pt": "msg",
                "to": "item.boolean.attributes.min_kelvin ? item.boolean.attributes.min_kelvin : item.light.min_kelvin",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.max",
                "pt": "msg",
                "to": "item.boolean.attributes.max_kelvin? item.boolean.attributes.max_kelvin : item.light.max_kelvin",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 200,
        "wires": [
            [
                "e2010c89.4906f"
            ]
        ]
    },
    {
        "id": "e2010c89.4906f",
        "type": "change",
        "z": "2fe83df2.a5c022",
        "name": "Set data SF",
        "rules": [
            {
                "t": "set",
                "p": "item.planned.target",
                "pt": "msg",
                "to": "circadian.kelvin",
                "tot": "global"
            },
            {
                "t": "set",
                "p": "item.planned.data.kelvin",
                "pt": "msg",
                "to": "item.planned.target < item.planned.min ? item.planned.min : item.planned.target",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.data.kelvin",
                "pt": "msg",
                "to": "$round(item.planned.data.kelvin> item.planned.max ? item.planned.max : item.planned.data.kelvin, -1)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.light.current_kelvin",
                "pt": "msg",
                "to": "$round(1000000 / item.light.data.attributes.color_temp)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.minchange",
                "pt": "msg",
                "to": "$round(item.planned.data.kelvin-(1000000/((1000000/item.planned.data.kelvin)+1)))",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.change",
                "pt": "msg",
                "to": "$round(item.planned.data.kelvin - item.light.current_kelvin)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.current",
                "pt": "msg",
                "to": "item.light.current_kelvin",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 160,
        "wires": [
            [
                "efcdbb4e.f4e398"
            ]
        ]
    },
    {
        "id": "72121635.45c018",
        "type": "comment",
        "z": "2fe83df2.a5c022",
        "name": "Is it during the working day ?",
        "info": "",
        "x": 180,
        "y": 100,
        "wires": []
    },
    {
        "id": "3e83175d.e208c8",
        "type": "comment",
        "z": "2fe83df2.a5c022",
        "name": "Calculate colour target",
        "info": "",
        "x": 720,
        "y": 120,
        "wires": []
    },
    {
        "id": "483f7ed9.a2362",
        "type": "switch",
        "z": "602c86d0.6ad158",
        "name": "",
        "property": "Room",
        "propertyType": "env",
        "rules": [
            {
                "t": "eq",
                "v": "office",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "livingroom",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 150,
        "y": 180,
        "wires": [
            [
                "c16a1b79.52a2a8"
            ],
            [
                "81cbf332.c942e"
            ],
            []
        ]
    },
    {
        "id": "c16a1b79.52a2a8",
        "type": "change",
        "z": "602c86d0.6ad158",
        "name": "Office",
        "rules": [
            {
                "t": "set",
                "p": "presence",
                "pt": "msg",
                "to": "office_presence",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "14a8e51c.8d632b",
        "type": "switch",
        "z": "fa60cf0f.5a04b",
        "name": "In range ?",
        "property": "item.lux.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lt",
                "v": "$number(item.target_lux)*0.9",
                "vt": "jsonata"
            },
            {
                "t": "gt",
                "v": "$number(item.target_lux)*1.1",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1060,
        "y": 200,
        "wires": [
            [
                "490676e9.4fe2f8"
            ],
            [
                "490676e9.4fe2f8"
            ],
            []
        ]
    },
    {
        "id": "490676e9.4fe2f8",
        "type": "change",
        "z": "fa60cf0f.5a04b",
        "name": "Adjust",
        "rules": [
            {
                "t": "set",
                "p": "item.planned.change",
                "pt": "msg",
                "to": "($number(item.target_lux) - $number(item.lux.state))*6",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1210,
        "y": 200,
        "wires": [
            [
                "36f70cd7.7c6cb4"
            ]
        ]
    },
    {
        "id": "36f70cd7.7c6cb4",
        "type": "change",
        "z": "fa60cf0f.5a04b",
        "name": "Set Data",
        "rules": [
            {
                "t": "set",
                "p": "item.light.brightness",
                "pt": "msg",
                "to": "item.light.data.attributes.brightness ? item.light.data.attributes.brightness : 0",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.target",
                "pt": "msg",
                "to": "item.light.brightness + item.planned.change",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.target",
                "pt": "msg",
                "to": "item.planned.target > 255 ? 255 : item.planned.target",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.target",
                "pt": "msg",
                "to": "item.planned.target < 0 ? 0 : item.planned.target",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.planned.data.brightness",
                "pt": "msg",
                "to": "item.planned.target",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1360,
        "y": 200,
        "wires": [
            []
        ]
    },
    {
        "id": "9f4dd3c1.d9de4",
        "type": "change",
        "z": "fa60cf0f.5a04b",
        "name": "Day",
        "rules": [
            {
                "t": "set",
                "p": "item.target_lux",
                "pt": "msg",
                "to": "item.boolean.attributes.day_lux",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 160,
        "wires": [
            [
                "14a8e51c.8d632b"
            ]
        ]
    },
    {
        "id": "3df76d29.5dd612",
        "type": "change",
        "z": "fa60cf0f.5a04b",
        "name": "Early Evening",
        "rules": [
            {
                "t": "set",
                "p": "item.target_lux",
                "pt": "msg",
                "to": "item.boolean.attributes.evening_lux",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 240,
        "wires": [
            [
                "14a8e51c.8d632b"
            ]
        ]
    },
    {
        "id": "81cbf332.c942e",
        "type": "change",
        "z": "602c86d0.6ad158",
        "name": "Living Room",
        "rules": [
            {
                "t": "set",
                "p": "presence",
                "pt": "msg",
                "to": "livingroom_presence",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 310,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "2a518deb.6c98c2",
        "type": "comment",
        "z": "602c86d0.6ad158",
        "name": "Check Presence",
        "info": "",
        "x": 100,
        "y": 80,
        "wires": []
    },
    {
        "id": "2466f954.9a3c66",
        "type": "api-current-state",
        "z": "479a43cf.fb458c",
        "name": "Light Info",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{payload}}",
        "state_type": "str",
        "state_location": "item.light.state",
        "override_payload": "msg",
        "entity_location": "item.light.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 340,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "9513af06.7f2cd",
        "type": "api-current-state",
        "z": "2fe83df2.a5c022",
        "name": "Workday",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.work_day",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 200,
        "y": 160,
        "wires": [
            [
                "2cdc1c60.2f1574"
            ],
            [
                "8a48c7bd.d4c448"
            ]
        ]
    },
    {
        "id": "598557cf.4d7508",
        "type": "api-current-state",
        "z": "fa60cf0f.5a04b",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "item.location.state",
        "override_payload": "msg",
        "entity_location": "item.location.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 460,
        "y": 220,
        "wires": [
            [
                "f03aa0e3.0c71e"
            ]
        ]
    },
    {
        "id": "3db3aeca.2572b2",
        "type": "change",
        "z": "fa60cf0f.5a04b",
        "name": "Late evening/Night",
        "rules": [
            {
                "t": "set",
                "p": "item.target_lux",
                "pt": "msg",
                "to": "item.boolean.attributes.night_lux",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 200,
        "wires": [
            [
                "14a8e51c.8d632b"
            ]
        ]
    },
    {
        "id": "f03aa0e3.0c71e",
        "type": "switch",
        "z": "fa60cf0f.5a04b",
        "name": "Evening/Night",
        "property": "item.location.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Evening",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Night",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 660,
        "y": 220,
        "wires": [
            [
                "3db3aeca.2572b2"
            ],
            [
                "3db3aeca.2572b2"
            ],
            [
                "3df76d29.5dd612"
            ]
        ]
    },
    {
        "id": "50406a63.e21e54",
        "type": "within-time-switch",
        "z": "fa60cf0f.5a04b",
        "name": "",
        "nameInt": "",
        "positionConfig": "20ca47a2.e52b48",
        "startTime": "08:00",
        "startTimeType": "entered",
        "startOffset": 0,
        "startOffsetType": "none",
        "startOffsetMultiplier": 60000,
        "endTime": "17:30",
        "endTimeType": "entered",
        "endOffset": 0,
        "endOffsetType": "none",
        "endOffsetMultiplier": 60000,
        "timeDays": "*",
        "timeOnlyOddDays": false,
        "timeOnlyEvenDays": false,
        "timeMonths": "*",
        "timedatestart": "",
        "timedateend": "",
        "propertyStart": "",
        "propertyStartType": "none",
        "propertyStartCompare": "true",
        "propertyStartThreshold": "",
        "propertyStartThresholdType": "num",
        "startTimeAlt": "",
        "startTimeAltType": "entered",
        "startOffsetAlt": 0,
        "startOffsetAltType": "none",
        "startOffsetAltMultiplier": 60000,
        "propertyEnd": "",
        "propertyEndType": "none",
        "propertyEndCompare": "true",
        "propertyEndThreshold": "",
        "propertyEndThresholdType": "num",
        "endTimeAlt": "",
        "endTimeAltType": "entered",
        "endOffsetAlt": 0,
        "endOffsetAltType": "none",
        "endOffsetAltMultiplier": 60000,
        "tsCompare": "0",
        "x": 270,
        "y": 180,
        "wires": [
            [
                "9f4dd3c1.d9de4"
            ],
            [
                "598557cf.4d7508"
            ]
        ]
    },
    {
        "id": "efcdbb4e.f4e398",
        "type": "switch",
        "z": "2fe83df2.a5c022",
        "name": "Changed ?",
        "property": "$abs(item.planned.change)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "gt",
                "v": "item.planned.minchange",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 870,
        "y": 160,
        "wires": [
            [],
            []
        ]
    },
    {
        "id": "c26a763b.362d58",
        "type": "switch",
        "z": "e6937ad1.654d78",
        "name": "Failed",
        "property": "flow.response",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 140,
        "wires": [
            [
                "593f0b8.5c880f4"
            ],
            [
                "24a089a6.5a7b36"
            ]
        ]
    },
    {
        "id": "2bfaad9b.5fcf52",
        "type": "delay",
        "z": "e6937ad1.654d78",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 410,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "a589119e.02b81",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Host",
        "rules": [
            {
                "t": "set",
                "p": "host",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 140,
        "wires": [
            [
                "b2e0e226.46829"
            ]
        ]
    },
    {
        "id": "bf364681.1fb8b8",
        "type": "adv ping",
        "z": "e6937ad1.654d78",
        "name": "Re-ping",
        "host": "",
        "x": 1340,
        "y": 140,
        "wires": [
            [
                "f2b200af.d6c65",
                "638fbe40.82f78"
            ]
        ]
    },
    {
        "id": "f2b200af.d6c65",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Restore",
        "rules": [
            {
                "t": "set",
                "p": "flow.re_ping_response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "host",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "ping",
                "pt": "global",
                "to": " {\"re_ping\" : $merge ([ $lookup($globalContext('ping'), \"re_ping\") ,  {flow.component: \"False\"}])}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1500,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "638fbe40.82f78",
        "type": "switch",
        "z": "e6937ad1.654d78",
        "name": "Failed",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1650,
        "y": 140,
        "wires": [
            [
                "b210a724.abd928"
            ],
            [
                "af0eb4ad.ef1348",
                "f78a4a2d.3f59b8"
            ]
        ]
    },
    {
        "id": "593f0b8.5c880f4",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Downtime",
        "rules": [
            {
                "t": "set",
                "p": "flow.downtime",
                "pt": "msg",
                "to": "$now()",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "ping",
                "pt": "global",
                "to": " {\"re_ping\" : $merge ([ $lookup($globalContext('ping'), \"re_ping\") ,  {flow.component: \"True\"}])}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 140,
        "wires": [
            [
                "a589119e.02b81",
                "f79f0933.ef1838"
            ]
        ]
    },
    {
        "id": "c952a3d3.d4597",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Uptime",
        "rules": [
            {
                "t": "set",
                "p": "flow.uptime",
                "pt": "msg",
                "to": "$now()",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 240,
        "y": 320,
        "wires": [
            [
                "2bfaad9b.5fcf52"
            ]
        ]
    },
    {
        "id": "e2c1c1e0.a515",
        "type": "sun-position",
        "z": "c8979269.83b0b",
        "name": "",
        "positionConfig": "20ca47a2.e52b48",
        "rules": [],
        "onlyOnChange": "true",
        "topic": "",
        "outputs": 1,
        "start": "",
        "startType": "none",
        "startOffset": 0,
        "startOffsetType": "none",
        "startOffsetMultiplier": 60000,
        "end": "",
        "endType": "none",
        "endOffset": 0,
        "endOffsetType": "none",
        "endOffsetMultiplier": 60000,
        "x": 330,
        "y": 100,
        "wires": [
            [
                "4445625c.8b249c"
            ]
        ]
    },
    {
        "id": "c43c4f9a.5c93f",
        "type": "comment",
        "z": "c8979269.83b0b",
        "name": "Circadian Kelvin/RGB/Mired",
        "info": "",
        "x": 200,
        "y": 40,
        "wires": []
    },
    {
        "id": "4a229ada.73ed34",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "1 minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": true,
        "onceDelay": ".1",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 100,
        "wires": [
            [
                "e2c1c1e0.a515"
            ]
        ]
    },
    {
        "id": "2380795c.1a5586",
        "type": "range",
        "z": "c8979269.83b0b",
        "minin": "0",
        "maxin": "100",
        "minout": "2200",
        "maxout": "6500",
        "action": "clamp",
        "round": true,
        "property": "circadian.kelvin",
        "name": "% to Kelvin",
        "x": 690,
        "y": 100,
        "wires": [
            [
                "b7226b34.f17ce8"
            ]
        ]
    },
    {
        "id": "4445625c.8b249c",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Store Kelvin",
        "rules": [
            {
                "t": "set",
                "p": "circadian.kelvin",
                "pt": "msg",
                "to": "payload.altitudePercent",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 510,
        "y": 100,
        "wires": [
            [
                "2380795c.1a5586"
            ]
        ]
    },
    {
        "id": "b7226b34.f17ce8",
        "type": "function",
        "z": "c8979269.83b0b",
        "name": "Kelvin to RGB",
        "func": "// these functions were converted from Home Assistant's python version of it.\n// https://github.com/home-assistant/home-assistant/blob/05ecc5a1355c7af11b5d310470a6171528dc7a2b/homeassistant/util/color.py\n\nvar color_temperature_to_rgb = function(color_temperature_kelvin) {\n    /*\n    Return an RGB color from a color temperature in Kelvin.\n    This is a rough approximation based on the formula provided by T. Helland\n    http://www.tannerhelland.com/4435/convert-temperature-rgb-algorithm-code/\n    */\n    // range check\n    if(color_temperature_kelvin < 1000) {\n        color_temperature_kelvin = 1000;\n    } else if(color_temperature_kelvin > 40000) {\n        color_temperature_kelvin = 40000;\n    }\n\n    tmp_internal = color_temperature_kelvin / 100.0;\n\n    red = _get_red(tmp_internal);\n    green = _get_green(tmp_internal);\n    blue = _get_blue(tmp_internal);\n\n    return [red, green, blue];\n};\n\nvar _get_red = function(temperature) {\n    // Get the red component of the temperature in RGB space.\n    if(temperature <= 66){\n        return 255;\n    }\n    tmp_red = 329.698727446 * Math.pow(temperature - 60, -0.1332047592);\n    return _bound(tmp_red);\n}\n\nvar _get_green = function(temperature) {\n    // Get the green component of the given color temp in RGB space.\n    if(temperature <= 66){\n        green = 99.4708025861 * Math.log(temperature) - 161.1195681661;\n    } else {\n        green = 288.1221695283 * Math.pow(temperature - 60, -0.0755148492);\n    }\n    return _bound(green);\n}\n\nvar _get_blue = function(temperature) {\n    // Get the blue component of the given color temperature in RGB space.\n    if(temperature >= 66){\n        return 255;\n    } else if(temperature <= 19){\n        return 0;\n    }\n    blue = 138.5177312231 * Math.log(temperature - 10) - 305.0447927307;\n    return _bound(blue);\n}\n\nvar _bound = function(color_component, minimum=0, maximum=255) {\n    /*\n    Bound the given color component value between the given min and max values.\n    The minimum and maximum values will be included in the valid output.\n    i.e. Given a color_component of 0 and a minimum of 10, the returned value\n    will be 10.\n    */\n    color_component_out = Math.max(color_component, minimum);\n    return Math.min(color_component_out, maximum);\n}\n\nmsg.circadian.rgb = color_temperature_to_rgb(msg.circadian.kelvin);\nmsg.circadian.mired = Math.floor(1000000/msg.circadian.kelvin)\n\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 880,
        "y": 100,
        "wires": [
            [
                "1d8bcf67.1360b1"
            ]
        ]
    },
    {
        "id": "1d8bcf67.1360b1",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Store Global",
        "rules": [
            {
                "t": "set",
                "p": "circadian.kelvin",
                "pt": "global",
                "to": "circadian.kelvin",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "circadian.rgb",
                "pt": "global",
                "to": "circadian.rgb",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "circadian.mired",
                "pt": "global",
                "to": "circadian.mired",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1070,
        "y": 100,
        "wires": [
            [
                "2d31ea76.fdeea6"
            ]
        ]
    },
    {
        "id": "bf7122.37b34ee",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "5 minute",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "300",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 480,
        "wires": [
            [
                "dad2f7cf.4a59c8"
            ]
        ]
    },
    {
        "id": "e97b3814.629328",
        "type": "api-call-service",
        "z": "c8979269.83b0b",
        "name": "Change Colour",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 800,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "dad2f7cf.4a59c8",
        "type": "ha-get-entities",
        "z": "c8979269.83b0b",
        "server": "86fae200.61af7",
        "name": "Circadian Lights",
        "rules": [
            {
                "property": "attributes.circadian",
                "logic": "is",
                "value": "true",
                "valueType": "bool"
            },
            {
                "property": "state",
                "logic": "is",
                "value": "on",
                "valueType": "str"
            },
            {
                "property": "attributes.adjustable_colour",
                "logic": "is",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 340,
        "y": 480,
        "wires": [
            [
                "c944d5cc.a979e8"
            ]
        ]
    },
    {
        "id": "c944d5cc.a979e8",
        "type": "split",
        "z": "c8979269.83b0b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 510,
        "y": 480,
        "wires": [
            [
                "27eacc85.723684"
            ]
        ]
    },
    {
        "id": "27eacc85.723684",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Stash",
        "rules": [
            {
                "t": "set",
                "p": "item.boolean",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "item.boolean.attributes.light_entity_id",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 650,
        "y": 480,
        "wires": [
            [
                "ff55ee70.b26aa"
            ]
        ]
    },
    {
        "id": "a2ec40fc.ca27c",
        "type": "api-current-state",
        "z": "c8979269.83b0b",
        "name": "Still On ?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{item.planned.data.entity_id}}",
        "state_type": "str",
        "state_location": "item.power.state",
        "override_payload": "msg",
        "entity_location": "item.power.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 460,
        "y": 580,
        "wires": [
            [
                "174e6a47.61eae6"
            ],
            []
        ]
    },
    {
        "id": "174e6a47.61eae6",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Set data",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "item.planned",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 580,
        "wires": [
            [
                "e97b3814.629328",
                "95d14639.d2ecf8"
            ]
        ]
    },
    {
        "id": "c015319e.3d5ac",
        "type": "server-state-changed",
        "z": "c8979269.83b0b",
        "name": "Light on",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "^group\\S*actual$",
        "entityidfiltertype": "regex",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 160,
        "y": 420,
        "wires": [
            [
                "dad2f7cf.4a59c8"
            ],
            []
        ]
    },
    {
        "id": "2168d857.c1c2a8",
        "type": "comment",
        "z": "c8979269.83b0b",
        "name": "Adjust colour throughout the day",
        "info": "",
        "x": 190,
        "y": 380,
        "wires": []
    },
    {
        "id": "50570a93.b36604",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "Workday Start",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "45 08 * * 1,2,3,4,5",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 220,
        "wires": [
            [
                "485a525e.5e85dc"
            ]
        ]
    },
    {
        "id": "485a525e.5e85dc",
        "type": "api-call-service",
        "z": "c8979269.83b0b",
        "name": "On",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.work_day",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "b76c0fe3.8a03b",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "Workday End",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 17 * * 1,2,3,4,5",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 280,
        "wires": [
            [
                "1b3d6895.fe6047"
            ]
        ]
    },
    {
        "id": "1b3d6895.fe6047",
        "type": "api-call-service",
        "z": "c8979269.83b0b",
        "name": "Off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.work_day",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "41955298.75169c",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Set data",
        "rules": [
            {
                "t": "set",
                "p": "item.planned.data.entity_id",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1320,
        "y": 480,
        "wires": [
            [
                "e1798221.50681"
            ]
        ]
    },
    {
        "id": "e1798221.50681",
        "type": "link out",
        "z": "c8979269.83b0b",
        "name": "B1",
        "links": [
            "aa05c4da.306498"
        ],
        "x": 1470,
        "y": 480,
        "wires": [],
        "l": true
    },
    {
        "id": "aa05c4da.306498",
        "type": "link in",
        "z": "c8979269.83b0b",
        "name": "B2",
        "links": [
            "e1798221.50681"
        ],
        "x": 170,
        "y": 580,
        "wires": [
            [
                "caef03db.8851c"
            ]
        ],
        "l": true
    },
    {
        "id": "caef03db.8851c",
        "type": "simple-queue",
        "z": "c8979269.83b0b",
        "name": "Queue",
        "firstMessageBypass": false,
        "bypassInterval": "2000",
        "x": 310,
        "y": 580,
        "wires": [
            [
                "a2ec40fc.ca27c"
            ]
        ]
    },
    {
        "id": "2d31ea76.fdeea6",
        "type": "api-call-service",
        "z": "c8979269.83b0b",
        "name": "Kelvin",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_number",
        "service": "set_value",
        "entityId": "input_number.circadian_kelvin",
        "data": "{\"value\": circadian.kelvin}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1230,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "fa4feed3.5e55e",
        "type": "comment",
        "z": "c8979269.83b0b",
        "name": "Adjust lux throughout the day",
        "info": "",
        "x": 140,
        "y": 720,
        "wires": []
    },
    {
        "id": "7efb4b86.a1bd44",
        "type": "server-state-changed",
        "z": "c8979269.83b0b",
        "name": "Kelvin Change",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_number.circadian_kelvin",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 140,
        "y": 520,
        "wires": [
            [
                "dad2f7cf.4a59c8"
            ]
        ]
    },
    {
        "id": "757eb93b.cfee08",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Set Data",
        "rules": [
            {
                "t": "set",
                "p": "item.planned.data.entity_id",
                "pt": "msg",
                "to": "item.light.data.entity_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "item.planned",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "item.last",
                "pt": "msg",
                "to": "$lookup($flowContext(\"lights.last\"),item.planned.data.entity_id)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1220,
        "y": 1100,
        "wires": [
            [
                "c1d8b188.31db6"
            ]
        ]
    },
    {
        "id": "1ba936f2.b03689",
        "type": "api-call-service",
        "z": "c8979269.83b0b",
        "name": "Change Lux",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1730,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "f142c3cf.f34d5",
        "type": "subflow:2fe83df2.a5c022",
        "z": "c8979269.83b0b",
        "name": "",
        "env": [],
        "x": 1140,
        "y": 480,
        "wires": [
            [
                "41955298.75169c"
            ]
        ]
    },
    {
        "id": "8ac62d4e.10201",
        "type": "subflow:fa60cf0f.5a04b",
        "z": "c8979269.83b0b",
        "name": "",
        "env": [],
        "x": 500,
        "y": 1060,
        "wires": [
            [
                "a01e88c4.868f78"
            ]
        ]
    },
    {
        "id": "4c98c1f.225034",
        "type": "subflow:2fe83df2.a5c022",
        "z": "c8979269.83b0b",
        "name": "",
        "env": [],
        "x": 1040,
        "y": 1060,
        "wires": [
            [
                "757eb93b.cfee08"
            ]
        ]
    },
    {
        "id": "abe2764.c4cea88",
        "type": "link out",
        "z": "c8979269.83b0b",
        "name": "D1",
        "links": [
            "5d340dfe.f410c4"
        ],
        "x": 1450,
        "y": 917,
        "wires": [],
        "l": true
    },
    {
        "id": "5d340dfe.f410c4",
        "type": "link in",
        "z": "c8979269.83b0b",
        "name": "D2",
        "links": [
            "abe2764.c4cea88"
        ],
        "x": 150,
        "y": 1100,
        "wires": [
            [
                "18d7566e.bde73a"
            ]
        ],
        "l": true
    },
    {
        "id": "ff55ee70.b26aa",
        "type": "subflow:479a43cf.fb458c",
        "z": "c8979269.83b0b",
        "x": 810,
        "y": 480,
        "wires": [
            [
                "c7c02aef.e3b5e8"
            ]
        ]
    },
    {
        "id": "8f84c276.af4dc",
        "type": "comment",
        "z": "c8979269.83b0b",
        "name": "Workday calculation",
        "info": "",
        "x": 150,
        "y": 180,
        "wires": []
    },
    {
        "id": "85d70b17.598be8",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 760,
        "wires": [
            [
                "7ea74f85.732d"
            ]
        ]
    },
    {
        "id": "7ea74f85.732d",
        "type": "ha-get-entities",
        "z": "c8979269.83b0b",
        "server": "86fae200.61af7",
        "name": "Circadian Lights",
        "rules": [
            {
                "property": "attributes.circadian",
                "logic": "is",
                "value": "true",
                "valueType": "bool"
            },
            {
                "property": "state",
                "logic": "is",
                "value": "on",
                "valueType": "str"
            },
            {
                "property": "attributes.adjustable_lux",
                "logic": "is",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 320,
        "y": 917,
        "wires": [
            [
                "fa05c136.7fcff"
            ]
        ]
    },
    {
        "id": "2834b73f.505a18",
        "type": "server-state-changed",
        "z": "c8979269.83b0b",
        "name": "Lux Change",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.zwave_office_fibaro_illuminance",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 130,
        "y": 917,
        "wires": [
            [
                "7ea74f85.732d"
            ]
        ]
    },
    {
        "id": "fa05c136.7fcff",
        "type": "split",
        "z": "c8979269.83b0b",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 490,
        "y": 917,
        "wires": [
            [
                "233e12a1.9b96de"
            ]
        ]
    },
    {
        "id": "233e12a1.9b96de",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Stash",
        "rules": [
            {
                "t": "set",
                "p": "item.boolean",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "item.boolean.attributes.light_entity_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 917,
        "wires": [
            [
                "5901fd01.1b8204"
            ]
        ]
    },
    {
        "id": "5901fd01.1b8204",
        "type": "subflow:479a43cf.fb458c",
        "z": "c8979269.83b0b",
        "x": 830,
        "y": 917,
        "wires": [
            [
                "3a7ac830.99e4a8"
            ]
        ]
    },
    {
        "id": "8420f0a2.aa3bd",
        "type": "api-current-state",
        "z": "c8979269.83b0b",
        "name": "Lux",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{item.boolean.attributes.lux_entity_id}}",
        "state_type": "str",
        "state_location": "item.lux.state",
        "override_payload": "msg",
        "entity_location": "item.lux.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1310,
        "y": 917,
        "wires": [
            [
                "abe2764.c4cea88"
            ]
        ]
    },
    {
        "id": "a91c45f6.25e148",
        "type": "link in",
        "z": "c8979269.83b0b",
        "name": "Power on light",
        "links": [
            "68eb30b0.aad51",
            "6bb20e6.f161ff"
        ],
        "x": 130,
        "y": 977,
        "wires": [
            [
                "220e5918.3f58c6"
            ]
        ],
        "l": true
    },
    {
        "id": "c7c02aef.e3b5e8",
        "type": "switch",
        "z": "c8979269.83b0b",
        "name": "On ?",
        "property": "item.light.data.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 970,
        "y": 480,
        "wires": [
            [
                "f142c3cf.f34d5"
            ],
            []
        ]
    },
    {
        "id": "dea45e02.e92cf",
        "type": "api-current-state",
        "z": "c8979269.83b0b",
        "name": "Occupied ?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{item.boolean.attributes.occupancy_entity_id}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1150,
        "y": 917,
        "wires": [
            [
                "8420f0a2.aa3bd"
            ],
            []
        ]
    },
    {
        "id": "3a7ac830.99e4a8",
        "type": "api-current-state",
        "z": "c8979269.83b0b",
        "name": "Power",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{item.boolean.attributes.power_entity_id}}",
        "state_type": "str",
        "state_location": "item.power.state",
        "override_payload": "msg",
        "entity_location": "item.power.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 990,
        "y": 917,
        "wires": [
            [
                "dea45e02.e92cf"
            ],
            []
        ]
    },
    {
        "id": "18d7566e.bde73a",
        "type": "switch",
        "z": "c8979269.83b0b",
        "name": "Adjustable",
        "property": "item.boolean.attributes.adjustable_lux",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 310,
        "y": 1100,
        "wires": [
            [
                "8ac62d4e.10201"
            ],
            [
                "efb6105d.4e4f7"
            ]
        ]
    },
    {
        "id": "a01e88c4.868f78",
        "type": "switch",
        "z": "c8979269.83b0b",
        "name": "Changed?",
        "property": "item.planned.data.brightness",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "item.light.brightness",
                "vt": "msg"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 690,
        "y": 1060,
        "wires": [
            [
                "efb6105d.4e4f7"
            ],
            []
        ]
    },
    {
        "id": "efb6105d.4e4f7",
        "type": "switch",
        "z": "c8979269.83b0b",
        "name": "Circadian",
        "property": "item.boolean.attributes.adjustable_colour",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "item.power.data.state = \"on\"",
                "vt": "jsonata"
            },
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 860,
        "y": 1100,
        "wires": [
            [
                "757eb93b.cfee08"
            ],
            [
                "4c98c1f.225034"
            ],
            [
                "757eb93b.cfee08"
            ]
        ]
    },
    {
        "id": "220e5918.3f58c6",
        "type": "api-current-state",
        "z": "c8979269.83b0b",
        "name": "Get config",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{item.boolean.entity_id}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "payload",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 310,
        "y": 977,
        "wires": [
            [
                "aedb5105.96055"
            ]
        ]
    },
    {
        "id": "aedb5105.96055",
        "type": "switch",
        "z": "c8979269.83b0b",
        "name": "Adjustable",
        "property": "item.boolean.attributes.adjustable_lux",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "payload.attributes.adjustable_lux and payload.attributes.circadian",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 510,
        "y": 977,
        "wires": [
            [
                "233e12a1.9b96de"
            ],
            []
        ]
    },
    {
        "id": "a8f7cc1b.2445e",
        "type": "server-state-changed",
        "z": "c8979269.83b0b",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.location_mode",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 120,
        "y": 860,
        "wires": [
            [
                "7ea74f85.732d"
            ]
        ]
    },
    {
        "id": "2ecff909.9ba216",
        "type": "server-state-changed",
        "z": "c8979269.83b0b",
        "name": "Light on",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "^group\\S*actual$",
        "entityidfiltertype": "regex",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 140,
        "y": 800,
        "wires": [
            [
                "7ea74f85.732d"
            ],
            []
        ]
    },
    {
        "id": "f2ed04d9.49f458",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "Set Last",
        "rules": [
            {
                "t": "set",
                "p": "lights",
                "pt": "flow",
                "to": " {\"last\" : $merge ([ $lookup($flowContext('lights'), \"last\") ,  {item.planned.data.entity_id: $millis()}])}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1560,
        "y": 1100,
        "wires": [
            [
                "1ba936f2.b03689",
                "c453bb89.2ef4e8"
            ]
        ]
    },
    {
        "id": "c1d8b188.31db6",
        "type": "switch",
        "z": "c8979269.83b0b",
        "name": "Too Recent ?",
        "property": "light",
        "propertyType": "msg",
        "rules": [
            {
                "t": "null"
            },
            {
                "t": "gt",
                "v": "$millis() - 2000",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1390,
        "y": 1100,
        "wires": [
            [
                "f2ed04d9.49f458"
            ],
            [
                "f2ed04d9.49f458"
            ],
            []
        ]
    },
    {
        "id": "24ee51f.40ca4ae",
        "type": "catch",
        "z": "c8979269.83b0b",
        "name": "",
        "scope": [
            "2d31ea76.fdeea6"
        ],
        "uncaught": false,
        "x": 1230,
        "y": 160,
        "wires": [
            [
                "5640995d.aabbb"
            ]
        ]
    },
    {
        "id": "5640995d.aabbb",
        "type": "debug",
        "z": "c8979269.83b0b",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1370,
        "y": 160,
        "wires": []
    },
    {
        "id": "4b3c6924.448268",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$replace(payload, \"{\",\"(\")",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$replace(payload, \"}\",\")\")",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$replace(payload, '\"',\"\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1520,
        "y": 800,
        "wires": [
            [
                "c18c7166.3bbd4"
            ]
        ]
    },
    {
        "id": "c18c7166.3bbd4",
        "type": "api-call-service",
        "z": "c8979269.83b0b",
        "name": "CSV",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "lights",
        "entityId": "",
        "data": "{\"message\":\",{{payload}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1690,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "47990189.3f6b8",
        "type": "json",
        "z": "c8979269.83b0b",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1350,
        "y": 800,
        "wires": [
            [
                "4b3c6924.448268"
            ]
        ]
    },
    {
        "id": "e08c1e0d.aebe6",
        "type": "link in",
        "z": "c8979269.83b0b",
        "name": "L3",
        "links": [
            "95d14639.d2ecf8",
            "c453bb89.2ef4e8"
        ],
        "x": 1210,
        "y": 800,
        "wires": [
            [
                "47990189.3f6b8"
            ]
        ],
        "l": true
    },
    {
        "id": "95d14639.d2ecf8",
        "type": "link out",
        "z": "c8979269.83b0b",
        "name": "L1",
        "links": [
            "e08c1e0d.aebe6"
        ],
        "x": 770,
        "y": 640,
        "wires": [],
        "l": true
    },
    {
        "id": "c453bb89.2ef4e8",
        "type": "link out",
        "z": "c8979269.83b0b",
        "name": "L2",
        "links": [
            "e08c1e0d.aebe6"
        ],
        "x": 1710,
        "y": 1060,
        "wires": [],
        "l": true
    },
    {
        "id": "d0adaa35.39e1a8",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "",
        "props": [
            {
                "p": "kelvin",
                "v": "5000",
                "vt": "num"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1160,
        "y": 620,
        "wires": [
            [
                "c88f788d.ccaf58"
            ]
        ]
    },
    {
        "id": "c88f788d.ccaf58",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "change",
                "pt": "msg",
                "to": "kelvin-(1000000/((1000000/kelvin)+1))",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1340,
        "y": 620,
        "wires": [
            [
                "10fe0fa8.79fe8"
            ]
        ]
    },
    {
        "id": "10fe0fa8.79fe8",
        "type": "debug",
        "z": "c8979269.83b0b",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1510,
        "y": 620,
        "wires": []
    },
    {
        "id": "1b57d48b.11cbbb",
        "type": "timecheck",
        "z": "2bf27921.c09716",
        "name": "After 20:00",
        "time": "20:00",
        "x": 790,
        "y": 140,
        "wires": [
            [
                "ccf0c16c.d9992"
            ],
            [
                "2d61dca4.3bcdfc"
            ]
        ]
    },
    {
        "id": "da230c.782a6cf8",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "input_boolean.occupied_living_room",
        "payload": "{\"initiator\":\"forced\"}",
        "payloadType": "json",
        "x": 110,
        "y": 140,
        "wires": [
            [
                "a54803b9.7127e"
            ]
        ]
    },
    {
        "id": "a54803b9.7127e",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Lights Off?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.living_room",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 270,
        "y": 140,
        "wires": [
            [
                "99d9f9c8.49fc88"
            ],
            []
        ]
    },
    {
        "id": "3504b208.606ace",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Set Normal",
        "rules": [
            {
                "t": "set",
                "p": "initiator",
                "pt": "msg",
                "to": "Motion",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "normal",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1590,
        "y": 320,
        "wires": [
            [
                "16817b6a.0338dd"
            ]
        ]
    },
    {
        "id": "9f99ba2e.b25a88",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Set Evening Chill",
        "rules": [
            {
                "t": "set",
                "p": "initiator",
                "pt": "msg",
                "to": "Motion",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "evening_chill",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1610,
        "y": 240,
        "wires": [
            [
                "16817b6a.0338dd"
            ]
        ]
    },
    {
        "id": "31c1b411.b416ac",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Force",
        "payloadType": "str",
        "x": 802,
        "y": 400,
        "wires": [
            [
                "3504b208.606ace"
            ]
        ]
    },
    {
        "id": "bb5e1729.2546c8",
        "type": "time-range-switch",
        "z": "2bf27921.c09716",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "22:00",
        "endTime": "01:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 470,
        "y": 600,
        "wires": [
            [
                "c8f55e19.91fae"
            ],
            [
                "1911975e.ac71b9"
            ]
        ]
    },
    {
        "id": "c8f55e19.91fae",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Home\",\"Night\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "includes",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "location_mode",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 660,
        "y": 560,
        "wires": [
            [
                "1911975e.ac71b9"
            ],
            []
        ]
    },
    {
        "id": "1911975e.ac71b9",
        "type": "api-call-service",
        "z": "2bf27921.c09716",
        "name": "Turn off lights",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.living_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 860,
        "y": 600,
        "wires": [
            [
                "295e2511.95082a"
            ]
        ]
    },
    {
        "id": "846e94c7.854788",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Lights On?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.living_room",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 290,
        "y": 600,
        "wires": [
            [
                "bb5e1729.2546c8"
            ],
            []
        ]
    },
    {
        "id": "295e2511.95082a",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "light.living_room",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned off by Timer",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 600,
        "wires": [
            [
                "ba33b2f4.b403d"
            ]
        ]
    },
    {
        "id": "ba33b2f4.b403d",
        "type": "link out",
        "z": "2bf27921.c09716",
        "name": "Turn Off",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1175,
        "y": 600,
        "wires": []
    },
    {
        "id": "61041fe5.727f1",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "force",
        "payloadType": "str",
        "x": 690,
        "y": 500,
        "wires": [
            [
                "1911975e.ac71b9"
            ]
        ]
    },
    {
        "id": "2d61dca4.3bcdfc",
        "type": "time-range-switch",
        "z": "2bf27921.c09716",
        "name": "Midnight - 06:00",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "00:00",
        "endTime": "06:00",
        "startOffset": "0",
        "endOffset": "0",
        "x": 800,
        "y": 260,
        "wires": [
            [],
            [
                "dee5c760.6ed128"
            ]
        ]
    },
    {
        "id": "de757c6a.676c7",
        "type": "comment",
        "z": "2bf27921.c09716",
        "name": "No lights after midnight",
        "info": "",
        "x": 800,
        "y": 220,
        "wires": []
    },
    {
        "id": "4b95d462.d2a77c",
        "type": "switch",
        "z": "2bf27921.c09716",
        "name": "High Light",
        "property": "payload.living_room_lux",
        "propertyType": "msg",
        "rules": [
            {
                "t": "lte",
                "v": "1.6",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 610,
        "y": 140,
        "wires": [
            [
                "1b57d48b.11cbbb"
            ],
            []
        ]
    },
    {
        "id": "dee5c760.6ed128",
        "type": "time-range-switch",
        "z": "2bf27921.c09716",
        "name": "06:00 - 07:00",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "06:00",
        "endTime": "07:00",
        "startOffset": "0",
        "endOffset": "0",
        "x": 790,
        "y": 320,
        "wires": [
            [
                "ccf0c16c.d9992"
            ],
            [
                "3504b208.606ace"
            ]
        ]
    },
    {
        "id": "ccf0c16c.d9992",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Not Evening",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Evening\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "does_not_include",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "location_mode",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1070,
        "y": 260,
        "wires": [
            [
                "e1e46d39.a8eee"
            ],
            []
        ]
    },
    {
        "id": "dbf07543.d6c768",
        "type": "switch",
        "z": "2bf27921.c09716",
        "name": "",
        "property": "fireplace_mode",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Evening Chill",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Evening Friends",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1430,
        "y": 260,
        "wires": [
            [
                "9f99ba2e.b25a88"
            ],
            [
                "bddf04af.715fd8"
            ],
            []
        ]
    },
    {
        "id": "bddf04af.715fd8",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Set Evening Friends",
        "rules": [
            {
                "t": "set",
                "p": "initiator",
                "pt": "msg",
                "to": "Motion",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "evening_friends",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 280,
        "wires": [
            [
                "16817b6a.0338dd"
            ]
        ]
    },
    {
        "id": "ecf4e2a0.6197a",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "Force",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1070,
        "y": 180,
        "wires": [
            [
                "e1e46d39.a8eee"
            ]
        ]
    },
    {
        "id": "e1e46d39.a8eee",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Fireplace Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.fireplace_lights_mode",
        "state_type": "str",
        "state_location": "fireplace_mode",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1260,
        "y": 260,
        "wires": [
            [
                "dbf07543.d6c768"
            ]
        ]
    },
    {
        "id": "57291a8.e88cce4",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "force",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"forced\"}",
        "payloadType": "str",
        "x": 290,
        "y": 80,
        "wires": [
            [
                "99d9f9c8.49fc88"
            ]
        ]
    },
    {
        "id": "99d9f9c8.49fc88",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Set Lux",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.living_room_lux",
                "pt": "msg",
                "to": "$number($globalContext('homeassistant.homeAssistant.states[\"sensor.living_room_hue_motion_light_level\"]').state)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.living_room_light_level",
                "pt": "msg",
                "to": "$number($globalContext('homeassistant.homeAssistant.states[\"sensor.living_room_hue_lightlevel\"]').state)",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 140,
        "wires": [
            [
                "4b95d462.d2a77c"
            ]
        ]
    },
    {
        "id": "16817b6a.0338dd",
        "type": "link out",
        "z": "2bf27921.c09716",
        "name": "Evening Friends",
        "links": [
            "86f713a9.e297d",
            "7388c2bc.f7980c"
        ],
        "x": 1775,
        "y": 280,
        "wires": []
    },
    {
        "id": "9093f113.b89e6",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "TV Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.tv_light",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 260,
        "y": 840,
        "wires": [
            [
                "21ec4d1a.16a022"
            ],
            [
                "54b3b7b3.851448"
            ]
        ]
    },
    {
        "id": "d5a6030c.422d3",
        "type": "api-call-service",
        "z": "2bf27921.c09716",
        "name": "Change",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "",
        "data": "{\"entity_id\":\"input_select.fireplace_lights_mode\",\"option\":\"{{topic}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 780,
        "y": 820,
        "wires": [
            [
                "6f268c54.b79334"
            ]
        ]
    },
    {
        "id": "6f268c54.b79334",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Fireplace lights",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "'have been set to ' & $$.topic",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Scene",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 820,
        "wires": [
            [
                "f9c3ea39.407708"
            ]
        ]
    },
    {
        "id": "f9c3ea39.407708",
        "type": "link out",
        "z": "2bf27921.c09716",
        "name": "Security",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1075,
        "y": 820,
        "wires": []
    },
    {
        "id": "54b3b7b3.851448",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Evening Chill",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Evening Chill",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 840,
        "wires": [
            [
                "31446889.060c98"
            ]
        ]
    },
    {
        "id": "21ec4d1a.16a022",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Evening Friends",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Evening Friends",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 800,
        "wires": [
            [
                "31446889.060c98"
            ]
        ]
    },
    {
        "id": "31446889.060c98",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Fireplace",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "topic",
        "halt_if_type": "msg",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.fireplace_lights_mode",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 620,
        "y": 820,
        "wires": [
            [],
            [
                "d5a6030c.422d3"
            ]
        ]
    },
    {
        "id": "854bc32.f0cf34",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 900,
        "wires": [
            [
                "9093f113.b89e6"
            ]
        ]
    },
    {
        "id": "2a466a27.82fdb6",
        "type": "poll-state",
        "z": "2bf27921.c09716",
        "name": "Side Light",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "updateinterval": "60",
        "updateIntervalUnits": "seconds",
        "outputinitially": true,
        "outputonchanged": true,
        "entity_id": "light.side_light",
        "state_type": "str",
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "x": 100,
        "y": 840,
        "wires": [
            [
                "9093f113.b89e6"
            ],
            []
        ]
    },
    {
        "id": "68347c94.e54284",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Side Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "light.side_light",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 260,
        "y": 780,
        "wires": [
            [
                "21ec4d1a.16a022"
            ],
            []
        ]
    },
    {
        "id": "b7ed85eb.877768",
        "type": "server-state-changed",
        "z": "2bf27921.c09716",
        "name": "TV Light",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "light.tv_light",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 100,
        "y": 780,
        "wires": [
            [
                "68347c94.e54284"
            ],
            []
        ]
    },
    {
        "id": "eb1f8069.a10e2",
        "type": "comment",
        "z": "2bf27921.c09716",
        "name": "Set the fireplace light value to Chill or Friends",
        "info": "",
        "x": 210,
        "y": 700,
        "wires": []
    },
    {
        "id": "49f5bd69.be8c54",
        "type": "server-state-changed",
        "z": "2bf27921.c09716",
        "name": "Occupied",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.occupied_living_room",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 100,
        "y": 360,
        "wires": [
            [],
            [
                "846e94c7.854788"
            ]
        ]
    },
    {
        "id": "11b7d5ce.eb7f7a",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"forced\"}",
        "payloadType": "json",
        "x": 130,
        "y": 600,
        "wires": [
            [
                "846e94c7.854788"
            ]
        ]
    },
    {
        "id": "555dabc3.cca65c",
        "type": "link in",
        "z": "2bf27921.c09716",
        "name": "LR Lights on",
        "links": [
            "e78a743d.be3118"
        ],
        "x": 90,
        "y": 180,
        "wires": [
            [
                "a54803b9.7127e"
            ]
        ],
        "l": true
    },
    {
        "id": "756e6417.983f7c",
        "type": "comment",
        "z": "2bf27921.c09716",
        "name": "Not triggered by switch, to deal with race condition",
        "info": "",
        "x": 350,
        "y": 340,
        "wires": []
    },
    {
        "id": "f1965964.6a9be8",
        "type": "comment",
        "z": "2bf27921.c09716",
        "name": "Living Room motion detection",
        "info": "",
        "x": 160,
        "y": 40,
        "wires": []
    },
    {
        "id": "de8b8b03.a1f418",
        "type": "comment",
        "z": "2bf27921.c09716",
        "name": "Office motion detection",
        "info": "",
        "x": 160,
        "y": 980,
        "wires": []
    },
    {
        "id": "68eb30b0.aad51",
        "type": "link out",
        "z": "2bf27921.c09716",
        "name": "Power On",
        "links": [
            "a91c45f6.25e148"
        ],
        "x": 580,
        "y": 1080,
        "wires": [],
        "l": true
    },
    {
        "id": "31aaff10.62942",
        "type": "server-state-changed",
        "z": "2bf27921.c09716",
        "name": "Occupied",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.occupied_office",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 120,
        "y": 1100,
        "wires": [
            [],
            [
                "d82a957e.81ac28"
            ]
        ]
    },
    {
        "id": "9ad34787.8a75d8",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "Off ?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.office_lights_actual",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 270,
        "y": 1080,
        "wires": [
            [
                "852dba5d.2380d8"
            ],
            []
        ]
    },
    {
        "id": "852dba5d.2380d8",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Boolean",
        "rules": [
            {
                "t": "set",
                "p": "item.boolean.entity_id",
                "pt": "msg",
                "to": "input_boolean.circadian_office",
                "tot": "str"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 1080,
        "wires": [
            [
                "68eb30b0.aad51"
            ]
        ]
    },
    {
        "id": "e22bf7fb.c7dff8",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 1020,
        "wires": [
            [
                "9ad34787.8a75d8"
            ]
        ]
    },
    {
        "id": "d82a957e.81ac28",
        "type": "api-current-state",
        "z": "2bf27921.c09716",
        "name": "On?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.office_lights_actual",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": true,
        "x": 270,
        "y": 1140,
        "wires": [
            [
                "92ee2f52.4bb39"
            ],
            []
        ]
    },
    {
        "id": "92ee2f52.4bb39",
        "type": "api-call-service",
        "z": "2bf27921.c09716",
        "name": "Turn off lights",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "light.office",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 440,
        "y": 1140,
        "wires": [
            []
        ]
    },
    {
        "id": "e532bb60.0715a8",
        "type": "inject",
        "z": "2bf27921.c09716",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 1140,
        "wires": [
            [
                "d82a957e.81ac28"
            ]
        ]
    },
    {
        "id": "13a7913b.76081f",
        "type": "change",
        "z": "2bf27921.c09716",
        "name": "Power On",
        "rules": [
            {
                "t": "set",
                "p": "item.poweron",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "2bd421b5.b964ae",
        "type": "link in",
        "z": "2bf27921.c09716",
        "name": "Office Lights on",
        "links": [
            "acf29a2f.f7f008"
        ],
        "x": 100,
        "y": 1060,
        "wires": [
            [
                "9ad34787.8a75d8"
            ]
        ],
        "l": true
    },
    {
        "id": "13b79dc.3b88e62",
        "type": "api-call-service",
        "z": "83b3d59c.0b8848",
        "name": "Change Scene",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "hue",
        "service": "hue_activate_scene",
        "entityId": "",
        "data": "{\"group_name\":\"Living Room\",\"scene_name\":\"{{item.scene_name}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 300,
        "y": 540,
        "wires": [
            [
                "f0be7445.6f97f8",
                "90c74cd3.9949"
            ]
        ]
    },
    {
        "id": "b3dc6f4d.93a2f",
        "type": "api-call-service",
        "z": "83b3d59c.0b8848",
        "name": "Turn Off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{item.input}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 820,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "f0be7445.6f97f8",
        "type": "delay",
        "z": "83b3d59c.0b8848",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 480,
        "y": 540,
        "wires": [
            [
                "58560fed.40393"
            ]
        ]
    },
    {
        "id": "e27b8e7a.95628",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Flash Benjamin",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.flash_benjamin",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 100,
        "y": 720,
        "wires": [
            [
                "4fd5c9dc.fbbbb8"
            ],
            []
        ]
    },
    {
        "id": "438bdf8f.baaa6",
        "type": "inject",
        "z": "83b3d59c.0b8848",
        "name": "force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"forced\"}",
        "payloadType": "str",
        "x": 130,
        "y": 680,
        "wires": [
            [
                "4fd5c9dc.fbbbb8"
            ]
        ]
    },
    {
        "id": "4fd5c9dc.fbbbb8",
        "type": "looptimer",
        "z": "83b3d59c.0b8848",
        "duration": "2",
        "units": "Second",
        "maxloops": "2",
        "maxtimeout": "1",
        "maxtimeoutunits": "Hour",
        "name": "Loop 3",
        "x": 280,
        "y": 720,
        "wires": [
            [
                "9fd92127.6e897"
            ],
            [
                "e2834ec9.ff942"
            ]
        ]
    },
    {
        "id": "9fd92127.6e897",
        "type": "api-call-service",
        "z": "83b3d59c.0b8848",
        "name": "Flash Benjamin",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_on",
        "entityId": "",
        "data": "{\"entity_id\":\"light.bedroom_2\", \"flash\": \"short\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 500,
        "y": 720,
        "wires": [
            [
                "18fbe0c4.9f73ff"
            ]
        ]
    },
    {
        "id": "58560fed.40393",
        "type": "switch",
        "z": "83b3d59c.0b8848",
        "name": "Switch off?",
        "property": "item.initiator",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Button",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 540,
        "wires": [
            [
                "b3dc6f4d.93a2f"
            ]
        ]
    },
    {
        "id": "9edf6a5.a1dfd98",
        "type": "server-events",
        "z": "83b3d59c.0b8848",
        "name": "iOS Action",
        "server": "86fae200.61af7",
        "event_type": "ios.action_fired",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "waitForRunning": true,
        "x": 120,
        "y": 1000,
        "wires": [
            [
                "8e07a4fb.6b9a28"
            ]
        ]
    },
    {
        "id": "b856388a.bae898",
        "type": "switch",
        "z": "83b3d59c.0b8848",
        "name": "What Action?",
        "property": "payload.event.actionName",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "evening_chill",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evening_friends",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evening_movie",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "reading",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "flash_benjamin",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "evening",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "meal_time",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 9,
        "x": 440,
        "y": 1000,
        "wires": [
            [
                "af24a9a4.12b018"
            ],
            [
                "dec7e752.8c5f08"
            ],
            [
                "94e14e9e.8bdec"
            ],
            [
                "73ff03cf.49509c"
            ],
            [
                "4a5b6807.f81878"
            ],
            [
                "b488ceb1.d00b9"
            ],
            [
                "ec3b2a46.b0c4a8"
            ],
            [
                "dc15c820.81694"
            ],
            []
        ]
    },
    {
        "id": "dfbfeaf.86d1e18",
        "type": "api-call-service",
        "z": "83b3d59c.0b8848",
        "name": "Evening Time",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "input_select.location_mode",
        "data": "{\"option\":\"Evening Time\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 300,
        "y": 838,
        "wires": [
            [
                "48287ce3.faddcc"
            ]
        ]
    },
    {
        "id": "90c74cd3.9949",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "item.scene_name",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has been turned on by \" & item.initiator",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Scene",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 600,
        "wires": [
            [
                "7d02a937.07f168"
            ]
        ]
    },
    {
        "id": "ae20fabe.a27c68",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "iOS Action",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 635,
        "y": 780,
        "wires": []
    },
    {
        "id": "e2834ec9.ff942",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Flash Benjamin",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned on by Button",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 760,
        "wires": [
            [
                "ae20fabe.a27c68"
            ]
        ]
    },
    {
        "id": "48287ce3.faddcc",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Evening Time",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned on by iOS",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Location Mode",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 838,
        "wires": [
            [
                "ae20fabe.a27c68"
            ]
        ]
    },
    {
        "id": "47d0f7cb.da5398",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "A1",
        "links": [
            "fd8e4b79.ef68e8"
        ],
        "x": 950,
        "y": 320,
        "wires": [],
        "l": true
    },
    {
        "id": "fd8e4b79.ef68e8",
        "type": "link in",
        "z": "83b3d59c.0b8848",
        "name": "A2",
        "links": [
            "47d0f7cb.da5398"
        ],
        "x": 130,
        "y": 540,
        "wires": [
            [
                "13b79dc.3b88e62"
            ]
        ],
        "l": true
    },
    {
        "id": "2ac2653a.e0315a",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Change Scene",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1095,
        "y": 200,
        "wires": []
    },
    {
        "id": "8e07a4fb.6b9a28",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "iOS",
        "rules": [
            {
                "t": "set",
                "p": "initiator",
                "pt": "msg",
                "to": "iOS",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "payload.event.actionName",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 1000,
        "wires": [
            [
                "b856388a.bae898"
            ]
        ]
    },
    {
        "id": "af24a9a4.12b018",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Evening Chill",
        "links": [
            "86f713a9.e297d"
        ],
        "x": 575,
        "y": 938,
        "wires": []
    },
    {
        "id": "dec7e752.8c5f08",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Evening Friends",
        "links": [
            "86f713a9.e297d"
        ],
        "x": 635,
        "y": 958,
        "wires": []
    },
    {
        "id": "94e14e9e.8bdec",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Evening Movie",
        "links": [
            "86f713a9.e297d"
        ],
        "x": 695,
        "y": 978,
        "wires": []
    },
    {
        "id": "73ff03cf.49509c",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Normal",
        "links": [
            "86f713a9.e297d"
        ],
        "x": 635,
        "y": 998,
        "wires": []
    },
    {
        "id": "4a5b6807.f81878",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Reading",
        "links": [
            "86f713a9.e297d"
        ],
        "x": 575,
        "y": 1018,
        "wires": []
    },
    {
        "id": "b488ceb1.d00b9",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Flash Benjamin",
        "links": [
            "e3731fcf.9acfb"
        ],
        "x": 635,
        "y": 1035,
        "wires": []
    },
    {
        "id": "e3731fcf.9acfb",
        "type": "link in",
        "z": "83b3d59c.0b8848",
        "name": "Flash Benjamin",
        "links": [
            "b488ceb1.d00b9"
        ],
        "x": 155,
        "y": 760,
        "wires": [
            [
                "4fd5c9dc.fbbbb8"
            ]
        ]
    },
    {
        "id": "73315a43.8db114",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Evening Chill",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.scene_evening_chill",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 130,
        "y": 140,
        "wires": [
            [
                "cf27b250.1f623"
            ],
            []
        ]
    },
    {
        "id": "4e118677.c559d8",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Evening Friends",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.scene_evening_friends",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 120,
        "y": 200,
        "wires": [
            [
                "cf27b250.1f623"
            ],
            []
        ]
    },
    {
        "id": "b9809b09.8732d8",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Normal",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.scene_normal",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 150,
        "y": 260,
        "wires": [
            [
                "cf27b250.1f623"
            ],
            []
        ]
    },
    {
        "id": "e1f6e702.f93068",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Evening Movie",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.scene_evening_movie",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 120,
        "y": 320,
        "wires": [
            [
                "cf27b250.1f623"
            ],
            []
        ]
    },
    {
        "id": "71d198c0.02b8b8",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Reading",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.scene_reading",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 140,
        "y": 380,
        "wires": [
            [
                "cf27b250.1f623"
            ],
            []
        ]
    },
    {
        "id": "ce603649.e19f38",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Evening Chill",
        "rules": [
            {
                "t": "set",
                "p": "item.scene_name",
                "pt": "msg",
                "to": "Evening Chill",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "item.power_switch",
                "pt": "msg",
                "to": "switch.zwave_living_room_side_light_switch",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 140,
        "wires": [
            [
                "da10e433.ad7a08"
            ]
        ]
    },
    {
        "id": "cf27b250.1f623",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Setup",
        "rules": [
            {
                "t": "set",
                "p": "item.initiator",
                "pt": "msg",
                "to": "payload = \"on\" ? \"Button\" : initiator",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "item.input",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "initiator",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 260,
        "wires": [
            [
                "6fd2373d.4ced58"
            ]
        ]
    },
    {
        "id": "aeaa9411.a0a1d8",
        "type": "inject",
        "z": "83b3d59c.0b8848",
        "name": "Evening Chill",
        "props": [
            {
                "p": "initiator",
                "v": "Forced",
                "vt": "str"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "evening_chill",
        "x": 130,
        "y": 60,
        "wires": [
            [
                "cf27b250.1f623"
            ]
        ]
    },
    {
        "id": "6fd2373d.4ced58",
        "type": "switch",
        "z": "83b3d59c.0b8848",
        "name": "",
        "property": "item.input",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "evening_chill",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "evening_friends",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "normal",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "evening_movie",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "reading",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "meal_time",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 430,
        "y": 260,
        "wires": [
            [
                "ce603649.e19f38"
            ],
            [
                "4bbb04e7.96a11c"
            ],
            [
                "e56d44ac.c36b98"
            ],
            [
                "8f803d78.28499"
            ],
            [
                "c5a810cb.e6d16"
            ],
            [
                "cfc75438.f68f4"
            ]
        ]
    },
    {
        "id": "4bbb04e7.96a11c",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Evening Friends",
        "rules": [
            {
                "t": "set",
                "p": "item.scene_name",
                "pt": "msg",
                "to": "Evening Friends",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "item.power_switch",
                "pt": "msg",
                "to": "switch.zwave_living_room_side_light_switch",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 200,
        "wires": [
            [
                "da10e433.ad7a08"
            ]
        ]
    },
    {
        "id": "e56d44ac.c36b98",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Normal",
        "rules": [
            {
                "t": "set",
                "p": "item.scene_name",
                "pt": "msg",
                "to": "Normal",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "item.power_switch",
                "pt": "msg",
                "to": "switch.zwave_living_room_main_light_switch",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 260,
        "wires": [
            [
                "da10e433.ad7a08"
            ]
        ]
    },
    {
        "id": "8f803d78.28499",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Evening Movie",
        "rules": [
            {
                "t": "set",
                "p": "item.scene_name",
                "pt": "msg",
                "to": "Evening Movie",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 600,
        "y": 320,
        "wires": [
            [
                "47d0f7cb.da5398"
            ]
        ]
    },
    {
        "id": "c5a810cb.e6d16",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Reading",
        "rules": [
            {
                "t": "set",
                "p": "item.scene_name",
                "pt": "msg",
                "to": "Reading",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 580,
        "y": 380,
        "wires": [
            [
                "47d0f7cb.da5398"
            ]
        ]
    },
    {
        "id": "da10e433.ad7a08",
        "type": "api-current-state",
        "z": "83b3d59c.0b8848",
        "name": "Power State",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{item.power_switch}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 790,
        "y": 200,
        "wires": [
            [
                "4e8de665.0e9998"
            ],
            [
                "47d0f7cb.da5398"
            ]
        ]
    },
    {
        "id": "4e8de665.0e9998",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "item.power_switch",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "is off",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Switch",
                "tot": "str"
            },
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 970,
        "y": 200,
        "wires": [
            [
                "2ac2653a.e0315a"
            ]
        ]
    },
    {
        "id": "86f713a9.e297d",
        "type": "link in",
        "z": "83b3d59c.0b8848",
        "name": "Change Scene",
        "links": [
            "16817b6a.0338dd",
            "4a5b6807.f81878",
            "73ff03cf.49509c",
            "94e14e9e.8bdec",
            "af24a9a4.12b018",
            "dc15c820.81694",
            "dec7e752.8c5f08"
        ],
        "x": 175,
        "y": 100,
        "wires": [
            [
                "cf27b250.1f623"
            ]
        ]
    },
    {
        "id": "ec3b2a46.b0c4a8",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Evening Time",
        "links": [
            "51df60c5.fa223"
        ],
        "x": 695,
        "y": 1055,
        "wires": []
    },
    {
        "id": "51df60c5.fa223",
        "type": "link in",
        "z": "83b3d59c.0b8848",
        "name": "Evening Time",
        "links": [
            "ec3b2a46.b0c4a8"
        ],
        "x": 155,
        "y": 838,
        "wires": [
            [
                "dfbfeaf.86d1e18"
            ]
        ]
    },
    {
        "id": "ac96888c.2a90d8",
        "type": "link in",
        "z": "83b3d59c.0b8848",
        "name": "B2",
        "links": [],
        "x": 330,
        "y": 500,
        "wires": [
            [
                "f0be7445.6f97f8"
            ]
        ],
        "l": true
    },
    {
        "id": "18fbe0c4.9f73ff",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "B1",
        "links": [],
        "x": 670,
        "y": 720,
        "wires": [],
        "l": true
    },
    {
        "id": "7d02a937.07f168",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "iOS Action",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 615,
        "y": 600,
        "wires": []
    },
    {
        "id": "7aeb250e.e55fac",
        "type": "comment",
        "z": "83b3d59c.0b8848",
        "name": "Button triggers",
        "info": "",
        "x": 120,
        "y": 20,
        "wires": []
    },
    {
        "id": "7d15751b.bad08c",
        "type": "comment",
        "z": "83b3d59c.0b8848",
        "name": "Change the scene",
        "info": "",
        "x": 110,
        "y": 500,
        "wires": []
    },
    {
        "id": "2f7b800f.b897b",
        "type": "comment",
        "z": "83b3d59c.0b8848",
        "name": "Flash Benjamin",
        "info": "",
        "x": 120,
        "y": 640,
        "wires": []
    },
    {
        "id": "219a70d5.02e73",
        "type": "comment",
        "z": "83b3d59c.0b8848",
        "name": "Set Evening Time",
        "info": "",
        "x": 120,
        "y": 800,
        "wires": []
    },
    {
        "id": "67e9216d.823bc",
        "type": "comment",
        "z": "83b3d59c.0b8848",
        "name": "iOS Actions",
        "info": "",
        "x": 130,
        "y": 940,
        "wires": []
    },
    {
        "id": "d9dd1649.6fa198",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "22:00",
        "endTime": "01:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 670,
        "y": 560,
        "wires": [
            [
                "f2af9609.5c0ee8"
            ],
            []
        ]
    },
    {
        "id": "1bc0ee11.d81132",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "06:00",
        "endTime": "12:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 670,
        "y": 420,
        "wires": [
            [
                "147dbbd.df0f144"
            ],
            []
        ]
    },
    {
        "id": "20f13ac4.84ee66",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_select",
        "service": "select_option",
        "entityId": "input_select.location_mode",
        "data": "{\"option\":\"{{topic}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 2100,
        "y": 580,
        "wires": [
            [
                "cd411d4a.40f12"
            ]
        ]
    },
    {
        "id": "e1cbe7fb.92cf38",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "01:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 670,
        "y": 640,
        "wires": [
            [
                "12a10cc1.7712c3"
            ],
            []
        ]
    },
    {
        "id": "894bf7b6.0943e8",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Check not already set",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "topic",
        "halt_if_type": "msg",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1880,
        "y": 620,
        "wires": [
            [
                "20f13ac4.84ee66",
                "9b7103a6.c4943"
            ],
            []
        ]
    },
    {
        "id": "f2af9609.5c0ee8",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Evening\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "does_not_include",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 900,
        "y": 560,
        "wires": [
            [
                "12a10cc1.7712c3"
            ],
            []
        ]
    },
    {
        "id": "e3649c7e.cbbd8",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "on",
        "payloadType": "str",
        "x": 150,
        "y": 340,
        "wires": [
            [
                "3936b03b.2de4"
            ]
        ]
    },
    {
        "id": "dc17cbc5.e26998",
        "type": "server-state-changed",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_select.location_mode",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 100,
        "y": 1160,
        "wires": [
            [
                "962d01b4.88a6f"
            ]
        ]
    },
    {
        "id": "f2c2f8dd.65b928",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Turn off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{topic}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1000,
        "y": 1160,
        "wires": [
            [
                "892bff07.06756"
            ]
        ]
    },
    {
        "id": "ce4a9ff3.3023",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "Away",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Away",
        "payloadType": "str",
        "x": 130,
        "y": 1120,
        "wires": [
            [
                "962d01b4.88a6f"
            ]
        ]
    },
    {
        "id": "962d01b4.88a6f",
        "type": "switch",
        "z": "e3330cd1.4ad86",
        "name": "Away ?",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Away",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 280,
        "y": 1160,
        "wires": [
            [
                "777407a2.ec8b98"
            ],
            []
        ]
    },
    {
        "id": "777407a2.ec8b98",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "sunriseEnd",
        "endTime": "sunsetStart",
        "startOffset": 0,
        "endOffset": 0,
        "x": 490,
        "y": 1160,
        "wires": [
            [
                "fbf9ac50.89b9b"
            ],
            []
        ]
    },
    {
        "id": "37888b06.2ae674",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "off",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 150,
        "y": 140,
        "wires": [
            [
                "1e0b522b.a83f6e"
            ]
        ]
    },
    {
        "id": "41a4eedc.c37b9",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "1am",
        "repeat": "",
        "crontab": "00 01 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 150,
        "y": 240,
        "wires": [
            [
                "1e0b522b.a83f6e"
            ]
        ]
    },
    {
        "id": "892bff07.06756",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned off by SHM (Location Mode)",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1160,
        "wires": [
            [
                "efb05ea5.0e713"
            ]
        ]
    },
    {
        "id": "efb05ea5.0e713",
        "type": "link out",
        "z": "e3330cd1.4ad86",
        "name": "Lights",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1295,
        "y": 1160,
        "wires": []
    },
    {
        "id": "fbf9ac50.89b9b",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "All Lights",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "light.house",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 1160,
        "wires": [
            [
                "93e87b8d.38d18"
            ]
        ]
    },
    {
        "id": "cd411d4a.40f12",
        "type": "link out",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 2235,
        "y": 580,
        "wires": []
    },
    {
        "id": "147dbbd.df0f144",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Good Morning!",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Home",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1100,
        "y": 420,
        "wires": [
            [
                "f1fcc2b0.f8bed"
            ]
        ]
    },
    {
        "id": "2a760f16.2defe",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "force",
        "payload": "",
        "payloadType": "str",
        "x": 930,
        "y": 380,
        "wires": [
            [
                "147dbbd.df0f144"
            ]
        ]
    },
    {
        "id": "12a10cc1.7712c3",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Good Night!",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Night",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 580,
        "wires": [
            [
                "f1fcc2b0.f8bed"
            ]
        ]
    },
    {
        "id": "1bad0360.50b04d",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "I'm Back!",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Home",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "service",
                "pt": "msg",
                "to": "home",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1080,
        "y": 900,
        "wires": [
            [
                "29aec4dc.71446c"
            ]
        ]
    },
    {
        "id": "d6baa6e4.0b0528",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Good Bye!",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Away",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "service",
                "pt": "msg",
                "to": "away",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1090,
        "y": 740,
        "wires": [
            [
                "29aec4dc.71446c"
            ]
        ]
    },
    {
        "id": "1bf4266.a40485a",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "force",
        "payloadType": "str",
        "x": 930,
        "y": 640,
        "wires": [
            [
                "12a10cc1.7712c3"
            ]
        ]
    },
    {
        "id": "29aec4dc.71446c",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned on by SHM (Presence)",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1490,
        "y": 820,
        "wires": [
            [
                "73b622c1.be85dc"
            ]
        ]
    },
    {
        "id": "f1fcc2b0.f8bed",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Away\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "does_not_include",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1300,
        "y": 480,
        "wires": [
            [
                "c3b3c863.5492f8"
            ],
            []
        ]
    },
    {
        "id": "93e87b8d.38d18",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Is on?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 850,
        "y": 1160,
        "wires": [
            [
                "f2c2f8dd.65b928"
            ],
            []
        ]
    },
    {
        "id": "d65dae99.c8e6f",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "10pm",
        "repeat": "",
        "crontab": "00 22 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "off",
        "payloadType": "str",
        "x": 150,
        "y": 200,
        "wires": [
            [
                "1e0b522b.a83f6e"
            ]
        ]
    },
    {
        "id": "97efb78b.e59758",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "12:00",
        "endTime": "22:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 670,
        "y": 480,
        "wires": [
            [
                "d5c07bd3.31b868"
            ],
            []
        ]
    },
    {
        "id": "d5c07bd3.31b868",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Good Afternoon!",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Home",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1100,
        "y": 480,
        "wires": [
            [
                "f1fcc2b0.f8bed"
            ]
        ]
    },
    {
        "id": "4aaf73ef.48391c",
        "type": "server-state-changed",
        "z": "e3330cd1.4ad86",
        "name": "Presence",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.presence_all",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 120,
        "y": 940,
        "wires": [
            [
                "fe36cb0a.466598"
            ],
            [
                "4d65a2e4.b8fb8c"
            ]
        ]
    },
    {
        "id": "98aa8442.03fdb8",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "home",
        "payloadType": "str",
        "x": 130,
        "y": 880,
        "wires": [
            [
                "fe36cb0a.466598"
            ]
        ]
    },
    {
        "id": "98524c95.1751e",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "not_home",
        "payloadType": "str",
        "x": 120,
        "y": 1000,
        "wires": [
            [
                "4d65a2e4.b8fb8c"
            ]
        ]
    },
    {
        "id": "568ae685.876138",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Timer Start",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "start",
        "entityId": " ",
        "data": "{\"entity_id\":\"timer.away\",\"duration\":\"{{payload}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 430,
        "y": 980,
        "wires": [
            [
                "d1ce7a35.315948"
            ]
        ]
    },
    {
        "id": "4d65a2e4.b8fb8c",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "7 mins",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "00:07:00",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 980,
        "wires": [
            [
                "568ae685.876138",
                "bfb6d294.ca57d"
            ]
        ]
    },
    {
        "id": "fe36cb0a.466598",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Timer Cancel",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "cancel",
        "entityId": " ",
        "data": "{\"entity_id\":\"timer.away\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 290,
        "y": 900,
        "wires": [
            [
                "1bad0360.50b04d"
            ]
        ]
    },
    {
        "id": "d1ce7a35.315948",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "timer.away",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "'has been started by SHM (Presence) - ' & $$.payload",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Timer",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 980,
        "wires": [
            [
                "b5481706.a33978"
            ]
        ]
    },
    {
        "id": "b5481706.a33978",
        "type": "link out",
        "z": "e3330cd1.4ad86",
        "name": "Turn Off",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 735,
        "y": 980,
        "wires": []
    },
    {
        "id": "646f2fe1.4fecc",
        "type": "switch",
        "z": "e3330cd1.4ad86",
        "name": "Night/Away Timer",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "timer.night",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "timer.away",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 350,
        "y": 740,
        "wires": [
            [
                "d9dd1649.6fa198",
                "e1cbe7fb.92cf38"
            ],
            [
                "d6baa6e4.0b0528"
            ]
        ]
    },
    {
        "id": "e26aebff.6b29b8",
        "type": "server-events",
        "z": "e3330cd1.4ad86",
        "name": "Timer Finished",
        "server": "86fae200.61af7",
        "event_type": "timer.finished",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "waitForRunning": true,
        "x": 140,
        "y": 740,
        "wires": [
            [
                "646f2fe1.4fecc"
            ]
        ]
    },
    {
        "id": "c9f1f4a0.1ef578",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "Timer Finished",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"entity_id\":\"timer.lights_living_room\"}",
        "payloadType": "json",
        "x": 140,
        "y": 800,
        "wires": [
            [
                "646f2fe1.4fecc"
            ]
        ]
    },
    {
        "id": "836e40d9.b23de",
        "type": "server-state-changed",
        "z": "e3330cd1.4ad86",
        "name": "Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.downstairs_occupancy",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 150,
        "y": 280,
        "wires": [
            [
                "1e0b522b.a83f6e"
            ],
            [
                "3936b03b.2de4"
            ]
        ]
    },
    {
        "id": "3936b03b.2de4",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Timer Cancel",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "cancel",
        "entityId": " ",
        "data": "{\"entity_id\":\"timer.night\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 310,
        "y": 320,
        "wires": [
            [
                "1bc0ee11.d81132",
                "97efb78b.e59758"
            ]
        ]
    },
    {
        "id": "f5964b37.0c3028",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Timer Start",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "start",
        "entityId": " ",
        "data": "{\"entity_id\":\"timer.night\",\"duration\":\"{{payload}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1190,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "736fc24e.02b8bc",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "15 mins",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "00:15:00",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 260,
        "wires": [
            [
                "f5964b37.0c3028"
            ]
        ]
    },
    {
        "id": "5b4803bc.084b3c",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "timer.night",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "'has been started by SHM (Motion) - ' & $$.payload",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Timer",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1370,
        "y": 260,
        "wires": [
            [
                "7c19f4a9.0028bc"
            ]
        ]
    },
    {
        "id": "7c19f4a9.0028bc",
        "type": "link out",
        "z": "e3330cd1.4ad86",
        "name": "Turn Off",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1495,
        "y": 260,
        "wires": []
    },
    {
        "id": "8ce7a601.ce42a8",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "22:00",
        "endTime": "01:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 450,
        "y": 200,
        "wires": [
            [
                "a2b3ced4.59428"
            ],
            []
        ]
    },
    {
        "id": "5c138dd5.38be34",
        "type": "time-range-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "01:00",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 450,
        "y": 260,
        "wires": [
            [
                "f01ce7d4.f5fff8"
            ],
            []
        ]
    },
    {
        "id": "a2b3ced4.59428",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Evening\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "does_not_include",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 640,
        "y": 180,
        "wires": [
            [
                "f01ce7d4.f5fff8"
            ],
            []
        ]
    },
    {
        "id": "1e0b522b.a83f6e",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Link",
        "rules": [],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 240,
        "wires": [
            [
                "8ce7a601.ce42a8",
                "5c138dd5.38be34"
            ]
        ]
    },
    {
        "id": "daa41e9d.c938a",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "force",
        "payloadType": "str",
        "x": 870,
        "y": 200,
        "wires": [
            [
                "736fc24e.02b8bc"
            ]
        ]
    },
    {
        "id": "bfb6d294.ca57d",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Timer Cancel",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "cancel",
        "entityId": " ",
        "data": "{\"entity_id\":\"timer.night\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 430,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "f01ce7d4.f5fff8",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Night\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "does_not_include",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 840,
        "y": 260,
        "wires": [
            [
                "736fc24e.02b8bc"
            ],
            []
        ]
    },
    {
        "id": "9b7103a6.c4943",
        "type": "switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "property": "service",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2070,
        "y": 660,
        "wires": [
            [
                "cade1efe.b81da"
            ],
            []
        ]
    },
    {
        "id": "cade1efe.b81da",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Ring Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "alarm_control_panel",
        "service": "alarm_arm_{{service}}",
        "entityId": "alarm_control_panel.the_mews_mode",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 2230,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "7ec6c929.efabc8",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 930,
        "y": 780,
        "wires": [
            [
                "d6baa6e4.0b0528"
            ]
        ]
    },
    {
        "id": "dde5fbd9.741788",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 930,
        "y": 860,
        "wires": [
            [
                "1bad0360.50b04d"
            ]
        ]
    },
    {
        "id": "b57a3c6a.c735e",
        "type": "server-state-changed",
        "z": "e3330cd1.4ad86",
        "name": "Bedside",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "group.bedside_light_actual",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 120,
        "y": 1300,
        "wires": [
            [
                "d4aa21e4.15359"
            ],
            []
        ]
    },
    {
        "id": "591c80c8.d0129",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Living Room Lights",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.living_room_lights_actual",
        "state_type": "str",
        "state_location": "item.bedside.state",
        "override_payload": "msg",
        "entity_location": "item.bedside.data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 650,
        "y": 1300,
        "wires": [
            [],
            [
                "335de1d6.e815ae"
            ]
        ]
    },
    {
        "id": "814cb4da.d3aff8",
        "type": "inject",
        "z": "e3330cd1.4ad86",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Forced",
        "payloadType": "str",
        "x": 120,
        "y": 1360,
        "wires": [
            [
                "d4aa21e4.15359"
            ]
        ]
    },
    {
        "id": "335de1d6.e815ae",
        "type": "within-time-switch",
        "z": "e3330cd1.4ad86",
        "name": "",
        "nameInt": "",
        "positionConfig": "20ca47a2.e52b48",
        "startTime": "21:30",
        "startTimeType": "entered",
        "startOffset": 0,
        "startOffsetType": "none",
        "startOffsetMultiplier": 60000,
        "endTime": "03:00",
        "endTimeType": "entered",
        "endOffset": 0,
        "endOffsetType": "none",
        "endOffsetMultiplier": 60000,
        "timeDays": "*",
        "timeOnlyOddDays": false,
        "timeOnlyEvenDays": false,
        "timeMonths": "*",
        "timedatestart": "",
        "timedateend": "",
        "propertyStart": "",
        "propertyStartType": "none",
        "propertyStartCompare": "true",
        "propertyStartThreshold": "",
        "propertyStartThresholdType": "num",
        "startTimeAlt": "",
        "startTimeAltType": "entered",
        "startOffsetAlt": 0,
        "startOffsetAltType": "none",
        "startOffsetAltMultiplier": 60000,
        "propertyEnd": "",
        "propertyEndType": "none",
        "propertyEndCompare": "true",
        "propertyEndThreshold": "",
        "propertyEndThresholdType": "num",
        "endTimeAlt": "",
        "endTimeAltType": "entered",
        "endOffsetAlt": 0,
        "endOffsetAltType": "none",
        "endOffsetAltMultiplier": 60000,
        "tsCompare": "0",
        "x": 850,
        "y": 1300,
        "wires": [
            [
                "92fd5654.6e4d98",
                "60712326.c06ffc",
                "9b18d6d7.918b",
                "dac2d82.fc22528",
                "17fb6136.7001cf"
            ],
            []
        ]
    },
    {
        "id": "73b622c1.be85dc",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Location Mode",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1670,
        "y": 620,
        "wires": [
            [
                "894bf7b6.0943e8"
            ]
        ]
    },
    {
        "id": "92fd5654.6e4d98",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned on by SHM (Bedtime)",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "Night",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 1300,
        "wires": [
            [
                "b56df726.b01e68"
            ]
        ]
    },
    {
        "id": "c3b3c863.5492f8",
        "type": "change",
        "z": "e3330cd1.4ad86",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned on by SHM (Motion)",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1490,
        "y": 480,
        "wires": [
            [
                "73b622c1.be85dc"
            ]
        ]
    },
    {
        "id": "b56df726.b01e68",
        "type": "link out",
        "z": "e3330cd1.4ad86",
        "name": "A1",
        "links": [
            "f07cda9d.59abb8"
        ],
        "x": 1190,
        "y": 1300,
        "wires": [],
        "l": true
    },
    {
        "id": "f07cda9d.59abb8",
        "type": "link in",
        "z": "e3330cd1.4ad86",
        "name": "A2",
        "links": [
            "b56df726.b01e68"
        ],
        "x": 1510,
        "y": 620,
        "wires": [
            [
                "73b622c1.be85dc"
            ]
        ],
        "l": true
    },
    {
        "id": "dbe4d43a.ce1dc8",
        "type": "comment",
        "z": "e3330cd1.4ad86",
        "name": "Turn off lights if changed to Away",
        "info": "",
        "x": 160,
        "y": 1080,
        "wires": []
    },
    {
        "id": "f28817f1.b3dba8",
        "type": "comment",
        "z": "e3330cd1.4ad86",
        "name": "Set to Night if Bedtime requested (probably)",
        "info": "",
        "x": 190,
        "y": 1260,
        "wires": []
    },
    {
        "id": "d4aa21e4.15359",
        "type": "stoptimer",
        "z": "e3330cd1.4ad86",
        "duration": "5",
        "units": "Second",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "5 Seconds",
        "x": 290,
        "y": 1300,
        "wires": [
            [
                "24a5e42c.0a458c"
            ],
            []
        ]
    },
    {
        "id": "60712326.c06ffc",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Living Room- 15C",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "geniushub",
        "service": "set_zone_override",
        "entityId": "climate.living_room",
        "data": "{\"temperature\":\"15\"}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1050,
        "y": 1360,
        "wires": [
            []
        ]
    },
    {
        "id": "9b18d6d7.918b",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Kitchen - 15C",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "geniushub",
        "service": "set_zone_override",
        "entityId": "climate.kitchen",
        "data": "{\"temperature\":\"15\"}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1040,
        "y": 1420,
        "wires": [
            []
        ]
    },
    {
        "id": "dac2d82.fc22528",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Dining Room- 15C",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "geniushub",
        "service": "set_zone_override",
        "entityId": "climate.dining_room",
        "data": "{\"temperature\":\"15\"}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1050,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "17fb6136.7001cf",
        "type": "api-call-service",
        "z": "e3330cd1.4ad86",
        "name": "Bed 3 - 15C",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "geniushub",
        "service": "set_zone_override",
        "entityId": "climate.bedroom_3",
        "data": "{\"temperature\":\"15\"}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1030,
        "y": 1540,
        "wires": [
            []
        ]
    },
    {
        "id": "24a5e42c.0a458c",
        "type": "api-current-state",
        "z": "e3330cd1.4ad86",
        "name": "Home?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "Home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 460,
        "y": 1300,
        "wires": [
            [
                "591c80c8.d0129"
            ],
            []
        ]
    },
    {
        "id": "53d088ba.144778",
        "type": "inject",
        "z": "44e40327.1945ec",
        "name": "25 Mins",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1500",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"timer\"}",
        "payloadType": "json",
        "x": 100,
        "y": 200,
        "wires": [
            [
                "f173554.26e1fa8"
            ]
        ]
    },
    {
        "id": "f173554.26e1fa8",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Away?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "Away",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload.home",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 250,
        "y": 200,
        "wires": [
            [
                "a7ba583d.b71538",
                "d00a2ef6.ed692",
                "db186e4c.421d58"
            ],
            [
                "2ebe7ef6.ba6322"
            ]
        ]
    },
    {
        "id": "a7ba583d.b71538",
        "type": "time-range-switch",
        "z": "44e40327.1945ec",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "sunsetStart",
        "endTime": "23:15",
        "startOffset": 0,
        "endOffset": 0,
        "x": 470,
        "y": 200,
        "wires": [
            [
                "ff2e685c.10a3c"
            ],
            []
        ]
    },
    {
        "id": "854a1fa.f2b35e",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Light List",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.security_lights",
        "state_type": "str",
        "state_location": "payload.group_light_state",
        "override_payload": "msg",
        "entity_location": "payload.light_list",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 820,
        "y": 200,
        "wires": [
            [
                "556cfa4d.c17684"
            ]
        ]
    },
    {
        "id": "ff2e685c.10a3c",
        "type": "delay",
        "z": "44e40327.1945ec",
        "name": "",
        "pauseType": "random",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "0",
        "randomLast": "10",
        "randomUnits": "minutes",
        "drop": false,
        "x": 660,
        "y": 200,
        "wires": [
            [
                "854a1fa.f2b35e"
            ]
        ]
    },
    {
        "id": "7e863993.4e1e4",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Light to change",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "payload.light_list.attributes.entity_id[$$.payload.randomno]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "security.light_to_change",
                "pt": "global",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1160,
        "y": 200,
        "wires": [
            [
                "a0cf2109.f18d4"
            ]
        ]
    },
    {
        "id": "a0cf2109.f18d4",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Get Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "payload.light_to_change_state",
        "override_payload": "msg",
        "entity_location": "payload.light_to_change_data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1340,
        "y": 200,
        "wires": [
            [
                "a28cf007.5089a"
            ]
        ]
    },
    {
        "id": "a28cf007.5089a",
        "type": "ha-get-entities",
        "z": "44e40327.1945ec",
        "server": "86fae200.61af7",
        "name": "Switched On Lights",
        "rules": [
            {
                "property": "entity_id",
                "logic": "in_group",
                "value": "group.security_lights",
                "valueType": "str"
            },
            {
                "property": "state",
                "logic": "is",
                "value": "on",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": true,
        "output_location_type": "msg",
        "output_location": "payload.switched_on_lights",
        "output_results_count": 1,
        "x": 1530,
        "y": 200,
        "wires": [
            [
                "b55acd.7b3e753"
            ]
        ]
    },
    {
        "id": "c3e75775.5f10e8",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Count Switched On",
        "rules": [
            {
                "t": "set",
                "p": "payload.switched_on_count",
                "pt": "msg",
                "to": "$count($$.payload.switched_on_lights)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "security.switched_on_count",
                "pt": "global",
                "to": "payload.switched_on_count",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "security.light_to_change_state",
                "pt": "global",
                "to": "payload.light_to_change_state",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 452,
        "wires": [
            [
                "ab7d2c95.01446"
            ]
        ]
    },
    {
        "id": "ab7d2c95.01446",
        "type": "switch",
        "z": "44e40327.1945ec",
        "name": "Decisions",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "$$.payload.switched_on_count < 3 \t  and $$.payload.light_to_change_state = \"off\"",
                "vt": "jsonata"
            },
            {
                "t": "jsonata_exp",
                "v": "$$.payload.switched_on_count > 1 \t  and $$.payload.light_to_change_state = \"on\"",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 460,
        "y": 452,
        "wires": [
            [
                "4b12d71d.206df8"
            ],
            [
                "4b12d71d.206df8"
            ],
            [
                "47dba30f.cbabfc"
            ]
        ]
    },
    {
        "id": "47dba30f.cbabfc",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Failed",
        "rules": [
            {
                "t": "set",
                "p": "payload.result",
                "pt": "msg",
                "to": "Failed",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 492,
        "wires": [
            []
        ]
    },
    {
        "id": "4b12d71d.206df8",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Success",
        "rules": [
            {
                "t": "set",
                "p": "payload.result",
                "pt": "msg",
                "to": "Success",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "security.result",
                "pt": "global",
                "to": "payload.result",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 432,
        "wires": [
            [
                "2b5e43f4.e0b25c",
                "d102e949.75abd8"
            ]
        ]
    },
    {
        "id": "556cfa4d.c17684",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "random",
        "rules": [
            {
                "t": "set",
                "p": "payload.randomno",
                "pt": "msg",
                "to": "$floor($random()*($count($$.payload.light_list.attributes.entity_id)))",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 200,
        "wires": [
            [
                "7e863993.4e1e4"
            ]
        ]
    },
    {
        "id": "8a5289e9.f44638",
        "type": "inject",
        "z": "44e40327.1945ec",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"forced\",\"randomno\":2,\"group_light_state\":\"on\",\"light_list\":{\"entity_id\":\"group.security_lights\",\"state\":\"on\",\"attributes\":{\"entity_id\":[\"light.main_light\",\"light.side_light\",\"light.table_light\",\"light.bedroom_light\"],\"order\":1,\"friendly_name\":\"Security Lights\"},\"last_changed\":\"2020-01-02T09:42:02.261706+00:00\",\"last_updated\":\"2020-01-02T09:42:02.261706+00:00\",\"context\":{\"id\":\"6916cc9951174af4a0413a33589e2e10\",\"parent_id\":null,\"user_id\":null},\"timeSinceChangedMs\":3241730}}",
        "payloadType": "json",
        "x": 990,
        "y": 120,
        "wires": [
            [
                "7e863993.4e1e4"
            ]
        ]
    },
    {
        "id": "1550b3f9.d3b88c",
        "type": "inject",
        "z": "44e40327.1945ec",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"forced\",\"group_light_state\":\"on\",\"light_list\":{\"entity_id\":\"group.security_lights\",\"state\":\"on\",\"attributes\":{\"entity_id\":[\"light.main_light\",\"light.side_light\",\"light.table_light\",\"light.bedroom_light\"],\"order\":1,\"friendly_name\":\"Security Lights\"},\"last_changed\":\"2020-01-02T09:42:02.261706+00:00\",\"last_updated\":\"2020-01-02T09:42:02.261706+00:00\",\"context\":{\"id\":\"6916cc9951174af4a0413a33589e2e10\",\"parent_id\":null,\"user_id\":null},\"timeSinceChangedMs\":3241730}}",
        "payloadType": "json",
        "x": 830,
        "y": 120,
        "wires": [
            [
                "556cfa4d.c17684"
            ]
        ]
    },
    {
        "id": "739ffa46.af9114",
        "type": "api-call-service",
        "z": "44e40327.1945ec",
        "name": "Toggle Light",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "toggle",
        "entityId": "",
        "data": "{\"entity_id\":\"{{topic}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 970,
        "y": 432,
        "wires": [
            [
                "7f52186f.90b808",
                "222f5e47.691ed2"
            ]
        ]
    },
    {
        "id": "ebc03d13.56904",
        "type": "inject",
        "z": "44e40327.1945ec",
        "name": "force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"initiator\":\"forced\"}",
        "payloadType": "json",
        "x": 670,
        "y": 120,
        "wires": [
            [
                "854a1fa.f2b35e"
            ]
        ]
    },
    {
        "id": "2b5e43f4.e0b25c",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Not Home?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "not_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.presence_all",
        "state_type": "str",
        "state_location": "payload.home",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 790,
        "y": 432,
        "wires": [
            [
                "739ffa46.af9114"
            ],
            []
        ]
    },
    {
        "id": "d102e949.75abd8",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "When Changed",
        "rules": [
            {
                "t": "set",
                "p": "security.when_changed",
                "pt": "global",
                "to": "$now()",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 392,
        "wires": [
            []
        ]
    },
    {
        "id": "d00a2ef6.ed692",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "When Checked",
        "rules": [
            {
                "t": "set",
                "p": "security.when_checked",
                "pt": "global",
                "to": "$now()",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 140,
        "wires": [
            []
        ]
    },
    {
        "id": "7f52186f.90b808",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been toggled by Burglar - Random",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1150,
        "y": 432,
        "wires": [
            [
                "7dca670f.0085d8"
            ]
        ]
    },
    {
        "id": "7dca670f.0085d8",
        "type": "link out",
        "z": "44e40327.1945ec",
        "name": "Security",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1715,
        "y": 400,
        "wires": []
    },
    {
        "id": "72c75a69.fda914",
        "type": "link in",
        "z": "44e40327.1945ec",
        "name": "A2",
        "links": [
            "b55acd.7b3e753"
        ],
        "x": 90,
        "y": 452,
        "wires": [
            [
                "c3e75775.5f10e8"
            ]
        ],
        "l": true
    },
    {
        "id": "b55acd.7b3e753",
        "type": "link out",
        "z": "44e40327.1945ec",
        "name": "A1",
        "links": [
            "72c75a69.fda914"
        ],
        "x": 1750,
        "y": 200,
        "wires": [],
        "l": true
    },
    {
        "id": "db186e4c.421d58",
        "type": "time-range-switch",
        "z": "44e40327.1945ec",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "23:30",
        "endTime": "sunriseEnd",
        "startOffset": 0,
        "endOffset": 0,
        "x": 470,
        "y": 280,
        "wires": [
            [
                "18eec9de.79df16"
            ],
            []
        ]
    },
    {
        "id": "d563e17b.a35638",
        "type": "delay",
        "z": "44e40327.1945ec",
        "name": "",
        "pauseType": "random",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "0",
        "randomLast": "10",
        "randomUnits": "minutes",
        "drop": false,
        "x": 880,
        "y": 280,
        "wires": [
            [
                "c58b9796.64b7e8"
            ]
        ]
    },
    {
        "id": "ecfc8952.517c5",
        "type": "api-call-service",
        "z": "44e40327.1945ec",
        "name": "Turn Off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{topic}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1420,
        "y": 280,
        "wires": [
            [
                "d6e9bb78.04a0d8"
            ]
        ]
    },
    {
        "id": "d6e9bb78.04a0d8",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned off by Burglar - Random",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1590,
        "y": 280,
        "wires": [
            [
                "7dca670f.0085d8"
            ]
        ]
    },
    {
        "id": "c58b9796.64b7e8",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Light to change",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "group.security_lights",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "security.light_to_change",
                "pt": "global",
                "to": "topic",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 280,
        "wires": [
            [
                "8359013d.81e8b8"
            ]
        ]
    },
    {
        "id": "18eec9de.79df16",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Security Lights On?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.security_lights",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 690,
        "y": 280,
        "wires": [
            [
                "d563e17b.a35638"
            ],
            []
        ]
    },
    {
        "id": "8359013d.81e8b8",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Not Home?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "not_home",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "group.presence_all",
        "state_type": "str",
        "state_location": "payload.home",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1250,
        "y": 280,
        "wires": [
            [
                "ecfc8952.517c5"
            ],
            []
        ]
    },
    {
        "id": "222f5e47.691ed2",
        "type": "ha-get-entities",
        "z": "44e40327.1945ec",
        "server": "86fae200.61af7",
        "name": "Switched On Lights",
        "rules": [
            {
                "property": "entity_id",
                "logic": "in_group",
                "value": "group.security_lights",
                "valueType": "str"
            },
            {
                "property": "state",
                "logic": "is",
                "value": "on",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": true,
        "output_location_type": "msg",
        "output_location": "payload.switched_on_lights",
        "output_results_count": 1,
        "x": 1170,
        "y": 472,
        "wires": [
            [
                "ff689f1b.75884"
            ]
        ]
    },
    {
        "id": "ff689f1b.75884",
        "type": "api-call-service",
        "z": "44e40327.1945ec",
        "name": "Set Count",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_number",
        "service": "set_value",
        "entityId": "input_number.security_lights",
        "data": "{\"entity_id\":\"input_number.security_lights\", \"value\":$count($$.payload.switched_on_lights)}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1360,
        "y": 472,
        "wires": [
            []
        ]
    },
    {
        "id": "8f0d7a83.b33cb8",
        "type": "inject",
        "z": "44e40327.1945ec",
        "name": "Force",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 970,
        "y": 472,
        "wires": [
            [
                "222f5e47.691ed2"
            ]
        ]
    },
    {
        "id": "2ebe7ef6.ba6322",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Not 0?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "0",
        "halt_if_type": "num",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "input_number.security_lights",
        "state_type": "str",
        "state_location": "payload.home",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 430,
        "y": 340,
        "wires": [
            [
                "56e7dc1d.2be514"
            ],
            []
        ]
    },
    {
        "id": "56e7dc1d.2be514",
        "type": "api-call-service",
        "z": "44e40327.1945ec",
        "name": "Set 0",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_number",
        "service": "set_value",
        "entityId": "input_number.security_lights",
        "data": "{\"entity_id\":\"input_number.security_lights\", \"value\":0}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 570,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "b61c0636.7d0038",
        "type": "change",
        "z": "44e40327.1945ec",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "motion",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "activated over night",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Front Door",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 620,
        "wires": [
            [
                "c4665cee.224fb"
            ]
        ]
    },
    {
        "id": "c4665cee.224fb",
        "type": "link out",
        "z": "44e40327.1945ec",
        "name": "Front Door",
        "links": [
            "7ca2c4f3.2c7b4c"
        ],
        "x": 575,
        "y": 620,
        "wires": []
    },
    {
        "id": "b99a4083.10a09",
        "type": "inject",
        "z": "44e40327.1945ec",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 150,
        "y": 580,
        "wires": [
            [
                "5ca45fd0.2a8d5"
            ]
        ]
    },
    {
        "id": "5ca45fd0.2a8d5",
        "type": "api-current-state",
        "z": "44e40327.1945ec",
        "name": "Night",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "Night",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 290,
        "y": 620,
        "wires": [
            [
                "b61c0636.7d0038"
            ],
            []
        ]
    },
    {
        "id": "669a58e1.9bd758",
        "type": "server-state-changed",
        "z": "44e40327.1945ec",
        "name": "Front Door Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.front_door_last_motion",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is_not",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 110,
        "y": 620,
        "wires": [
            [
                "5ca45fd0.2a8d5"
            ]
        ]
    },
    {
        "id": "2e382e76.1a91a2",
        "type": "server-state-changed",
        "z": "cee05142.c172e8",
        "name": "Bedroom 1 Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.geniushub_bedroom1_occupancy",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 620,
        "wires": [
            [
                "3a3502e9.e91cfe"
            ],
            [
                "14a45abb.86b6b5"
            ]
        ]
    },
    {
        "id": "3a3502e9.e91cfe",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "STOP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STOP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 600,
        "wires": [
            [
                "4ee22883.03c1f8"
            ]
        ]
    },
    {
        "id": "4ee22883.03c1f8",
        "type": "stoptimer",
        "z": "cee05142.c172e8",
        "duration": "30",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 620,
        "wires": [
            [
                "4b51255f.9745ec"
            ],
            []
        ]
    },
    {
        "id": "4b51255f.9745ec",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Get Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 840,
        "y": 720,
        "wires": [
            [
                "51ad849b.cca53c"
            ],
            []
        ]
    },
    {
        "id": "51ad849b.cca53c",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been on for 30 minutes",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 720,
        "wires": [
            [
                "8cbd826b.835b1"
            ]
        ]
    },
    {
        "id": "8cbd826b.835b1",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "Security",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1135,
        "y": 720,
        "wires": []
    },
    {
        "id": "549448ee.abb0c8",
        "type": "server-state-changed",
        "z": "cee05142.c172e8",
        "name": "Bedroom 2 Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.geniushub_bedroom2_occupancy",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 720,
        "wires": [
            [
                "9c3ee099.fe397"
            ],
            [
                "2d211f4.ffce9e"
            ]
        ]
    },
    {
        "id": "9c3ee099.fe397",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "STOP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STOP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 700,
        "wires": [
            [
                "2f718fd0.8716"
            ]
        ]
    },
    {
        "id": "2f718fd0.8716",
        "type": "stoptimer",
        "z": "cee05142.c172e8",
        "duration": "30",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 720,
        "wires": [
            [
                "4b51255f.9745ec"
            ],
            []
        ]
    },
    {
        "id": "509bf3a9.43f0dc",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Get Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 480,
        "y": 640,
        "wires": [
            [
                "4ee22883.03c1f8"
            ],
            []
        ]
    },
    {
        "id": "2320835d.ab167c",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Get Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 480,
        "y": 740,
        "wires": [
            [
                "2f718fd0.8716"
            ],
            []
        ]
    },
    {
        "id": "168b64e3.d3be8b",
        "type": "server-state-changed",
        "z": "cee05142.c172e8",
        "name": "Bedroom 3 Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.geniushub_bedroom3_occupancy",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 130,
        "y": 820,
        "wires": [
            [
                "6a5286ee.e82818"
            ],
            [
                "e3ff082a.8b3018"
            ]
        ]
    },
    {
        "id": "6a5286ee.e82818",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "STOP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STOP",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "group.bedroom_3_lights_actual",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 800,
        "wires": [
            [
                "6e5bc7e3.50ac68"
            ]
        ]
    },
    {
        "id": "a0a00bb9.530f78",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Get Light",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 480,
        "y": 840,
        "wires": [
            [
                "6e5bc7e3.50ac68"
            ],
            []
        ]
    },
    {
        "id": "6e5bc7e3.50ac68",
        "type": "stoptimer",
        "z": "cee05142.c172e8",
        "duration": "30",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 660,
        "y": 820,
        "wires": [
            [
                "4b51255f.9745ec"
            ],
            []
        ]
    },
    {
        "id": "e0e76718.d6d318",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "Force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 170,
        "y": 880,
        "wires": [
            [
                "e3ff082a.8b3018"
            ]
        ]
    },
    {
        "id": "14a45abb.86b6b5",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set Light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "group.bedroom_1_lights_actual",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 640,
        "wires": [
            [
                "509bf3a9.43f0dc"
            ]
        ]
    },
    {
        "id": "2d211f4.ffce9e",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set Light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "group.bedroom_2_lights_actual",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 740,
        "wires": [
            [
                "2320835d.ab167c"
            ]
        ]
    },
    {
        "id": "e3ff082a.8b3018",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set Light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "group.bedroom_3_lights_actual",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 320,
        "y": 840,
        "wires": [
            [
                "a0a00bb9.530f78"
            ]
        ]
    },
    {
        "id": "3ead8673.bcb65a",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "off",
        "props": [
            {
                "p": "payload",
                "v": "false",
                "vt": "bool"
            },
            {
                "p": "topic",
                "v": "binary_sensor.internet",
                "vt": "string"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "binary_sensor.internet",
        "payload": "false",
        "payloadType": "bool",
        "x": 150,
        "y": 120,
        "wires": [
            [
                "d2c555b.80da7a8"
            ]
        ]
    },
    {
        "id": "d2c555b.80da7a8",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "internet",
        "rules": [
            {
                "t": "set",
                "p": "flow.response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "flow.component",
                "pt": "msg",
                "to": "internet",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.pretty_component",
                "pt": "msg",
                "to": "Internet",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.input_entity",
                "pt": "msg",
                "to": "input_boolean.internet",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 220,
        "wires": [
            [
                "b25d9ba4.f99428"
            ]
        ]
    },
    {
        "id": "29999164.6c1d1e",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Down",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": flow.pretty_component &  \" down - Time: \" & flow.downtime}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 220,
        "wires": [
            [
                "9113071d.a339e8",
                "bda0d914.760fa8"
            ]
        ]
    },
    {
        "id": "9113071d.a339e8",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Notification ID",
        "rules": [
            {
                "t": "set",
                "p": "flow.message.notification_id",
                "pt": "msg",
                "to": "flow.component",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 220,
        "wires": [
            [
                "48298a8a.fb9eb4"
            ]
        ]
    },
    {
        "id": "48298a8a.fb9eb4",
        "type": "api-call-service",
        "z": "cee05142.c172e8",
        "name": "Send to HA",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "persistent_notification",
        "service": "create",
        "entityId": "",
        "data": "flow.message",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1170,
        "y": 220,
        "wires": [
            [
                "be1a5761.d88918"
            ]
        ]
    },
    {
        "id": "be1a5761.d88918",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "flow.pretty_component",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has gone offline - Time: \" & flow.downtime",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Component",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1370,
        "y": 220,
        "wires": [
            [
                "545dfea7.a28c"
            ]
        ]
    },
    {
        "id": "545dfea7.a28c",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "Component Down",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1570,
        "y": 280,
        "wires": [],
        "l": true
    },
    {
        "id": "83cc845b.37e988",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Up",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": flow.pretty_component &  \" up - Time: \" & flow.uptime}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 810,
        "y": 340,
        "wires": [
            [
                "e9807c09.b1139",
                "bda0d914.760fa8"
            ]
        ]
    },
    {
        "id": "e9807c09.b1139",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Notification ID",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"notification_id\":flow.component}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 340,
        "wires": [
            [
                "a9f9ca72.31aa88"
            ]
        ]
    },
    {
        "id": "a9f9ca72.31aa88",
        "type": "api-call-service",
        "z": "cee05142.c172e8",
        "name": "Dismiss to HA",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "persistent_notification",
        "service": "dismiss",
        "entityId": "",
        "data": "flow.message",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1180,
        "y": 340,
        "wires": [
            [
                "b830498c.062018"
            ]
        ]
    },
    {
        "id": "b830498c.062018",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "flow.pretty_component",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has come back online - Time: \" & flow.uptime",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Component",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1370,
        "y": 340,
        "wires": [
            [
                "545dfea7.a28c"
            ]
        ]
    },
    {
        "id": "7d72497a.3783c8",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "on",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "binary_sensor.internet",
        "payload": "true",
        "payloadType": "bool",
        "x": 150,
        "y": 160,
        "wires": [
            [
                "d2c555b.80da7a8"
            ]
        ]
    },
    {
        "id": "ce45fc89.3f7da",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "hue",
        "rules": [
            {
                "t": "set",
                "p": "flow.response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "flow.component",
                "pt": "msg",
                "to": "hue",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.pretty_component",
                "pt": "msg",
                "to": "Philips Hue",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.input_entity",
                "pt": "msg",
                "to": "input_boolean.hue",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 380,
        "wires": [
            [
                "b25d9ba4.f99428"
            ]
        ]
    },
    {
        "id": "bda0d914.760fa8",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": "Internet",
        "property": "flow.component",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "internet",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 960,
        "y": 280,
        "wires": [
            [],
            [
                "25faa32c.12443c"
            ]
        ]
    },
    {
        "id": "ea3ec4a.71b5838",
        "type": "ping",
        "z": "cee05142.c172e8",
        "mode": "timed",
        "name": "Hue",
        "host": "philips-hue.local",
        "timer": "20",
        "inputs": 0,
        "x": 150,
        "y": 380,
        "wires": [
            [
                "ce45fc89.3f7da"
            ]
        ]
    },
    {
        "id": "419d2e04.8dd8",
        "type": "ping",
        "z": "cee05142.c172e8",
        "mode": null,
        "name": "Internet",
        "host": "8.8.8.8",
        "timer": "20",
        "inputs": 0,
        "x": 150,
        "y": 220,
        "wires": [
            [
                "d2c555b.80da7a8"
            ]
        ]
    },
    {
        "id": "12219d9a.59bc12",
        "type": "api-call-service",
        "z": "cee05142.c172e8",
        "name": "Up",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "{{flow.input_entity}}",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 810,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "d8808e9b.610de",
        "type": "api-call-service",
        "z": "cee05142.c172e8",
        "name": "Down",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "{{flow.input_entity}}",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 810,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "e82c4ee9.7cf7e",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Marked Down?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{flow.input_entity}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 640,
        "y": 340,
        "wires": [
            [
                "83cc845b.37e988",
                "12219d9a.59bc12"
            ],
            []
        ]
    },
    {
        "id": "6bc9417a.34243",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Marked Up?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{flow.input_entity}}",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 630,
        "y": 220,
        "wires": [
            [
                "29999164.6c1d1e",
                "d8808e9b.610de"
            ],
            []
        ]
    },
    {
        "id": "782e08f4.33ca48",
        "type": "gc-trigger",
        "z": "cee05142.c172e8",
        "display": true,
        "name": "",
        "x": 290,
        "y": 1000,
        "wires": [
            [
                "6c92bf49.1157d"
            ]
        ]
    },
    {
        "id": "147b4bd8.29dd84",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 1000,
        "wires": [
            [
                "782e08f4.33ca48"
            ]
        ]
    },
    {
        "id": "6c92bf49.1157d",
        "type": "debug",
        "z": "cee05142.c172e8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 470,
        "y": 1000,
        "wires": []
    },
    {
        "id": "ed24ebf1.fd409",
        "type": "ping",
        "z": "cee05142.c172e8",
        "d": true,
        "mode": "timed",
        "name": "DLan DR",
        "host": "192.168.1.215",
        "timer": "20",
        "inputs": 0,
        "x": 140,
        "y": 260,
        "wires": [
            [
                "ca3b17d5.1157f8"
            ]
        ]
    },
    {
        "id": "ca3b17d5.1157f8",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "dlan_dr",
        "rules": [
            {
                "t": "set",
                "p": "flow.response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "flow.component",
                "pt": "msg",
                "to": "dlan_dr",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.pretty_component",
                "pt": "msg",
                "to": "Devolo Dining Room",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.input_entity",
                "pt": "msg",
                "to": "input_boolean.dlan_dr",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 260,
        "wires": [
            [
                "b25d9ba4.f99428"
            ]
        ]
    },
    {
        "id": "aef36b8a.45ecb8",
        "type": "ha-get-entities",
        "z": "cee05142.c172e8",
        "server": "86fae200.61af7",
        "name": "Restored",
        "rules": [
            {
                "property": "attributes.restored",
                "logic": "is",
                "value": "true",
                "valueType": "bool"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 280,
        "y": 1120,
        "wires": [
            [
                "cb0d7943.4d2be8",
                "1b906018.0db39"
            ]
        ]
    },
    {
        "id": "cb0d7943.4d2be8",
        "type": "debug",
        "z": "cee05142.c172e8",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 450,
        "y": 1080,
        "wires": []
    },
    {
        "id": "2901ad50.9e24b2",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "Hourly",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 120,
        "y": 1120,
        "wires": [
            [
                "aef36b8a.45ecb8",
                "ad58572d.836768"
            ]
        ]
    },
    {
        "id": "1b906018.0db39",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Message",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"Restored entities\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 1120,
        "wires": [
            [
                "b7caba5e.abd198"
            ]
        ]
    },
    {
        "id": "6fdbafd9.c75bd",
        "type": "ping",
        "z": "cee05142.c172e8",
        "mode": "timed",
        "name": "UPS",
        "host": "192.168.1.40",
        "timer": "20",
        "inputs": 0,
        "x": 150,
        "y": 300,
        "wires": [
            [
                "88719bfd.d5b2f8"
            ]
        ]
    },
    {
        "id": "88719bfd.d5b2f8",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "ups",
        "rules": [
            {
                "t": "set",
                "p": "flow.response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "flow.component",
                "pt": "msg",
                "to": "ups",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.pretty_component",
                "pt": "msg",
                "to": "UPS",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.input_entity",
                "pt": "msg",
                "to": "input_boolean.ups",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "120000",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 300,
        "wires": [
            [
                "b25d9ba4.f99428"
            ]
        ]
    },
    {
        "id": "b25d9ba4.f99428",
        "type": "subflow:e6937ad1.654d78",
        "z": "cee05142.c172e8",
        "name": "",
        "env": [],
        "x": 460,
        "y": 280,
        "wires": [
            [
                "6bc9417a.34243"
            ],
            [
                "e82c4ee9.7cf7e"
            ],
            [
                "254dfaa.e9f2406"
            ]
        ]
    },
    {
        "id": "f40bf959.8f4b48",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "3am",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 03 * * 1,2,3,4,5,6",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 140,
        "wires": [
            [
                "e444fdcf.99d69"
            ]
        ]
    },
    {
        "id": "e444fdcf.99d69",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Setup",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "'Hassio (' & $now('[Y01].[M01].[D01] [H01]:[m01]:[s01]') &')'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "data",
                "pt": "msg",
                "to": "{\t   \"name\": topic & \" Folders\",\t   \"folders\":[\t       \"ssl\",\t       \"homeassistant\",\t       \"addons/local\"    \t   ] \t}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 140,
        "wires": [
            [
                "4f482db9.e3fea4",
                "8ea97b7b.fa0268"
            ]
        ]
    },
    {
        "id": "4f482db9.e3fea4",
        "type": "delay",
        "z": "26d43138.aa613e",
        "name": "",
        "pauseType": "delay",
        "timeout": "15",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 450,
        "y": 200,
        "wires": [
            [
                "37e2ca82.729996"
            ]
        ]
    },
    {
        "id": "37e2ca82.729996",
        "type": "api-call-service",
        "z": "26d43138.aa613e",
        "name": "Dropbox Sync",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "hassio",
        "service": "addon_stdin",
        "entityId": "",
        "data": "{\"addon\":\"5e634bc9_dropbox_sync\",\"input\":{\"command\":\"upload\"}}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 640,
        "y": 200,
        "wires": [
            [
                "f131c25f.badf7"
            ]
        ]
    },
    {
        "id": "f131c25f.badf7",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Dropbox Sync",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been initiated",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Hassio ",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 200,
        "wires": [
            [
                "6c670b2a.531f94"
            ]
        ]
    },
    {
        "id": "6c670b2a.531f94",
        "type": "link out",
        "z": "26d43138.aa613e",
        "name": "Security",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1395,
        "y": 140,
        "wires": []
    },
    {
        "id": "14cf38e4.665097",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been initiated",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Hassio Folder Snapshot",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 140,
        "wires": [
            [
                "6c670b2a.531f94"
            ]
        ]
    },
    {
        "id": "e12dc611.ac1af8",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "Force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 470,
        "y": 260,
        "wires": [
            [
                "37e2ca82.729996"
            ]
        ]
    },
    {
        "id": "7ba966ec.261e98",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "3am",
        "repeat": "",
        "crontab": "00 03 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 580,
        "wires": [
            [
                "cc87f17f.af7bf",
                "782ef7c8.b3f7e8"
            ]
        ]
    },
    {
        "id": "cc87f17f.af7bf",
        "type": "api-current-state",
        "z": "26d43138.aa613e",
        "name": "S1 State",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": true,
        "entity_id": "switch.zwave_living_room_main_light_switch",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 280,
        "y": 540,
        "wires": [
            [],
            [
                "277652.6d7489ae"
            ]
        ]
    },
    {
        "id": "782ef7c8.b3f7e8",
        "type": "api-current-state",
        "z": "26d43138.aa613e",
        "name": "S2 State",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": true,
        "entity_id": "switch.zwave_living_room_side_light_switch",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 280,
        "y": 620,
        "wires": [
            [],
            [
                "277652.6d7489ae"
            ]
        ]
    },
    {
        "id": "277652.6d7489ae",
        "type": "api-call-service",
        "z": "26d43138.aa613e",
        "name": "Power Switch On",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_on",
        "entityId": "",
        "data": "{\"entity_id\":\"{{data.entity_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "payload",
        "output_location_type": "msg",
        "mustacheAltTags": false,
        "x": 470,
        "y": 580,
        "wires": [
            [
                "90a77d48.a975c",
                "e309d074.e13df"
            ]
        ]
    },
    {
        "id": "d94ce942.b15cc8",
        "type": "switch",
        "z": "26d43138.aa613e",
        "name": "Check Switch",
        "property": "data.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "switch.zwave_living_room_main_light_switch",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "switch.zwave_living_room_side_light_switch",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 840,
        "y": 640,
        "wires": [
            [
                "d565ee69.7de08"
            ],
            [
                "c40e46a6.2d9e18",
                "5e7e408.700fd4"
            ]
        ]
    },
    {
        "id": "e309d074.e13df",
        "type": "delay",
        "z": "26d43138.aa613e",
        "name": "",
        "pauseType": "delay",
        "timeout": "2",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 660,
        "y": 640,
        "wires": [
            [
                "d94ce942.b15cc8"
            ]
        ]
    },
    {
        "id": "351d621f.7b6efe",
        "type": "api-call-service",
        "z": "26d43138.aa613e",
        "name": "Turn off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "light",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{topic}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1200,
        "y": 660,
        "wires": [
            [
                "a25f0812.261ba8"
            ]
        ]
    },
    {
        "id": "90a77d48.a975c",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned on by Tidy Up",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Switch",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 580,
        "wires": [
            [
                "3a1c1d56.fe2a02"
            ]
        ]
    },
    {
        "id": "3a1c1d56.fe2a02",
        "type": "link out",
        "z": "26d43138.aa613e",
        "name": "Power Switch",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 795,
        "y": 580,
        "wires": []
    },
    {
        "id": "a25f0812.261ba8",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been turned off by Tidy Up",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Light",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1370,
        "y": 660,
        "wires": [
            [
                "439335b8.5d46bc"
            ]
        ]
    },
    {
        "id": "439335b8.5d46bc",
        "type": "link out",
        "z": "26d43138.aa613e",
        "name": "Light",
        "links": [
            "7f717e3f.49fa4"
        ],
        "x": 1495,
        "y": 660,
        "wires": []
    },
    {
        "id": "d565ee69.7de08",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Main Light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "light.main_light",
                "tot": "str"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 600,
        "wires": [
            [
                "351d621f.7b6efe"
            ]
        ]
    },
    {
        "id": "c40e46a6.2d9e18",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Side Light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "light.side_light",
                "tot": "str"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 660,
        "wires": [
            [
                "351d621f.7b6efe"
            ]
        ]
    },
    {
        "id": "8ea97b7b.fa0268",
        "type": "api-call-service",
        "z": "26d43138.aa613e",
        "name": "Folder Snapshot",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "hassio",
        "service": "snapshot_partial",
        "entityId": "",
        "data": "data",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 440,
        "y": 140,
        "wires": [
            [
                "14cf38e4.665097",
                "1b19e15.0f0751f"
            ]
        ]
    },
    {
        "id": "47ce53c7.8c435c",
        "type": "api-call-service",
        "z": "26d43138.aa613e",
        "name": "Other Snapshot",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "hassio",
        "service": "snapshot_partial",
        "entityId": "",
        "data": "{\"name\": topic & \" Addons\",\"addons\": addons}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1080,
        "y": 80,
        "wires": [
            [
                "fe745d0e.ebdef"
            ]
        ]
    },
    {
        "id": "1b19e15.0f0751f",
        "type": "delay",
        "z": "26d43138.aa613e",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "minutes",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 620,
        "y": 80,
        "wires": [
            [
                "bc40f310.8edd4"
            ]
        ]
    },
    {
        "id": "53974b20.728dd4",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "Force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 340,
        "wires": [
            [
                "3362e282.f1ba6e"
            ]
        ]
    },
    {
        "id": "fbe782a9.870dd",
        "type": "split",
        "z": "26d43138.aa613e",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 400,
        "wires": [
            [
                "aeb38500.b74068"
            ]
        ]
    },
    {
        "id": "9a13e07c.b8714",
        "type": "join",
        "z": "26d43138.aa613e",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "addons",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "2",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 890,
        "y": 400,
        "wires": [
            [
                "4caff2b7.22f23c"
            ]
        ]
    },
    {
        "id": "51669461.d4263c",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Extract",
        "rules": [
            {
                "t": "set",
                "p": "addons",
                "pt": "msg",
                "to": "payload.slug",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 740,
        "y": 400,
        "wires": [
            [
                "9a13e07c.b8714"
            ]
        ]
    },
    {
        "id": "aeb38500.b74068",
        "type": "switch",
        "z": "26d43138.aa613e",
        "name": "",
        "property": "payload.slug",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "62c7908d_ozwdaemon",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "a0d7b954_adguard",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "core_mariadb",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 590,
        "y": 400,
        "wires": [
            [],
            [],
            [],
            [
                "51669461.d4263c"
            ]
        ]
    },
    {
        "id": "7fae7d14.6be9e4",
        "type": "link in",
        "z": "26d43138.aa613e",
        "name": "A2",
        "links": [
            "bc40f310.8edd4"
        ],
        "x": 130,
        "y": 400,
        "wires": [
            [
                "3362e282.f1ba6e"
            ]
        ],
        "l": true
    },
    {
        "id": "678646a6.2a9188",
        "type": "link out",
        "z": "26d43138.aa613e",
        "name": "B1",
        "links": [
            "61f04ffc.4cba7"
        ],
        "x": 1230,
        "y": 400,
        "wires": [],
        "l": true
    },
    {
        "id": "bc40f310.8edd4",
        "type": "link out",
        "z": "26d43138.aa613e",
        "name": "A1",
        "links": [
            "7fae7d14.6be9e4"
        ],
        "x": 770,
        "y": 80,
        "wires": [],
        "l": true
    },
    {
        "id": "61f04ffc.4cba7",
        "type": "link in",
        "z": "26d43138.aa613e",
        "name": "B2",
        "links": [
            "678646a6.2a9188"
        ],
        "x": 910,
        "y": 80,
        "wires": [
            [
                "47ce53c7.8c435c"
            ]
        ],
        "l": true
    },
    {
        "id": "fe745d0e.ebdef",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "has been initiated",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Hassio Addon Snapshot",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1270,
        "y": 80,
        "wires": [
            [
                "6c670b2a.531f94"
            ]
        ]
    },
    {
        "id": "5e7e408.700fd4",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "TV Light",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "light.tv_light",
                "tot": "str"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 720,
        "wires": [
            [
                "351d621f.7b6efe"
            ]
        ]
    },
    {
        "id": "28d647c.3dee2b8",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 850,
        "y": 540,
        "wires": [
            [
                "d565ee69.7de08"
            ]
        ]
    },
    {
        "id": "df3d6d08.83ea5",
        "type": "comment",
        "z": "26d43138.aa613e",
        "name": "Snapshot & Backup to Dropbox",
        "info": "",
        "x": 200,
        "y": 80,
        "wires": []
    },
    {
        "id": "5281c01f.a5de3",
        "type": "comment",
        "z": "26d43138.aa613e",
        "name": "Make sure light switches are on",
        "info": "",
        "x": 190,
        "y": 480,
        "wires": []
    },
    {
        "id": "daf5467.b4cd4b8",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Presence",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.tyrcelyn_presence_all",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 80,
        "y": 240,
        "wires": [
            [
                "bb5a0a3f.e37908"
            ],
            [
                "dd1250d7.f1996"
            ]
        ]
    },
    {
        "id": "bb5a0a3f.e37908",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "STOP",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "STOP",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 220,
        "wires": [
            [
                "dd1250d7.f1996",
                "dcb992c6.858b5"
            ]
        ]
    },
    {
        "id": "dd1250d7.f1996",
        "type": "stoptimer",
        "z": "a2c447a7.7afa68",
        "duration": "30",
        "units": "Minute",
        "payloadtype": "num",
        "payloadval": "0",
        "name": "",
        "x": 400,
        "y": 240,
        "wires": [
            [
                "d945217e.414be"
            ],
            []
        ]
    },
    {
        "id": "d945217e.414be",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Get Entity",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 580,
        "y": 240,
        "wires": [
            [
                "fb9a2b44.16d028"
            ]
        ]
    },
    {
        "id": "a4f3c5ed.e2b378",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Get Entity",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{topic}}",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 1040,
        "y": 240,
        "wires": [
            [
                "76504f2a.e1d85"
            ]
        ]
    },
    {
        "id": "dfd8916.3426e7",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set Entity",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "climate.tyr_celyn",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 240,
        "wires": [
            [
                "a4f3c5ed.e2b378"
            ]
        ]
    },
    {
        "id": "fb9a2b44.16d028",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "property": "data.timeSinceChangedMs",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "30000",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 240,
        "wires": [
            [
                "dfd8916.3426e7"
            ],
            []
        ]
    },
    {
        "id": "6e14ba5a.c8de24",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "binary_sensor.tyrcelyn_presence_all",
        "payload": "",
        "payloadType": "str",
        "x": 270,
        "y": 340,
        "wires": [
            [
                "bff84538.7a8e18"
            ]
        ]
    },
    {
        "id": "80b7fd5d.f7ab8",
        "type": "time-range-switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "22:30",
        "endTime": "06:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 440,
        "wires": [
            [
                "8a520411.015038"
            ],
            [
                "ec7f966b.0bce58"
            ]
        ]
    },
    {
        "id": "76504f2a.e1d85",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "A1",
        "links": [
            "3b00fe93.7895c2"
        ],
        "x": 1190,
        "y": 240,
        "wires": [],
        "l": true
    },
    {
        "id": "3b00fe93.7895c2",
        "type": "link in",
        "z": "a2c447a7.7afa68",
        "name": "A2",
        "links": [
            "76504f2a.e1d85"
        ],
        "x": 90,
        "y": 440,
        "wires": [
            [
                "80b7fd5d.f7ab8"
            ]
        ],
        "l": true
    },
    {
        "id": "ec7f966b.0bce58",
        "type": "time-range-switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "06:00",
        "endTime": "10:30",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 500,
        "wires": [
            [
                "1477987.9289c68"
            ],
            [
                "5422130.bbff6ec"
            ]
        ]
    },
    {
        "id": "5422130.bbff6ec",
        "type": "time-range-switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "10:30",
        "endTime": "16:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 560,
        "wires": [
            [
                "d43e8a27.fb3888"
            ],
            [
                "110ca0d0.58474f"
            ]
        ]
    },
    {
        "id": "110ca0d0.58474f",
        "type": "time-range-switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "16:00",
        "endTime": "18:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 620,
        "wires": [
            [
                "e027ce9d.c6c7a"
            ],
            [
                "5ba4ac31.184be4"
            ]
        ]
    },
    {
        "id": "5ba4ac31.184be4",
        "type": "time-range-switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "lat": "51.33186",
        "lon": "-1.04849",
        "startTime": "18:00",
        "endTime": "22:30",
        "startOffset": 0,
        "endOffset": 0,
        "x": 250,
        "y": 680,
        "wires": [
            [
                "92a4dd36.3e8b7"
            ],
            []
        ]
    },
    {
        "id": "8a520411.015038",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "15",
        "rules": [
            {
                "t": "set",
                "p": "set_temperature",
                "pt": "msg",
                "to": "15",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 440,
        "wires": [
            [
                "ca505f49.89f06"
            ]
        ]
    },
    {
        "id": "1477987.9289c68",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "20",
        "rules": [
            {
                "t": "set",
                "p": "set_temperature",
                "pt": "msg",
                "to": "20",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 500,
        "wires": [
            [
                "ca505f49.89f06"
            ]
        ]
    },
    {
        "id": "d43e8a27.fb3888",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "17",
        "rules": [
            {
                "t": "set",
                "p": "set_temperature",
                "pt": "msg",
                "to": "17",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 560,
        "wires": [
            [
                "ca505f49.89f06"
            ]
        ]
    },
    {
        "id": "e027ce9d.c6c7a",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "19",
        "rules": [
            {
                "t": "set",
                "p": "set_temperature",
                "pt": "msg",
                "to": "19",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 620,
        "wires": [
            [
                "ca505f49.89f06"
            ]
        ]
    },
    {
        "id": "92a4dd36.3e8b7",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "21",
        "rules": [
            {
                "t": "set",
                "p": "set_temperature",
                "pt": "msg",
                "to": "21",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 680,
        "wires": [
            [
                "ca505f49.89f06"
            ]
        ]
    },
    {
        "id": "ca505f49.89f06",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "",
        "property": "data.attributes.temperature",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "set_temperature+1.5",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 550,
        "y": 560,
        "wires": [
            [
                "de2e4e86.54532"
            ],
            [
                "f4247ada.457408"
            ]
        ]
    },
    {
        "id": "de2e4e86.54532",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "B1",
        "links": [
            "9b07073.caf96f8",
            "de234d1a.27633"
        ],
        "x": 690,
        "y": 540,
        "wires": [],
        "l": true
    },
    {
        "id": "9b07073.caf96f8",
        "type": "link in",
        "z": "a2c447a7.7afa68",
        "name": "B2",
        "links": [
            "de2e4e86.54532"
        ],
        "x": 90,
        "y": 780,
        "wires": [
            [
                "d51fc33.c39f64"
            ]
        ],
        "l": true
    },
    {
        "id": "bff84538.7a8e18",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "OK",
        "rules": [
            {
                "t": "set",
                "p": "tyrcelyn.heating",
                "pt": "global",
                "to": "ok",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 430,
        "y": 340,
        "wires": [
            [
                "d945217e.414be"
            ]
        ]
    },
    {
        "id": "a87d2fbd.45d8d",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "binary_sensor.tyrcelyn_presence_all",
        "payload": "",
        "payloadType": "str",
        "x": 270,
        "y": 300,
        "wires": [
            [
                "1ad7e322.e9a75d"
            ]
        ]
    },
    {
        "id": "17e704bd.1bc40b",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Send to HA",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "persistent_notification",
        "service": "create",
        "entityId": "",
        "data": "flow.message",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1010,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "16f27744.69f7f9",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Notification ID",
        "rules": [
            {
                "t": "set",
                "p": "flow.message.notification_id",
                "pt": "msg",
                "to": "tc_heating",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 840,
        "wires": [
            [
                "17e704bd.1bc40b"
            ]
        ]
    },
    {
        "id": "1ad7e322.e9a75d",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Overheat",
        "rules": [
            {
                "t": "set",
                "p": "tyrcelyn.heating",
                "pt": "global",
                "to": "overheat",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 300,
        "wires": [
            [
                "d945217e.414be"
            ]
        ]
    },
    {
        "id": "e4d1d0a7.7dc62",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has been on for 30 minutes while no-one home. Set: \" & data.attributes.temperature & \"C; Default: \" & set_temperature & \"C\" ",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Heating",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"Ty'r Celyn Heating \" & log.action}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 630,
        "y": 780,
        "wires": [
            [
                "16f27744.69f7f9",
                "2d8706d1.b5620a",
                "862c5056.f10d6"
            ]
        ]
    },
    {
        "id": "2d8706d1.b5620a",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Ty'r Celyn - Overheat Check",
        "links": [
            "47da2c24.5d5b04"
        ],
        "x": 755,
        "y": 740,
        "wires": []
    },
    {
        "id": "40646935.ceac18",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Notification ID",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"notification_id\":\"tc_heating\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 920,
        "wires": [
            [
                "96e2891b.17b658"
            ]
        ]
    },
    {
        "id": "96e2891b.17b658",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Dismiss to HA",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "persistent_notification",
        "service": "dismiss",
        "entityId": "",
        "data": "flow.message",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1020,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "8f72f439.553958",
        "type": "link in",
        "z": "a2c447a7.7afa68",
        "name": "C3",
        "links": [
            "dcb992c6.858b5",
            "f4247ada.457408"
        ],
        "x": 90,
        "y": 920,
        "wires": [
            [
                "772c5503.42cd0c"
            ]
        ],
        "l": true
    },
    {
        "id": "dcb992c6.858b5",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "C1",
        "links": [
            "8f72f439.553958"
        ],
        "x": 370,
        "y": 200,
        "wires": [],
        "l": true
    },
    {
        "id": "f4247ada.457408",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "C2",
        "links": [
            "8f72f439.553958"
        ],
        "x": 690,
        "y": 580,
        "wires": [],
        "l": true
    },
    {
        "id": "d51fc33.c39f64",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "Already recorded",
        "property": "tyrcelyn.heating",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "overheat",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 780,
        "wires": [
            [],
            [
                "2f48ce52.2ecc12"
            ]
        ]
    },
    {
        "id": "2f48ce52.2ecc12",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Overheat",
        "rules": [
            {
                "t": "set",
                "p": "tyrcelyn.heating",
                "pt": "global",
                "to": "overheat",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 780,
        "wires": [
            [
                "e4d1d0a7.7dc62"
            ]
        ]
    },
    {
        "id": "772c5503.42cd0c",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "Already recorded",
        "property": "tyrcelyn.heating",
        "propertyType": "global",
        "rules": [
            {
                "t": "eq",
                "v": "ok",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 920,
        "wires": [
            [],
            [
                "2b4fb2d8.4547be"
            ]
        ]
    },
    {
        "id": "2b4fb2d8.4547be",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "OK",
        "rules": [
            {
                "t": "set",
                "p": "tyrcelyn.heating",
                "pt": "global",
                "to": "ok",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 920,
        "wires": [
            [
                "40646935.ceac18"
            ]
        ]
    },
    {
        "id": "fb0c7f32.1dde6",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "End Booking",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "calendar.bookings",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1200,
        "wires": [
            [
                "4e5f82ed.d0b69c"
            ],
            []
        ]
    },
    {
        "id": "5e7fdd25.911c54",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Set Away",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "switch",
        "service": "turn_off",
        "entityId": "switch.home_occupied_tyr_celyn",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 640,
        "y": 1160,
        "wires": [
            [
                "589cd422.ab2fcc"
            ]
        ]
    },
    {
        "id": "e75156f0.4b9028",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Nest",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.home_occupied_tyr_celyn",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 110,
        "y": 1320,
        "wires": [
            [
                "39ef6317.0abe6c"
            ],
            [
                "d525ca9d.ff3378"
            ]
        ]
    },
    {
        "id": "589cd422.ab2fcc",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Tyr Celyn Nest Mode",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has been turned off (\" & topic & \")\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 1160,
        "wires": [
            [
                "83411108.3f9ec"
            ]
        ]
    },
    {
        "id": "83411108.3f9ec",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Ty'r Celyn - End Booking",
        "links": [
            "47da2c24.5d5b04"
        ],
        "x": 1015,
        "y": 1320,
        "wires": []
    },
    {
        "id": "39ef6317.0abe6c",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Tyr Celyn Occupancy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has turned on (Home)\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 1300,
        "wires": [
            [
                "83411108.3f9ec"
            ]
        ]
    },
    {
        "id": "572c9dfb.f024d4",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "",
        "payloadType": "date",
        "x": 290,
        "y": 1100,
        "wires": [
            [
                "b39ab024.4a7e9"
            ]
        ]
    },
    {
        "id": "633dac06.74e594",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1270,
        "wires": [
            [
                "39ef6317.0abe6c"
            ]
        ]
    },
    {
        "id": "4e5f82ed.d0b69c",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "No booking",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "calendar.bookings",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 270,
        "y": 1160,
        "wires": [
            [
                "b39ab024.4a7e9"
            ],
            []
        ]
    },
    {
        "id": "b39ab024.4a7e9",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Home",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.home_occupied_tyr_celyn",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 490,
        "y": 1160,
        "wires": [
            [
                "5e7fdd25.911c54"
            ],
            []
        ]
    },
    {
        "id": "17136123.34255f",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "0 Today",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "1",
        "halt_if_type": "num",
        "halt_if_compare": "lt",
        "override_topic": false,
        "entity_id": "input_number.tyrcelyn_bookings_today",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 260,
        "y": 1580,
        "wires": [
            [
                "77e22bfc.ee5d94"
            ],
            []
        ]
    },
    {
        "id": "77e22bfc.ee5d94",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "0 Tomorrow",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "1",
        "halt_if_type": "num",
        "halt_if_compare": "lt",
        "override_topic": false,
        "entity_id": "input_number.tyrcelyn_bookings_tomorrow",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 430,
        "y": 1580,
        "wires": [
            [
                "6e783329.1376ac"
            ],
            []
        ]
    },
    {
        "id": "481026c6.d161f8",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Nest",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "climate.tyr_celyn",
        "state_type": "str",
        "state_location": "payload.state",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 770,
        "y": 1580,
        "wires": [
            [
                "fffd25a1.e86198"
            ]
        ]
    },
    {
        "id": "fffd25a1.e86198",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "Too High",
        "property": "data.attributes.temperature",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "15",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 920,
        "y": 1580,
        "wires": [
            [
                "e93f21a4.fd2b3"
            ],
            []
        ]
    },
    {
        "id": "15d6ec5f.9b0874",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "climate.tyr_celyn_thermostat",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"is set higher than 15C while no booking. Set: \" & data.attributes.temperature & \"C. Turned down to 15C\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Heating",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 1580,
        "wires": [
            [
                "e90735bd.fc1dc8"
            ]
        ]
    },
    {
        "id": "e93f21a4.fd2b3",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Set 15C",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "climate",
        "service": "set_temperature",
        "entityId": "",
        "data": "{\"entity_id\": \"climate.tyr_celyn\",\"temperature\": 15}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1080,
        "y": 1580,
        "wires": [
            [
                "15d6ec5f.9b0874"
            ]
        ]
    },
    {
        "id": "e90735bd.fc1dc8",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Ty'r Celyn Set Point Check",
        "links": [
            "47da2c24.5d5b04"
        ],
        "x": 1375,
        "y": 1700,
        "wires": []
    },
    {
        "id": "97f6fd30.3d4ed",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "30 mins",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1800",
        "crontab": "",
        "once": false,
        "onceDelay": "10",
        "topic": "30 Min Repeat",
        "payload": "",
        "payloadType": "date",
        "x": 100,
        "y": 1120,
        "wires": [
            [
                "4e5f82ed.d0b69c"
            ]
        ]
    },
    {
        "id": "7f239a00.290bd8",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Check for heating being overriden and nobody in",
        "info": "",
        "x": 200,
        "y": 160,
        "wires": []
    },
    {
        "id": "20a79187.67068e",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Set Nest to away when booking ends.",
        "info": "",
        "x": 170,
        "y": 1040,
        "wires": []
    },
    {
        "id": "5506477.f2d95b8",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Turning heating down if no booking today/tomorrow",
        "info": "",
        "x": 210,
        "y": 1520,
        "wires": []
    },
    {
        "id": "f095745e.524d08",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Turning heating up at 15:30 on booking day",
        "info": "",
        "x": 190,
        "y": 1660,
        "wires": []
    },
    {
        "id": "c3e6f4d.0770308",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "14:30",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "30 14 * * *",
        "once": false,
        "onceDelay": "10",
        "topic": "",
        "payload": "{\"initiator\":\"timed\"}",
        "payloadType": "json",
        "x": 90,
        "y": 1700,
        "wires": [
            [
                "3dfd9f83.6ff7e"
            ]
        ]
    },
    {
        "id": "3dfd9f83.6ff7e",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Booking Today",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "override_topic": false,
        "entity_id": "input_number.tyrcelyn_bookings_today",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 280,
        "y": 1700,
        "wires": [
            [
                "5df234ab.d6c3ec"
            ],
            []
        ]
    },
    {
        "id": "139025dd.8c826a",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Set 19C",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "climate",
        "service": "set_temperature",
        "entityId": "",
        "data": "{\"entity_id\": \"climate.tyr_celyn\", \"temperature\": 19 }",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 700,
        "y": 1700,
        "wires": [
            [
                "59bd9a7b.dcf2f4"
            ]
        ]
    },
    {
        "id": "59bd9a7b.dcf2f4",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "climate.tyr_celyn_thermostat",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"Changed to 19C for start of booking.\" ",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Heating",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 1700,
        "wires": [
            [
                "e90735bd.fc1dc8"
            ]
        ]
    },
    {
        "id": "5df234ab.d6c3ec",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Booking Not Started",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "calendar.bookings",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 500,
        "y": 1700,
        "wires": [
            [
                "139025dd.8c826a"
            ],
            []
        ]
    },
    {
        "id": "d525ca9d.ff3378",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Tyr Celyn Occupancy",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has turned off (Away)\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 830,
        "y": 1362,
        "wires": [
            [
                "83411108.3f9ec"
            ]
        ]
    },
    {
        "id": "327d0117.e617fe",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "10am",
        "repeat": "",
        "crontab": "00 10 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1560,
        "wires": [
            [
                "17136123.34255f"
            ]
        ]
    },
    {
        "id": "41e67ed4.91a78",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Booking",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "calendar.bookings",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 640,
        "y": 1880,
        "wires": [
            [
                "1ff6802c.a9e4b"
            ],
            []
        ]
    },
    {
        "id": "1ff6802c.a9e4b",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "booking.start_millis",
                "pt": "msg",
                "to": "$toMillis(data.attributes.start_time, '[Y]-[M]-[D] [H]:[m]:[s]')",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "booking.start_day_start_millis",
                "pt": "msg",
                "to": "$toMillis($substring(data.attributes.start_time, 0,10), '[Y]-[M]-[D]')",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "booking.start_day_end_millis",
                "pt": "msg",
                "to": "booking.start_day_start_millis + (24*60*60*1000)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "booking.now_millis",
                "pt": "msg",
                "to": "$millis()",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 820,
        "y": 1880,
        "wires": [
            [
                "8b70bcc4.88069",
                "e9a7cee2.5748f",
                "6cee7a4.ff09884"
            ]
        ]
    },
    {
        "id": "c43284bb.016c98",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Nest Presence",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.home_occupied_tyr_celyn",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 280,
        "y": 1820,
        "wires": [
            [
                "32ed39c1.fc22e6"
            ],
            []
        ]
    },
    {
        "id": "57bf75a0.5d1834",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Nest Presence ",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.home_occupied_tyr_celyn",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 280,
        "y": 1880,
        "wires": [
            [
                "32ed39c1.fc22e6"
            ],
            []
        ]
    },
    {
        "id": "8b70bcc4.88069",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set Message",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"Guests have arrived.\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 1940,
        "wires": [
            [
                "fb1e7301.19764"
            ]
        ]
    },
    {
        "id": "f99d9d6e.f70ff8",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Notify when guests arrive",
        "info": "",
        "x": 130,
        "y": 1780,
        "wires": []
    },
    {
        "id": "e89b076d.e578b8",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Temp Change",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "sensor.tc_set_temperature",
        "entityidfiltertype": "exact",
        "outputinitially": true,
        "state_type": "str",
        "haltifstate": "15",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 90,
        "y": 1600,
        "wires": [
            [
                "17136123.34255f"
            ],
            []
        ]
    },
    {
        "id": "d8cbf7b8.3e8838",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 1380,
        "wires": [
            [
                "d525ca9d.ff3378"
            ]
        ]
    },
    {
        "id": "e9a7cee2.5748f",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Tyr Celyn Nest Mode",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"guests have arrived (Home)\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 1880,
        "wires": [
            [
                "e90735bd.fc1dc8"
            ]
        ]
    },
    {
        "id": "b4e0bae1.ba6178",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Presence All",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.tyrcelyn_presence_all",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 290,
        "y": 1940,
        "wires": [
            [
                "32ed39c1.fc22e6"
            ],
            []
        ]
    },
    {
        "id": "ed437641.c4ead8",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "End Booking",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "calendar.bookings",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 2100,
        "wires": [
            [
                "943ba583.c99f68"
            ],
            []
        ]
    },
    {
        "id": "943ba583.c99f68",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Guests Away",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.tyrcelyn_guests",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 270,
        "y": 2100,
        "wires": [
            [
                "4d5ce971.610bb8"
            ]
        ]
    },
    {
        "id": "4d5ce971.610bb8",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "TC Guests",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has been turned off\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 2100,
        "wires": [
            [
                "e977bbbf.d7eb98"
            ]
        ]
    },
    {
        "id": "e977bbbf.d7eb98",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Ty'r Celyn Set Point Check",
        "links": [
            "47da2c24.5d5b04"
        ],
        "x": 575,
        "y": 2100,
        "wires": []
    },
    {
        "id": "5b810de2.ae36e4",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 2060,
        "wires": [
            [
                "943ba583.c99f68"
            ]
        ]
    },
    {
        "id": "f343a070.76431",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Set Guests Away",
        "info": "",
        "x": 100,
        "y": 2020,
        "wires": []
    },
    {
        "id": "6cee7a4.ff09884",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Guests Arrived",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "input_boolean.tyrcelyn_guests",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1020,
        "y": 1820,
        "wires": [
            [
                "9f759c45.523c8"
            ]
        ]
    },
    {
        "id": "9f759c45.523c8",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "TC Guests",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has been turned on\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1250,
        "y": 1820,
        "wires": [
            [
                "e90735bd.fc1dc8"
            ]
        ]
    },
    {
        "id": "32ed39c1.fc22e6",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Not Present",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_boolean.tyrcelyn_guests",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 470,
        "y": 1880,
        "wires": [
            [
                "41e67ed4.91a78"
            ],
            []
        ]
    },
    {
        "id": "2120392a.c637e6",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Start Booking",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "calendar.bookings",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "x": 90,
        "y": 1880,
        "wires": [
            [
                "57bf75a0.5d1834"
            ],
            []
        ]
    },
    {
        "id": "e088608.b8d59a",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "No booking",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "calendar.bookings",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 290,
        "y": 2320,
        "wires": [
            [
                "38924528.48ddda"
            ],
            []
        ]
    },
    {
        "id": "c30da14b.2fad",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Utility",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.tyrcelyn_utility_motion",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 110,
        "y": 2240,
        "wires": [
            [
                "e088608.b8d59a"
            ],
            []
        ]
    },
    {
        "id": "8b446687.68e838",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Someone in the house",
        "info": "",
        "x": 120,
        "y": 2200,
        "wires": []
    },
    {
        "id": "1cea6ee7.632351",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Nest",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.home_occupied_tyr_celyn",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 110,
        "y": 2320,
        "wires": [
            [
                "e088608.b8d59a"
            ],
            []
        ]
    },
    {
        "id": "c6841364.a712e",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set message",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"Ty'r Celyn cleaners/someone in the house\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 2260,
        "wires": [
            [
                "bb4011dc.3158a",
                "54179814.f57248"
            ]
        ]
    },
    {
        "id": "bb4011dc.3158a",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Tyr Celyn Nest Mode",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has turned on (Cleaners)\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 2260,
        "wires": [
            []
        ]
    },
    {
        "id": "d29331f3.f00d1",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 830,
        "y": 2280,
        "wires": [
            [
                "c6841364.a712e"
            ]
        ]
    },
    {
        "id": "93c853f4.a2c5b",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Booking Today?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "0",
        "halt_if_type": "num",
        "halt_if_compare": "gt",
        "override_topic": false,
        "entity_id": "input_number.tyrcelyn_bookings_today",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 800,
        "y": 2320,
        "wires": [
            [
                "c6841364.a712e"
            ],
            [
                "7dd77c79.9aa664"
            ]
        ]
    },
    {
        "id": "7dd77c79.9aa664",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set message",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"Ty'r Celyn someone in the house when no booking\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 990,
        "y": 2380,
        "wires": [
            [
                "22dda99a.630456",
                "54179814.f57248"
            ]
        ]
    },
    {
        "id": "22dda99a.630456",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Tyr Celyn Nest Mode",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has turned on (No Booking)\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "State",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 2380,
        "wires": [
            []
        ]
    },
    {
        "id": "38924528.48ddda",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Idle",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "idle",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "timer.tycelyn_presence",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 450,
        "y": 2320,
        "wires": [
            [
                "9868753e.0951a8"
            ],
            [
                "44f6e0a.af8622"
            ]
        ]
    },
    {
        "id": "d4fab5cb.bdd968",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 110,
        "y": 2400,
        "wires": [
            [
                "e088608.b8d59a"
            ]
        ]
    },
    {
        "id": "9868753e.0951a8",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Timer Start",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "start",
        "entityId": " timer.tycelyn_presence",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 610,
        "y": 2320,
        "wires": [
            [
                "93c853f4.a2c5b"
            ]
        ]
    },
    {
        "id": "44f6e0a.af8622",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Timer Cancel",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "cancel",
        "entityId": " timer.tycelyn_presence",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 610,
        "y": 2380,
        "wires": [
            [
                "f5be24b7.185338"
            ]
        ]
    },
    {
        "id": "f5be24b7.185338",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Timer Start",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "start",
        "entityId": " timer.tycelyn_presence",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 790,
        "y": 2380,
        "wires": [
            []
        ]
    },
    {
        "id": "c26615c3.1bd808",
        "type": "server-state-changed",
        "z": "a2c447a7.7afa68",
        "name": "Utility",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.tyrcelyn_utility_motion",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 310,
        "y": 2000,
        "wires": [
            [
                "32ed39c1.fc22e6"
            ],
            []
        ]
    },
    {
        "id": "7b58fefe.b30eb",
        "type": "http request",
        "z": "a2c447a7.7afa68",
        "name": "Auth",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://my.ovoenergy.com/api/v2/auth/login",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 590,
        "y": 2640,
        "wires": [
            [
                "69c34051.cb607"
            ]
        ]
    },
    {
        "id": "3fd4d94b.e49fa6",
        "type": "inject",
        "z": "a2c447a7.7afa68",
        "name": "Noon",
        "props": [],
        "repeat": "",
        "crontab": "00 12 * * *",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 2640,
        "wires": [
            [
                "e7987640.df9748"
            ]
        ]
    },
    {
        "id": "7e8d2874.83cde8",
        "type": "http request",
        "z": "a2c447a7.7afa68",
        "name": "Get Account",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://smartpaym.ovoenergy.com/api/customer-and-account-ids",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 930,
        "y": 2640,
        "wires": [
            [
                "fa7911da.746b7"
            ]
        ]
    },
    {
        "id": "69c34051.cb607",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set Cookies",
        "rules": [
            {
                "t": "set",
                "p": "cookies",
                "pt": "msg",
                "to": "responseCookies",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 750,
        "y": 2640,
        "wires": [
            [
                "7e8d2874.83cde8"
            ]
        ]
    },
    {
        "id": "fa7911da.746b7",
        "type": "json",
        "z": "a2c447a7.7afa68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1090,
        "y": 2640,
        "wires": [
            [
                "58929926.6256c8"
            ]
        ]
    },
    {
        "id": "6ceec3ff.3cc85c",
        "type": "http request",
        "z": "a2c447a7.7afa68",
        "name": "Get Data",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "bearer",
        "x": 1400,
        "y": 2640,
        "wires": [
            [
                "b51dfd4d.8d674"
            ]
        ]
    },
    {
        "id": "7f5275d4.0c86cc",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Daily",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://smartpaym.ovoenergy.com/api/energy-usage/daily/\" & payload.accountIds[0] & \"?date=\" & $now('[Y0001]-[M01]') &\"\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1230,
        "y": 2580,
        "wires": [
            []
        ]
    },
    {
        "id": "b51dfd4d.8d674",
        "type": "json",
        "z": "a2c447a7.7afa68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1550,
        "y": 2640,
        "wires": [
            [
                "1d859d9.acbe662",
                "5dc619db.ac54a8"
            ]
        ]
    },
    {
        "id": "58929926.6256c8",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "1/2 hourly",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://smartpaym.ovoenergy.com/api/energy-usage/half-hourly/\" & payload.accountIds[0] & \"?date=\" & $fromMillis($millis() - (1000*60*60*24*1), '[Y0001]-[M01]-[D01]') &\"\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 2640,
        "wires": [
            [
                "6ceec3ff.3cc85c"
            ]
        ]
    },
    {
        "id": "1d859d9.acbe662",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "A1",
        "links": [
            "25e0eb7.2767c14"
        ],
        "x": 1690,
        "y": 2640,
        "wires": [],
        "l": true
    },
    {
        "id": "25e0eb7.2767c14",
        "type": "link in",
        "z": "a2c447a7.7afa68",
        "name": "A2",
        "links": [
            "1d859d9.acbe662"
        ],
        "x": 110,
        "y": 2700,
        "wires": [
            [
                "3dc4ffc8.63745"
            ]
        ],
        "l": true
    },
    {
        "id": "deea95ba.fa9b88",
        "type": "split",
        "z": "a2c447a7.7afa68",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 550,
        "y": 2700,
        "wires": [
            [
                "64b3b8af.162158"
            ]
        ]
    },
    {
        "id": "ed645e63.b3f1a",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Store",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.electricity.data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 2700,
        "wires": [
            [
                "deea95ba.fa9b88"
            ]
        ]
    },
    {
        "id": "64b3b8af.162158",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Fix Date",
        "rules": [
            {
                "t": "set",
                "p": "payload.time",
                "pt": "msg",
                "to": "$toMillis(payload.interval.start)",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload.interval",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "stash",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload[0]",
                "pt": "msg",
                "to": "stash",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 2700,
        "wires": [
            [
                "3cbcdb6b.9a35c4"
            ]
        ]
    },
    {
        "id": "3cbcdb6b.9a35c4",
        "type": "join",
        "z": "a2c447a7.7afa68",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 850,
        "y": 2700,
        "wires": [
            [
                "634ff477.1e277c"
            ]
        ]
    },
    {
        "id": "634ff477.1e277c",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Tidy Up",
        "rules": [
            {
                "t": "delete",
                "p": "statusCode",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "responseUrl",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "redirectList",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "responseCookies",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "cookies",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "url",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "headers",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1000,
        "y": 2700,
        "wires": [
            [
                "b13343dd.cf53"
            ]
        ]
    },
    {
        "id": "b13343dd.cf53",
        "type": "influxdb out",
        "z": "a2c447a7.7afa68",
        "influxdb": "2ff2a476.a6d2ec",
        "name": "Load",
        "measurement": "electricity",
        "precision": "",
        "retentionPolicy": "",
        "database": "database",
        "precisionV18FluxV20": "ms",
        "retentionPolicyV18Flux": "",
        "org": "33b99f6ba545c027",
        "bucket": "OVO",
        "x": 1150,
        "y": 2700,
        "wires": []
    },
    {
        "id": "7acda223.ad9b3c",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "OVO",
        "info": "",
        "x": 110,
        "y": 2580,
        "wires": []
    },
    {
        "id": "6f2646db.2aab28",
        "type": "http in",
        "z": "a2c447a7.7afa68",
        "name": "/remote_ha",
        "url": "/remote_ha",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 90,
        "y": 2960,
        "wires": [
            [
                "7fe9f028.0d7",
                "d49a6588.d71ba8"
            ]
        ]
    },
    {
        "id": "7fe9f028.0d7",
        "type": "http response",
        "z": "a2c447a7.7afa68",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 260,
        "y": 2920,
        "wires": []
    },
    {
        "id": "d49a6588.d71ba8",
        "type": "json",
        "z": "a2c447a7.7afa68",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 250,
        "y": 2960,
        "wires": [
            [
                "6424b39f.4ac2bc"
            ]
        ]
    },
    {
        "id": "6424b39f.4ac2bc",
        "type": "split",
        "z": "a2c447a7.7afa68",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 390,
        "y": 2960,
        "wires": [
            [
                "f0712481.aee478"
            ]
        ]
    },
    {
        "id": "f0712481.aee478",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Convert ID",
        "rules": [
            {
                "t": "set",
                "p": "payload.entity_id",
                "pt": "msg",
                "to": "$substringBefore(payload.entity_id, \".\" ) & \".tyrcelyn_\" &$substringAfter(payload.entity_id, \".\" )",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload.entity_type",
                "pt": "msg",
                "to": "$substringBefore(payload.entity_id, \".\" ) ",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 2960,
        "wires": [
            [
                "d68f2285.df6ff"
            ]
        ]
    },
    {
        "id": "d68f2285.df6ff",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "Type",
        "property": "payload.entity_type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "input_number",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "binary_sensor",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "input_boolean",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 710,
        "y": 2960,
        "wires": [
            [
                "d74d77e3.8f77d8"
            ],
            [
                "737f4ae6.06bf54"
            ],
            [
                "685984f9.0e66ec"
            ],
            []
        ]
    },
    {
        "id": "d74d77e3.8f77d8",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Changed?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "payload.state",
        "halt_if_type": "msg",
        "halt_if_compare": "is_not",
        "override_topic": false,
        "entity_id": "{{payload.entity_id}}",
        "state_type": "str",
        "state_location": "payload.state_old",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1213,
        "y": 2860,
        "wires": [
            [
                "cd7963b7.cc714",
                "13439cbc.41f423"
            ],
            []
        ]
    },
    {
        "id": "737f4ae6.06bf54",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Binary Sensor",
        "rules": [
            {
                "t": "set",
                "p": "payload.entity_id",
                "pt": "msg",
                "to": " \"input_boolean.\" &$substringAfter(payload.entity_id, \".\" )",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 2960,
        "wires": [
            [
                "685984f9.0e66ec"
            ]
        ]
    },
    {
        "id": "685984f9.0e66ec",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "on/off",
        "property": "payload.state",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1053,
        "y": 3040,
        "wires": [
            [
                "97004430.ac2f48"
            ],
            [
                "3b9419de.5ded36"
            ]
        ]
    },
    {
        "id": "cd7963b7.cc714",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Update No",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_number",
        "service": "set_value",
        "entityId": "",
        "data": "{\"entity_id\": payload.entity_id, \"value\": payload.state}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1393,
        "y": 2860,
        "wires": [
            [
                "7376b5c0.52056c"
            ]
        ]
    },
    {
        "id": "4258f7cf.ae2b48",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "payload.entity_id",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"has been changed from: \" & payload.state_old & \" to: \" & payload.state",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "TC",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1670,
        "y": 2920,
        "wires": [
            [
                "b26a63f5.5f6d9"
            ]
        ]
    },
    {
        "id": "97004430.ac2f48",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Off?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{payload.entity_id}}",
        "state_type": "str",
        "state_location": "payload.state_old",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1193,
        "y": 3000,
        "wires": [
            [
                "7efa1580.4e4d0c",
                "13439cbc.41f423"
            ],
            []
        ]
    },
    {
        "id": "3b9419de.5ded36",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "On?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{payload.entity_id}}",
        "state_type": "str",
        "state_location": "payload.state_old",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1190,
        "y": 3080,
        "wires": [
            [
                "6e10ed45.93ea44",
                "13439cbc.41f423"
            ],
            []
        ]
    },
    {
        "id": "7376b5c0.52056c",
        "type": "join",
        "z": "a2c447a7.7afa68",
        "name": "",
        "mode": "auto",
        "build": "string",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1650,
        "y": 2960,
        "wires": [
            []
        ]
    },
    {
        "id": "b26a63f5.5f6d9",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Rest API",
        "links": [
            "47da2c24.5d5b04"
        ],
        "x": 1795,
        "y": 2920,
        "wires": []
    },
    {
        "id": "7efa1580.4e4d0c",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Turn On",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "",
        "data": "{\"entity_id\":\"{{payload.entity_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1383,
        "y": 3000,
        "wires": [
            [
                "7376b5c0.52056c"
            ]
        ]
    },
    {
        "id": "6e10ed45.93ea44",
        "type": "api-call-service",
        "z": "a2c447a7.7afa68",
        "name": "Turn Off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "",
        "data": "{\"entity_id\":\"{{payload.entity_id}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 1380,
        "y": 3080,
        "wires": [
            [
                "7376b5c0.52056c"
            ]
        ]
    },
    {
        "id": "5f955d25.36b754",
        "type": "comment",
        "z": "a2c447a7.7afa68",
        "name": "Rest API",
        "info": "",
        "x": 120,
        "y": 2860,
        "wires": []
    },
    {
        "id": "e7987640.df9748",
        "type": "credentials",
        "z": "a2c447a7.7afa68",
        "name": "",
        "props": [
            {
                "value": "ovo_username",
                "type": "msg"
            },
            {
                "value": "ovo_password",
                "type": "msg"
            }
        ],
        "x": 270,
        "y": 2640,
        "wires": [
            [
                "23f44b1f.d91224"
            ]
        ]
    },
    {
        "id": "23f44b1f.d91224",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"username\":ovo_username,\"password\":ovo_password,\"rememberMe\":true}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 2640,
        "wires": [
            [
                "7b58fefe.b30eb"
            ]
        ]
    },
    {
        "id": "1b30d0a8.e67f8f",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Empty",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"OVO Electricity empty - \" & url}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 2760,
        "wires": [
            [
                "a4ac79e6.1bbc98",
                "2533d38b.24260c"
            ]
        ]
    },
    {
        "id": "2533d38b.24260c",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Electricity",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "was empty",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "OVO",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 2760,
        "wires": [
            [
                "57e16a03.61cc04"
            ]
        ]
    },
    {
        "id": "3dc4ffc8.63745",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "> 0",
        "property": "$count(payload.electricity.data)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 270,
        "y": 2700,
        "wires": [
            [
                "ed645e63.b3f1a"
            ],
            [
                "1b30d0a8.e67f8f"
            ]
        ]
    },
    {
        "id": "57e16a03.61cc04",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Security",
        "links": [
            "7ca2c4f3.2c7b4c"
        ],
        "x": 715,
        "y": 2760,
        "wires": []
    },
    {
        "id": "5dc619db.ac54a8",
        "type": "debug",
        "z": "a2c447a7.7afa68",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1680,
        "y": 2560,
        "wires": []
    },
    {
        "id": "29c7b288.2534fe",
        "type": "change",
        "z": "a2c447a7.7afa68",
        "name": "1/2 hourly",
        "rules": [
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"https://smartpaym.ovoenergy.com/api/energy-usage/half-hourly/\" & payload.accountIds[0] & \"?date=\" & $fromMillis($millis() - (1000*60*60*24*2), '[Y0001]-[M01]-[D01]') &\"\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1100,
        "y": 2580,
        "wires": [
            []
        ]
    },
    {
        "id": "18d8a42c.d7a67c",
        "type": "api-call-service",
        "z": "9573fbce.d39958",
        "name": "Log",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "system_log",
        "service": "write",
        "entityId": "",
        "data": "{\"message\":\"{{log.message}}\",\"level\":\"{{log.level}}\",\"logger\":\"NodeRed\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 690,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "7f717e3f.49fa4",
        "type": "link in",
        "z": "9573fbce.d39958",
        "name": "Standard Log",
        "links": [
            "2ac2653a.e0315a",
            "3a1c1d56.fe2a02",
            "439335b8.5d46bc",
            "4875b9ef.b43838",
            "545dfea7.a28c",
            "6c670b2a.531f94",
            "6c7cfc7.e8e4604",
            "6dfd007a.c25d2",
            "7c19f4a9.0028bc",
            "7dca670f.0085d8",
            "84eefd0b.920ea",
            "8cbd826b.835b1",
            "9efa7a86.56a6d8",
            "ae20fabe.a27c68",
            "b5481706.a33978",
            "ba33b2f4.b403d",
            "cd411d4a.40f12",
            "e37b4db9.07b3f",
            "efb05ea5.0e713",
            "2142786c.a7868",
            "f9c3ea39.407708",
            "7d02a937.07f168",
            "83611f9.837a8e",
            "382a29a1.c383e6",
            "e146ae7f.f5864",
            "ccaec1c8.38301",
            "648d4a7d.dff2d4",
            "c772f431.dbc5c8",
            "a8e839bd.169f88",
            "5ff200db.30879",
            "6b05b710.5f61a8",
            "c24e7eb1.2ab37",
            "97c2f7e7.7568a8",
            "5b0e51d5.b903b",
            "7da9f033.d28c5"
        ],
        "x": 170,
        "y": 220,
        "wires": [
            [
                "30964af8.810926"
            ]
        ],
        "l": true
    },
    {
        "id": "1300cb6d.fa0705",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.message",
                "pt": "msg",
                "to": "$$.log.type & ' - ' & $$.log.item & ' - ' & $$.log.action",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 220,
        "wires": [
            [
                "18d8a42c.d7a67c",
                "9e0d5dc.9ac74a"
            ]
        ]
    },
    {
        "id": "9e0d5dc.9ac74a",
        "type": "api-call-service",
        "z": "9573fbce.d39958",
        "name": "CSV",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "noderedlog",
        "entityId": "",
        "data": "{\"message\":\",{{log.message}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 690,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "99d41c3e.ff691",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "Test Item",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "test action",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Test Type",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 150,
        "y": 100,
        "wires": [
            [
                "30964af8.810926"
            ]
        ]
    },
    {
        "id": "ef028c81.65724",
        "type": "inject",
        "z": "9573fbce.d39958",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "force",
        "payloadType": "str",
        "x": 170,
        "y": 40,
        "wires": [
            [
                "99d41c3e.ff691"
            ]
        ]
    },
    {
        "id": "47da2c24.5d5b04",
        "type": "link in",
        "z": "9573fbce.d39958",
        "name": "Ty'r Celyn Log",
        "links": [
            "2d8706d1.b5620a",
            "83411108.3f9ec",
            "e90735bd.fc1dc8",
            "9726aeb4.df193",
            "e977bbbf.d7eb98",
            "b26a63f5.5f6d9"
        ],
        "x": 170,
        "y": 340,
        "wires": [
            [
                "9e07f582.e71a78"
            ]
        ],
        "l": true
    },
    {
        "id": "541b44b5.e8992c",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "log.message",
                "pt": "msg",
                "to": "$$.log.type & ' - ' & $$.log.item & ' - ' & $$.log.action",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 340,
        "wires": [
            [
                "18d8a42c.d7a67c",
                "16f85fb4.a52c3"
            ]
        ]
    },
    {
        "id": "16f85fb4.a52c3",
        "type": "api-call-service",
        "z": "9573fbce.d39958",
        "name": "CSV",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "tyrcelyn",
        "entityId": "",
        "data": "{\"message\":\",{{log.message}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 690,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "30964af8.810926",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "info",
        "rules": [
            {
                "t": "set",
                "p": "log.level",
                "pt": "msg",
                "to": "info",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 220,
        "wires": [
            [
                "1300cb6d.fa0705"
            ]
        ]
    },
    {
        "id": "9e07f582.e71a78",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "info",
        "rules": [
            {
                "t": "set",
                "p": "log.level",
                "pt": "msg",
                "to": "info",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 340,
        "wires": [
            [
                "541b44b5.e8992c"
            ]
        ]
    },
    {
        "id": "7ca2c4f3.2c7b4c",
        "type": "link in",
        "z": "9573fbce.d39958",
        "name": "Warning Log",
        "links": [
            "c4665cee.224fb",
            "57e16a03.61cc04"
        ],
        "x": 170,
        "y": 280,
        "wires": [
            [
                "a723061a.e59fb8"
            ]
        ],
        "l": true
    },
    {
        "id": "a723061a.e59fb8",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "warning",
        "rules": [
            {
                "t": "set",
                "p": "log.level",
                "pt": "msg",
                "to": "warning",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 280,
        "wires": [
            [
                "1300cb6d.fa0705"
            ]
        ]
    },
    {
        "id": "ca84b727.b00468",
        "type": "server-state-changed",
        "z": "8aaceb10.8ee3e8",
        "name": "Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.zwave_office_fibaro_motion",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 110,
        "y": 560,
        "wires": [
            [
                "8e3fe342.5506a"
            ]
        ]
    },
    {
        "id": "4de176ad.080868",
        "type": "server-events",
        "z": "8aaceb10.8ee3e8",
        "name": "Timer Finished",
        "server": "86fae200.61af7",
        "event_type": "timer.finished",
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "waitForRunning": true,
        "x": 160,
        "y": 320,
        "wires": [
            [
                "9831b803.f369e8"
            ]
        ]
    },
    {
        "id": "9831b803.f369e8",
        "type": "switch",
        "z": "8aaceb10.8ee3e8",
        "name": "Lights Timer",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "timer.lights_office",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "timer.lights_living_room",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 350,
        "y": 320,
        "wires": [
            [
                "1726c790.49ab58"
            ],
            [
                "d1c3e9c9.85ad88"
            ],
            []
        ]
    },
    {
        "id": "c7d33224.3f595",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "Office Finished",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"entity_id\":\"timer.lights_office\"}",
        "payloadType": "json",
        "x": 160,
        "y": 260,
        "wires": [
            [
                "9831b803.f369e8"
            ]
        ]
    },
    {
        "id": "a20d61fc.3d7ad",
        "type": "comment",
        "z": "8aaceb10.8ee3e8",
        "name": "Office",
        "info": "",
        "x": 90,
        "y": 480,
        "wires": []
    },
    {
        "id": "d7811964.e76fd8",
        "type": "api-current-state",
        "z": "8aaceb10.8ee3e8",
        "name": "iMac on",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "binary_sensor.rogers_imac_active",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 740,
        "y": 580,
        "wires": [
            [
                "b44ae74d.5c2978"
            ],
            [
                "9cb7c285.f4717"
            ]
        ]
    },
    {
        "id": "92beb469.dfb178",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "off",
        "payloadType": "str",
        "x": 110,
        "y": 600,
        "wires": [
            [
                "8e3fe342.5506a"
            ]
        ]
    },
    {
        "id": "2323f7a7.ccb478",
        "type": "comment",
        "z": "8aaceb10.8ee3e8",
        "name": "General",
        "info": "",
        "x": 90,
        "y": 40,
        "wires": []
    },
    {
        "id": "279ea0b8.6b06b",
        "type": "server-state-changed",
        "z": "8aaceb10.8ee3e8",
        "name": "Motion",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "binary_sensor.living_room_occupancy",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 1,
        "output_only_on_state_change": true,
        "for": 0,
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 110,
        "y": 800,
        "wires": [
            [
                "5ed19d8e.559f74"
            ]
        ]
    },
    {
        "id": "4f840c6f.8dd234",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "data",
                "v": "{\"entity_id\":\"binary_sensor.living_room_occupancy\",\"old_state\":{\"entity_id\":\"binary_sensor.living_room_occupancy2\",\"state\":\"off\",\"attributes\":{\"friendly_name\":\"Living Room Occupancy\",\"device_class\":\"motion\"},\"last_changed\":\"2021-01-29T18:08:44.031891+00:00\",\"last_updated\":\"2021-01-29T18:08:44.031891+00:00\",\"context\":{\"id\":\"af4bb5392ab2f03c919c06b0c638f1bd\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"off\",\"timeSinceChangedMs\":366522},\"new_state\":{\"entity_id\":\"binary_sensor.living_room_occupancy2\",\"state\":\"off\",\"attributes\":{\"friendly_name\":\"Living Room Occupancy\",\"device_class\":\"motion\"},\"last_changed\":\"2021-01-29T18:08:44.031891+00:00\",\"last_updated\":\"2021-01-29T18:08:44.031891+00:00\",\"context\":{\"id\":\"af4bb5392ab2f03c919c06b0c638f1bd\",\"parent_id\":null,\"user_id\":null},\"original_state\":\"off\",\"timeSinceChangedMs\":366522}}",
                "vt": "json"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "on",
        "payloadType": "str",
        "x": 110,
        "y": 760,
        "wires": [
            [
                "5ed19d8e.559f74"
            ]
        ]
    },
    {
        "id": "f505113a.4a0ee",
        "type": "comment",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room",
        "info": "",
        "x": 110,
        "y": 680,
        "wires": []
    },
    {
        "id": "f2d84a90.bf3d28",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "off",
        "payloadType": "str",
        "x": 110,
        "y": 840,
        "wires": [
            [
                "5ed19d8e.559f74"
            ]
        ]
    },
    {
        "id": "224e8c4c.0559d4",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "+ 5 Mins",
        "rules": [
            {
                "t": "set",
                "p": "time",
                "pt": "msg",
                "to": "time + 5",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1080,
        "y": 780,
        "wires": [
            [
                "df924835.ac9f78"
            ]
        ]
    },
    {
        "id": "1726c790.49ab58",
        "type": "api-call-service",
        "z": "8aaceb10.8ee3e8",
        "name": "Office",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.occupied_office",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 550,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "d1c3e9c9.85ad88",
        "type": "api-call-service",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "input_boolean.occupied_living_room",
        "data": "",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 570,
        "y": 360,
        "wires": [
            [
                "41106f0d.5b897"
            ]
        ]
    },
    {
        "id": "13dba1ab.69fdae",
        "type": "api-current-state",
        "z": "8aaceb10.8ee3e8",
        "name": "Location Mode",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "[\"Evening\",\"Night\"]",
        "halt_if_type": "jsonata",
        "halt_if_compare": "does_not_include",
        "override_topic": false,
        "entity_id": "input_select.location_mode",
        "state_type": "str",
        "state_location": "location_mode",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 600,
        "y": 840,
        "wires": [
            [
                "46ff8095.686a2"
            ],
            [
                "1f7393bb.b8020c"
            ]
        ]
    },
    {
        "id": "1f7393bb.b8020c",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "5 mins",
        "rules": [
            {
                "t": "set",
                "p": "time",
                "pt": "msg",
                "to": "5",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 860,
        "wires": [
            [
                "3ce5a9b6.949716"
            ]
        ]
    },
    {
        "id": "46ff8095.686a2",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "10 mins",
        "rules": [
            {
                "t": "set",
                "p": "time",
                "pt": "msg",
                "to": "10",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 820,
        "wires": [
            [
                "3ce5a9b6.949716"
            ]
        ]
    },
    {
        "id": "9444bf9b.fcbc",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room Finished",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"entity_id\":\"timer.lights_living_room\"}",
        "payloadType": "json",
        "x": 140,
        "y": 380,
        "wires": [
            [
                "9831b803.f369e8"
            ]
        ]
    },
    {
        "id": "ba8ae8d0.a8f258",
        "type": "switch",
        "z": "8aaceb10.8ee3e8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 800,
        "wires": [
            [
                "447ad97f.84a718"
            ],
            [
                "13dba1ab.69fdae"
            ]
        ]
    },
    {
        "id": "8e3fe342.5506a",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "Office",
        "rules": [
            {
                "t": "set",
                "p": "entities.timer",
                "pt": "msg",
                "to": "timer.lights_office",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "entities.boolean",
                "pt": "msg",
                "to": "input_boolean.occupied_office",
                "tot": "str"
            },
            {
                "t": "delete",
                "p": "topic",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 250,
        "y": 560,
        "wires": [
            [
                "16340a45.ec0346"
            ]
        ]
    },
    {
        "id": "16340a45.ec0346",
        "type": "switch",
        "z": "8aaceb10.8ee3e8",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "on",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "off",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 560,
        "wires": [
            [
                "67ecdbd7.b0eba4"
            ],
            [
                "fd30dccf.6e5a3"
            ]
        ]
    },
    {
        "id": "5ed19d8e.559f74",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room",
        "rules": [
            {
                "t": "set",
                "p": "entities.timer",
                "pt": "msg",
                "to": "timer.lights_living_room",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "entities.boolean",
                "pt": "msg",
                "to": "input_boolean.occupied_living_room",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 800,
        "wires": [
            [
                "ba8ae8d0.a8f258"
            ]
        ]
    },
    {
        "id": "6fea084e.af8db8",
        "type": "link in",
        "z": "8aaceb10.8ee3e8",
        "name": "Occupied",
        "links": [
            "447ad97f.84a718",
            "67ecdbd7.b0eba4"
        ],
        "x": 180,
        "y": 80,
        "wires": [
            [
                "eeec4da1.e8184"
            ]
        ],
        "l": true
    },
    {
        "id": "9cf2efc7.7899f",
        "type": "api-call-service",
        "z": "8aaceb10.8ee3e8",
        "name": "Occupied",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "",
        "data": "{\"entity_id\":\"{{entities.boolean}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 680,
        "y": 80,
        "wires": [
            [
                "7c444db8.0089d4"
            ]
        ]
    },
    {
        "id": "67ecdbd7.b0eba4",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Office Occupied",
        "links": [
            "6fea084e.af8db8"
        ],
        "x": 560,
        "y": 540,
        "wires": [],
        "l": true
    },
    {
        "id": "447ad97f.84a718",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room Occupied",
        "links": [
            "1aaa18df.3c7cd7",
            "6fea084e.af8db8"
        ],
        "x": 620,
        "y": 760,
        "wires": [],
        "l": true
    },
    {
        "id": "2b566812.55a058",
        "type": "link in",
        "z": "8aaceb10.8ee3e8",
        "name": "No Motion",
        "links": [
            "9cb7c285.f4717",
            "df924835.ac9f78"
        ],
        "x": 180,
        "y": 180,
        "wires": [
            [
                "acf7ebff.2ba098"
            ]
        ],
        "l": true
    },
    {
        "id": "7288d2f2.293dcc",
        "type": "api-call-service",
        "z": "8aaceb10.8ee3e8",
        "name": "Timer Start",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "start",
        "entityId": " ",
        "data": "{\"entity_id\":\"{{entities.timer}}\",\"duration\":\"{{timestr}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 510,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "acf7ebff.2ba098",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "Format",
        "rules": [
            {
                "t": "set",
                "p": "timestr",
                "pt": "msg",
                "to": "\"00:\" & \"01\" & \":00\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "timestr",
                "pt": "msg",
                "to": "\"00:\" & $formatNumber(time, '00') & \":00\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 180,
        "wires": [
            [
                "7288d2f2.293dcc"
            ]
        ]
    },
    {
        "id": "9cb7c285.f4717",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Office No Motion",
        "links": [
            "2b566812.55a058"
        ],
        "x": 1070,
        "y": 580,
        "wires": [],
        "l": true
    },
    {
        "id": "47bc4ef0.b142d",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "Force",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "Force",
        "payload": "on",
        "payloadType": "str",
        "x": 110,
        "y": 520,
        "wires": [
            [
                "8e3fe342.5506a"
            ]
        ]
    },
    {
        "id": "82e87cb4.44521",
        "type": "inject",
        "z": "8aaceb10.8ee3e8",
        "name": "5 mins",
        "props": [
            {
                "p": "time",
                "v": "5",
                "vt": "num"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 770,
        "y": 900,
        "wires": [
            [
                "3ce5a9b6.949716"
            ]
        ]
    },
    {
        "id": "df924835.ac9f78",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room No Motion",
        "links": [
            "2b566812.55a058"
        ],
        "x": 1290,
        "y": 820,
        "wires": [],
        "l": true
    },
    {
        "id": "3ce5a9b6.949716",
        "type": "api-current-state",
        "z": "8aaceb10.8ee3e8",
        "name": "TV on",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "media_player.sftv_3",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 930,
        "y": 820,
        "wires": [
            [
                "224e8c4c.0559d4"
            ],
            [
                "df924835.ac9f78"
            ]
        ]
    },
    {
        "id": "7c444db8.0089d4",
        "type": "switch",
        "z": "8aaceb10.8ee3e8",
        "name": "",
        "property": "entities.boolean",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "input_boolean.occupied_living_room",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "input_boolean.occupied_office",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 830,
        "y": 80,
        "wires": [
            [
                "e78a743d.be3118"
            ],
            [
                "acf29a2f.f7f008"
            ]
        ]
    },
    {
        "id": "41106f0d.5b897",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room Timer Finished",
        "links": [
            "be145578.2155d8"
        ],
        "x": 800,
        "y": 360,
        "wires": [],
        "l": true
    },
    {
        "id": "10921e44.4293e2",
        "type": "api-call-service",
        "z": "8aaceb10.8ee3e8",
        "name": "Timer Cancel",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "timer",
        "service": "cancel",
        "entityId": " ",
        "data": "{\"entity_id\":\"{{entities.timer}}\"}",
        "dataType": "json",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 510,
        "y": 120,
        "wires": [
            [
                "9cf2efc7.7899f"
            ]
        ]
    },
    {
        "id": "eeec4da1.e8184",
        "type": "api-current-state",
        "z": "8aaceb10.8ee3e8",
        "name": "Idle ?",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "idle",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "{{entities.timer}}",
        "state_type": "str",
        "state_location": "payload",
        "override_payload": "msg",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 330,
        "y": 80,
        "wires": [
            [
                "9cf2efc7.7899f"
            ],
            [
                "10921e44.4293e2"
            ]
        ]
    },
    {
        "id": "e78a743d.be3118",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Living Room",
        "links": [
            "555dabc3.cca65c",
            "dd5332f1.6835f"
        ],
        "x": 990,
        "y": 60,
        "wires": [],
        "l": true
    },
    {
        "id": "b44ae74d.5c2978",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "+ 10 Mins",
        "rules": [
            {
                "t": "set",
                "p": "time",
                "pt": "msg",
                "to": "time + 10",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 540,
        "wires": [
            [
                "9cb7c285.f4717"
            ]
        ]
    },
    {
        "id": "fd30dccf.6e5a3",
        "type": "change",
        "z": "8aaceb10.8ee3e8",
        "name": "5 Mins",
        "rules": [
            {
                "t": "set",
                "p": "time",
                "pt": "msg",
                "to": "5",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 580,
        "wires": [
            [
                "d7811964.e76fd8"
            ]
        ]
    },
    {
        "id": "acf29a2f.f7f008",
        "type": "link out",
        "z": "8aaceb10.8ee3e8",
        "name": "Office",
        "links": [
            "2bd421b5.b964ae",
            "a42fcac8.fd7038"
        ],
        "x": 970,
        "y": 100,
        "wires": [],
        "l": true
    },
    {
        "id": "8f7467c.9b72098",
        "type": "mqtt in",
        "z": "b56c7f40.a7397",
        "d": true,
        "name": "",
        "topic": "monitor/#",
        "qos": "2",
        "datatype": "auto",
        "broker": "a502fb56.a9f708",
        "x": 160,
        "y": 340,
        "wires": [
            [
                "3b989549.6a574a",
                "60c76648.342be8"
            ]
        ]
    },
    {
        "id": "a77f0ac6.46a188",
        "type": "inject",
        "z": "b56c7f40.a7397",
        "name": "force",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 170,
        "y": 100,
        "wires": [
            [
                "9c076bec.72cc98"
            ]
        ]
    },
    {
        "id": "9c076bec.72cc98",
        "type": "mqtt out",
        "z": "b56c7f40.a7397",
        "name": "Current state",
        "topic": "monitor/KNOWN DEVICE STATES",
        "qos": "2",
        "retain": "",
        "broker": "a502fb56.a9f708",
        "x": 330,
        "y": 100,
        "wires": []
    },
    {
        "id": "a28c8eca.e804d",
        "type": "inject",
        "z": "b56c7f40.a7397",
        "name": "mac address",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "E5:6F:63:93:A4:FA Nest Protect 1",
        "payloadType": "str",
        "x": 150,
        "y": 180,
        "wires": [
            [
                "6fa80f53.1e58d"
            ]
        ]
    },
    {
        "id": "6fa80f53.1e58d",
        "type": "mqtt out",
        "z": "b56c7f40.a7397",
        "name": "Add device",
        "topic": "monitor/setup/ADD STATIC DEVICE",
        "qos": "2",
        "retain": "",
        "broker": "a502fb56.a9f708",
        "x": 330,
        "y": 180,
        "wires": []
    },
    {
        "id": "dc777811.865a28",
        "type": "inject",
        "z": "b56c7f40.a7397",
        "name": "mac address",
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "A8:BE:27:C2:56:1B",
        "payloadType": "str",
        "x": 150,
        "y": 260,
        "wires": [
            [
                "33198afe.c566e6"
            ]
        ]
    },
    {
        "id": "33198afe.c566e6",
        "type": "mqtt out",
        "z": "b56c7f40.a7397",
        "name": "Delete device",
        "topic": "monitor/setup/DELETE STATIC DEVICE",
        "qos": "2",
        "retain": "",
        "broker": "a502fb56.a9f708",
        "x": 340,
        "y": 260,
        "wires": []
    },
    {
        "id": "f2ecb4af.b265e",
        "type": "file",
        "z": "b56c7f40.a7397",
        "name": "",
        "filename": "/share/known.csv",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1190,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "9b4f15d4.90a728",
        "type": "json",
        "z": "b56c7f40.a7397",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 450,
        "y": 340,
        "wires": [
            [
                "7d89e86.a874718"
            ]
        ]
    },
    {
        "id": "3b989549.6a574a",
        "type": "switch",
        "z": "b56c7f40.a7397",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "istype",
                "v": "json",
                "vt": "json"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 310,
        "y": 340,
        "wires": [
            [
                "9b4f15d4.90a728"
            ],
            []
        ]
    },
    {
        "id": "7d89e86.a874718",
        "type": "switch",
        "z": "b56c7f40.a7397",
        "name": "",
        "property": "payload.type",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "$$.payload = -99",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "KNOWN_MAC",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 590,
        "y": 340,
        "wires": [
            [],
            [
                "f08fa57d.4d47d8"
            ],
            [
                "c4a49b2c.dafad8"
            ]
        ]
    },
    {
        "id": "f8bdfc95.94f3e",
        "type": "file",
        "z": "b56c7f40.a7397",
        "name": "",
        "filename": "/share/unknown.csv",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 1200,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "c4a49b2c.dafad8",
        "type": "change",
        "z": "b56c7f40.a7397",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "temp",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"topic\":\"stash\"}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.payload",
                "pt": "msg",
                "to": "temp",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 360,
        "wires": [
            [
                "51b120d1.c51f7"
            ]
        ]
    },
    {
        "id": "f08fa57d.4d47d8",
        "type": "change",
        "z": "b56c7f40.a7397",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "temp",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"topic\":\"stash\"}",
                "tot": "json"
            },
            {
                "t": "set",
                "p": "payload.topic",
                "pt": "msg",
                "to": "topic",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "payload.payload",
                "pt": "msg",
                "to": "temp",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 320,
        "wires": [
            [
                "f2ecb4af.b265e"
            ]
        ]
    },
    {
        "id": "51b120d1.c51f7",
        "type": "switch",
        "z": "b56c7f40.a7397",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": ":",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 940,
        "y": 380,
        "wires": [
            [
                "f8bdfc95.94f3e"
            ],
            [
                "f2ecb4af.b265e"
            ]
        ]
    },
    {
        "id": "60c76648.342be8",
        "type": "debug",
        "z": "b56c7f40.a7397",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 330,
        "y": 400,
        "wires": []
    },
    {
        "id": "e0aa8a2.c457578",
        "type": "mqtt out",
        "z": "b56c7f40.a7397",
        "name": "",
        "topic": "test",
        "qos": "",
        "retain": "",
        "broker": "a502fb56.a9f708",
        "x": 310,
        "y": 480,
        "wires": []
    },
    {
        "id": "8875e572.acf9b8",
        "type": "inject",
        "z": "b56c7f40.a7397",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "Testtesttest",
        "payloadType": "str",
        "x": 150,
        "y": 480,
        "wires": [
            [
                "e0aa8a2.c457578"
            ]
        ]
    },
    {
        "id": "49df8488.0faf1c",
        "type": "comment",
        "z": "b56c7f40.a7397",
        "name": "MQTT Stuff",
        "info": "",
        "x": 120,
        "y": 60,
        "wires": []
    },
    {
        "id": "dc5b2bb4.e24418",
        "type": "amazon-echo-hub",
        "z": "b56c7f40.a7397",
        "d": true,
        "port": "80",
        "processinput": 0,
        "discovery": true,
        "x": 130,
        "y": 620,
        "wires": [
            [
                "c629a679.3d5488"
            ]
        ]
    },
    {
        "id": "c629a679.3d5488",
        "type": "amazon-echo-device",
        "z": "b56c7f40.a7397",
        "name": "Scene-bbb",
        "topic": "",
        "x": 330,
        "y": 620,
        "wires": [
            [
                "ef0775ea.fce2d8"
            ]
        ]
    },
    {
        "id": "ef0775ea.fce2d8",
        "type": "debug",
        "z": "b56c7f40.a7397",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 490,
        "y": 620,
        "wires": []
    },
    {
        "id": "58bfc6f0.4b7428",
        "type": "comment",
        "z": "b56c7f40.a7397",
        "name": "Echo Stuff",
        "info": "",
        "x": 100,
        "y": 580,
        "wires": []
    },
    {
        "id": "af9c5d82.c4624",
        "type": "delay",
        "z": "b56c7f40.a7397",
        "name": "",
        "pauseType": "delayv",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1740,
        "y": 20,
        "wires": [
            []
        ]
    },
    {
        "id": "15e0ab10.98b705",
        "type": "http request",
        "z": "36119e75.6c6b12",
        "name": "Auth",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.1.87:8085/api/auth",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 630,
        "y": 200,
        "wires": [
            [
                "d92b6314.76f01"
            ]
        ]
    },
    {
        "id": "7652b676.df3ee8",
        "type": "change",
        "z": "36119e75.6c6b12",
        "name": "Payload",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "{\"username\":hoobs_username,\"password\":hoobs_password,\"remember\":false}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 200,
        "wires": [
            [
                "15e0ab10.98b705"
            ]
        ]
    },
    {
        "id": "1f7d2251.f4a99e",
        "type": "inject",
        "z": "36119e75.6c6b12",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 200,
        "wires": [
            [
                "b9e98833.779b38"
            ]
        ]
    },
    {
        "id": "b9e98833.779b38",
        "type": "credentials",
        "z": "36119e75.6c6b12",
        "name": "",
        "props": [
            {
                "value": "hoobs_username",
                "type": "msg"
            },
            {
                "value": "hoobs_password",
                "type": "msg"
            }
        ],
        "x": 310,
        "y": 200,
        "wires": [
            [
                "7652b676.df3ee8"
            ]
        ]
    },
    {
        "id": "565be199.de46e",
        "type": "http request",
        "z": "36119e75.6c6b12",
        "name": "Accessories",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "http://192.168.1.87:8085/api/accessories",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 1110,
        "y": 200,
        "wires": [
            [
                "548fe46c.83068c"
            ]
        ]
    },
    {
        "id": "d92b6314.76f01",
        "type": "json",
        "z": "36119e75.6c6b12",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 770,
        "y": 200,
        "wires": [
            [
                "a0092866.977688"
            ]
        ]
    },
    {
        "id": "a0092866.977688",
        "type": "change",
        "z": "36119e75.6c6b12",
        "name": "Headers",
        "rules": [
            {
                "t": "set",
                "p": "headers",
                "pt": "msg",
                "to": "{\"Authorization\": payload.token}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 200,
        "wires": [
            [
                "565be199.de46e"
            ]
        ]
    },
    {
        "id": "548fe46c.83068c",
        "type": "json",
        "z": "36119e75.6c6b12",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 1270,
        "y": 200,
        "wires": [
            [
                "1a7a8fa5.8405d"
            ]
        ]
    },
    {
        "id": "74eb1f02.9adda",
        "type": "link out",
        "z": "36119e75.6c6b12",
        "name": "A1",
        "links": [
            "1eadafc8.87c3f"
        ],
        "x": 1570,
        "y": 200,
        "wires": [],
        "l": true
    },
    {
        "id": "1eadafc8.87c3f",
        "type": "link in",
        "z": "36119e75.6c6b12",
        "name": "A2",
        "links": [
            "74eb1f02.9adda",
            "865d632d.5ad5f"
        ],
        "x": 150,
        "y": 280,
        "wires": [
            [
                "76559b81.f4c734"
            ]
        ],
        "l": true
    },
    {
        "id": "1a7a8fa5.8405d",
        "type": "change",
        "z": "36119e75.6c6b12",
        "name": "Rooms",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.rooms",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1420,
        "y": 200,
        "wires": [
            [
                "74eb1f02.9adda"
            ]
        ]
    },
    {
        "id": "76559b81.f4c734",
        "type": "split",
        "z": "36119e75.6c6b12",
        "name": "Rooms",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 300,
        "y": 280,
        "wires": [
            [
                "89f94aa9.5659d8"
            ]
        ]
    },
    {
        "id": "89f94aa9.5659d8",
        "type": "change",
        "z": "36119e75.6c6b12",
        "name": "Accessories",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.accessories",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 490,
        "y": 280,
        "wires": [
            [
                "865d632d.5ad5f"
            ]
        ]
    },
    {
        "id": "865d632d.5ad5f",
        "type": "link out",
        "z": "36119e75.6c6b12",
        "name": "B1",
        "links": [
            "1eadafc8.87c3f",
            "db306964.c795e8"
        ],
        "x": 650,
        "y": 280,
        "wires": [],
        "l": true
    },
    {
        "id": "db306964.c795e8",
        "type": "link in",
        "z": "36119e75.6c6b12",
        "name": "B2",
        "links": [
            "865d632d.5ad5f"
        ],
        "x": 150,
        "y": 540,
        "wires": [
            [
                "a94983ae.feead"
            ]
        ],
        "l": true
    },
    {
        "id": "a94983ae.feead",
        "type": "split",
        "z": "36119e75.6c6b12",
        "name": "Accessories",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 310,
        "y": 540,
        "wires": [
            [
                "7edcc26c.fb1d8c"
            ]
        ]
    },
    {
        "id": "7edcc26c.fb1d8c",
        "type": "switch",
        "z": "36119e75.6c6b12",
        "name": "",
        "property": "payload.type_name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Occupancy Sensor",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Smoke Sensor",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "Carbon Monoxide Sensor",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 470,
        "y": 540,
        "wires": [
            [
                "c0782393.6e3e3"
            ],
            [],
            []
        ]
    },
    {
        "id": "5b0698df.70b1d8",
        "type": "debug",
        "z": "36119e75.6c6b12",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1150,
        "y": 520,
        "wires": []
    },
    {
        "id": "c0782393.6e3e3",
        "type": "change",
        "z": "36119e75.6c6b12",
        "name": "entity_id",
        "rules": [
            {
                "t": "set",
                "p": "entity_id",
                "pt": "msg",
                "to": "\"input_boolean.hoobs_\" & $replace($replace($replace($lowercase(payload.service_name),\" \", \"_\"),\"-\",\"_\"),\"___\",\"_\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 520,
        "wires": [
            [
                "419e1d03.807f34"
            ]
        ]
    },
    {
        "id": "c7d0c25b.0d63e",
        "type": "api-call-service",
        "z": "36119e75.6c6b12",
        "name": "On",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_on",
        "entityId": "{{entity_id}}",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 930,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "419e1d03.807f34",
        "type": "switch",
        "z": "36119e75.6c6b12",
        "name": "",
        "property": "payload.values.occupancy_detected",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "1",
                "vt": "num"
            },
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 790,
        "y": 520,
        "wires": [
            [
                "c7d0c25b.0d63e"
            ],
            [
                "ea0b3a0b.61ad18"
            ]
        ]
    },
    {
        "id": "ea0b3a0b.61ad18",
        "type": "api-call-service",
        "z": "36119e75.6c6b12",
        "name": "Off",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_boolean",
        "service": "turn_off",
        "entityId": "{{entity_id}}",
        "data": "",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 930,
        "y": 540,
        "wires": [
            [
                "5b0698df.70b1d8"
            ]
        ]
    },
    {
        "id": "355562cb.e89fde",
        "type": "ui_button",
        "z": "36119e75.6c6b12",
        "name": "",
        "group": "8a0782a1.61a5b",
        "order": 0,
        "width": 0,
        "height": 0,
        "passthru": false,
        "label": "button",
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "icon": "",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "x": 360,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "75f28b51.11d2f4",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "30m",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "1800",
        "crontab": "",
        "once": false,
        "onceDelay": "10",
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 90,
        "y": 1380,
        "wires": [
            [
                "b2e23214.3e05f"
            ]
        ]
    },
    {
        "id": "cee890ea.c8234",
        "type": "comment",
        "z": "cee05142.c172e8",
        "name": "Supervisor API Log check",
        "info": "",
        "x": 130,
        "y": 1320,
        "wires": []
    },
    {
        "id": "b2e23214.3e05f",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Core",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "core",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "lastmessage",
                "pt": "flow",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 1360,
        "wires": [
            [
                "d34f23a.4e17de",
                "9f353c9a.c1efd"
            ]
        ]
    },
    {
        "id": "8f190dcf.8d90c",
        "type": "http request",
        "z": "cee05142.c172e8",
        "name": "Logs",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 850,
        "y": 1380,
        "wires": [
            [
                "78c94c43.9d0064"
            ]
        ]
    },
    {
        "id": "f91b8b58.f6cb08",
        "type": "split",
        "z": "cee05142.c172e8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 1170,
        "y": 1380,
        "wires": [
            [
                "c65d78c9.96b988"
            ]
        ]
    },
    {
        "id": "db7c815b.20fd6",
        "type": "link in",
        "z": "cee05142.c172e8",
        "name": "A2",
        "links": [
            "c0f564d1.de88b8"
        ],
        "x": 90,
        "y": 1520,
        "wires": [
            [
                "823f0541.2dfd78",
                "a3e5e31a.3844"
            ]
        ],
        "l": true
    },
    {
        "id": "823f0541.2dfd78",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": "Core ?",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "core",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "supervisor",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 230,
        "y": 1560,
        "wires": [
            [
                "93cabed2.e54aa"
            ],
            [
                "2d654160.60bd9e"
            ]
        ]
    },
    {
        "id": "78c94c43.9d0064",
        "type": "api-current-state",
        "z": "cee05142.c172e8",
        "name": "Current date",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 1,
        "halt_if": "",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "input_datetime.{{topic}}_log",
        "state_type": "str",
        "state_location": "flow.current",
        "override_payload": "msg",
        "entity_location": "",
        "override_data": "none",
        "blockInputOverrides": false,
        "x": 1010,
        "y": 1380,
        "wires": [
            [
                "f91b8b58.f6cb08"
            ]
        ]
    },
    {
        "id": "93cabed2.e54aa",
        "type": "function",
        "z": "cee05142.c172e8",
        "name": "Core",
        "func": "msg.flow.process = true\nif (msg.payload.includes('Update of calendar.bookings') \n  || msg.payload.includes('Update of camera.front_door is taking over 10 seconds')\n  || msg.payload.includes('E0010M - Device is not available')\n  || msg.payload.includes('[homeassistant.loader] You are using a custom integration')\n  || msg.payload.includes('Connection to geniushub failed')\n  || msg.payload.includes('[aiohttp.server] Error handling request')\n  || msg.payload.includes('[homeassistant] Error doing job: Task exception was never retrieved')\n  || msg.payload.includes('Unable to connect to Dark Sky')\n  || msg.payload.includes('[Repository is archived')\n  || msg.payload.includes('GitHub returned 404 for https://api.github.com')\n  || msg.payload.includes('/ingress/validate_session return code 401')\n  || msg.payload.includes('[homeassistant.components.ovo_energy] Timeout fetching sensor data')\n  || msg.payload.includes('Timeout on /homeassistant/restart request')\n  || msg.payload.includes('homeassistant.components.ovo_energy'))\n  msg.flow.process = false\n\nif (msg.flow.process)\n    return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 1540,
        "wires": [
            [
                "f4a988aa.6f2708"
            ]
        ]
    },
    {
        "id": "21ccb396.7c9c8c",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set Data",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \" Error \" & topic & \" : \" & payload}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1200,
        "y": 1560,
        "wires": [
            [
                "c789542a.5de338"
            ]
        ]
    },
    {
        "id": "d34f23a.4e17de",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Setup",
        "rules": [
            {
                "t": "set",
                "p": "headers[\"Authorization\"]",
                "pt": "msg",
                "to": "\"Bearer \" & $env('SUPERVISOR_TOKEN')",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"http://supervisor/\" & topic & \"/logs\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 1380,
        "wires": [
            [
                "8f190dcf.8d90c"
            ]
        ]
    },
    {
        "id": "8f96e366.602af",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Supervisor",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "supervisor",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 550,
        "y": 1400,
        "wires": [
            [
                "d34f23a.4e17de"
            ]
        ]
    },
    {
        "id": "2d654160.60bd9e",
        "type": "function",
        "z": "cee05142.c172e8",
        "name": "Supervisor",
        "func": "msg.flow.process = true\n\nif (msg.payload.includes('http://172.30.33.10:8099') \n  || msg.payload.includes('Ingress error: 400, message=')\n  || msg.payload.includes('Task exception was never retrieved'))\n  msg.flow.process = false\n\nif (msg.payload.includes('Watchdog found a problem with'))\n  msg.flow.type = 'E'\n\nif (msg.flow.process)\n    return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1580,
        "wires": [
            [
                "b6c1f6d4.5c39f8"
            ]
        ]
    },
    {
        "id": "c65d78c9.96b988",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$substring(payload,5)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$substring(payload,0,$length(payload)-4)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "topic = \"supervisor\" ? \"20\" & payload : payload",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "flow.letter",
                "pt": "msg",
                "to": "$substring(payload,20,1)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "flow.datetime",
                "pt": "msg",
                "to": "$substring(payload,0,19)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "flow.type",
                "pt": "msg",
                "to": "IGNORE",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.type",
                "pt": "msg",
                "to": "$trim(flow.letter = \"E\" ? $substring(payload,19,7) : flow.type)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "flow.type",
                "pt": "msg",
                "to": "$trim(flow.letter = \"W\" ? $substring(payload,19,9) : flow.type)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1340,
        "y": 1380,
        "wires": [
            [
                "6e67f70b.510e68"
            ]
        ]
    },
    {
        "id": "6e67f70b.510e68",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": "Error & New",
        "property": "$uppercase(flow.type)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "flow.datetime <= flow.current",
                "vt": "jsonata"
            },
            {
                "t": "eq",
                "v": "ERROR",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "WARNING",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 3,
        "x": 1530,
        "y": 1380,
        "wires": [
            [],
            [
                "c0f564d1.de88b8"
            ],
            [
                "c0f564d1.de88b8"
            ]
        ]
    },
    {
        "id": "c0f564d1.de88b8",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "A1",
        "links": [
            "db7c815b.20fd6"
        ],
        "x": 1690,
        "y": 1380,
        "wires": [],
        "l": true
    },
    {
        "id": "a3e5e31a.3844",
        "type": "delay",
        "z": "cee05142.c172e8",
        "name": "Last datetime",
        "pauseType": "queue",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "x": 260,
        "y": 1480,
        "wires": [
            [
                "3b342138.4d756e"
            ]
        ]
    },
    {
        "id": "315c69f.19f8796",
        "type": "api-call-service",
        "z": "cee05142.c172e8",
        "name": "Set datetime",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_datetime",
        "service": "set_datetime",
        "entityId": "input_datetime.{{topic}}_log",
        "data": "{\"datetime\": flow.datetime}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 590,
        "y": 1480,
        "wires": [
            []
        ]
    },
    {
        "id": "3b342138.4d756e",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": "Core ?",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "core",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "supervisor",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 430,
        "y": 1480,
        "wires": [
            [
                "315c69f.19f8796"
            ],
            [
                "315c69f.19f8796"
            ]
        ]
    },
    {
        "id": "f4a988aa.6f2708",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": "Errors",
        "property": "$uppercase(flow.type)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "eq",
                "v": "ERROR",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 570,
        "y": 1540,
        "wires": [
            [
                "b6c1f6d4.5c39f8"
            ]
        ]
    },
    {
        "id": "ad58572d.836768",
        "type": "ha-get-entities",
        "z": "cee05142.c172e8",
        "server": "86fae200.61af7",
        "name": "Unavailable",
        "rules": [
            {
                "property": "state",
                "logic": "is",
                "value": "unavailable",
                "valueType": "str"
            }
        ],
        "output_type": "array",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 290,
        "y": 1180,
        "wires": [
            [
                "f24c368.ee047c8"
            ]
        ]
    },
    {
        "id": "9de416f5.afb5d8",
        "type": "debug",
        "z": "cee05142.c172e8",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 870,
        "y": 1220,
        "wires": []
    },
    {
        "id": "f24c368.ee047c8",
        "type": "split",
        "z": "cee05142.c172e8",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "x": 450,
        "y": 1180,
        "wires": [
            [
                "3af973e8.444e8c"
            ]
        ]
    },
    {
        "id": "83b147b7.823b78",
        "type": "join",
        "z": "cee05142.c172e8",
        "name": "",
        "mode": "custom",
        "build": "array",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "accumulate": false,
        "timeout": "2",
        "count": "",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "num",
        "reduceFixup": "",
        "x": 730,
        "y": 1180,
        "wires": [
            [
                "9de416f5.afb5d8",
                "46634049.1176a"
            ]
        ]
    },
    {
        "id": "3af973e8.444e8c",
        "type": "function",
        "z": "cee05142.c172e8",
        "name": "Core",
        "func": "msg.flow = {}\nmsg.topic = \"unavailable\"\nmsg.flow.process = true\nif (msg.payload.entity_id.includes('light.bedroom_1_bulb') \n  || msg.payload.entity_id.includes('light.bedroom_2_bulb')\n  || msg.payload.entity_id.includes('light.office_light')\n  || msg.payload.entity_id.includes('light.ceiling_light'))\n  msg.flow.process = false\n\nif (msg.flow.process)\n    return msg;\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 590,
        "y": 1180,
        "wires": [
            [
                "83b147b7.823b78"
            ]
        ]
    },
    {
        "id": "f3d9509c.c95e8",
        "type": "comment",
        "z": "cee05142.c172e8",
        "name": "Entities in wrong state",
        "info": "",
        "x": 140,
        "y": 1080,
        "wires": []
    },
    {
        "id": "7f25bb39.b27b84",
        "type": "comment",
        "z": "cee05142.c172e8",
        "name": "Garbage collector",
        "info": "",
        "x": 130,
        "y": 960,
        "wires": []
    },
    {
        "id": "46634049.1176a",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Message",
        "rules": [
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            },
            {
                "t": "set",
                "p": "payload.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \"Unavailable entities\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 1180,
        "wires": [
            [
                "b7caba5e.abd198"
            ]
        ]
    },
    {
        "id": "f6014242.7c685",
        "type": "comment",
        "z": "cee05142.c172e8",
        "name": "Component down",
        "info": "",
        "x": 110,
        "y": 80,
        "wires": []
    },
    {
        "id": "97511fd5.fe0d7",
        "type": "comment",
        "z": "cee05142.c172e8",
        "name": "Lights on no movement",
        "info": "",
        "x": 140,
        "y": 580,
        "wires": []
    },
    {
        "id": "b6c1f6d4.5c39f8",
        "type": "delay",
        "z": "cee05142.c172e8",
        "name": "1/sec",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 710,
        "y": 1560,
        "wires": [
            [
                "4be20f2a.1fa21"
            ]
        ]
    },
    {
        "id": "9f353c9a.c1efd",
        "type": "delay",
        "z": "cee05142.c172e8",
        "name": "",
        "pauseType": "delay",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 380,
        "y": 1400,
        "wires": [
            [
                "8f96e366.602af"
            ]
        ]
    },
    {
        "id": "4be20f2a.1fa21",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": "Different",
        "property": "$substring(payload,20)",
        "propertyType": "jsonata",
        "rules": [
            {
                "t": "neq",
                "v": "lastmessage",
                "vt": "flow"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 860,
        "y": 1560,
        "wires": [
            [
                "bcac5013.28139"
            ]
        ]
    },
    {
        "id": "bcac5013.28139",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "lastmessage",
        "rules": [
            {
                "t": "set",
                "p": "lastmessage",
                "pt": "flow",
                "to": "$substring(payload,20)",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 1560,
        "wires": [
            [
                "21ccb396.7c9c8c"
            ]
        ]
    },
    {
        "id": "4c776464.a02afc",
        "type": "ping",
        "z": "cee05142.c172e8",
        "mode": "timed",
        "name": "Texecom",
        "host": "192.168.1.208",
        "timer": "20",
        "inputs": 0,
        "x": 140,
        "y": 340,
        "wires": [
            [
                "6bffcf3e.4a5c"
            ]
        ]
    },
    {
        "id": "6bffcf3e.4a5c",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "texecom",
        "rules": [
            {
                "t": "set",
                "p": "flow.response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "flow.component",
                "pt": "msg",
                "to": "texecom",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.pretty_component",
                "pt": "msg",
                "to": "Texecom",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.input_entity",
                "pt": "msg",
                "to": "input_boolean.texecom",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "90000",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 300,
        "y": 340,
        "wires": [
            [
                "b25d9ba4.f99428"
            ]
        ]
    },
    {
        "id": "15a8f71c.912bf9",
        "type": "ping",
        "z": "cee05142.c172e8",
        "d": true,
        "mode": "timed",
        "name": "",
        "host": "192.168.1.253",
        "timer": "20",
        "inputs": 0,
        "x": 130,
        "y": 440,
        "wires": [
            [
                "b1d637aa.24b7a8"
            ]
        ]
    },
    {
        "id": "b1d637aa.24b7a8",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "test",
        "rules": [
            {
                "t": "set",
                "p": "flow.response",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "flow.component",
                "pt": "msg",
                "to": "test",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.pretty_component",
                "pt": "msg",
                "to": "Test",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "flow.input_entity",
                "pt": "msg",
                "to": "input_boolean.test",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "delay",
                "pt": "msg",
                "to": "5000",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 290,
        "y": 440,
        "wires": [
            [
                "b25d9ba4.f99428"
            ]
        ]
    },
    {
        "id": "e08160a8.2d31f",
        "type": "switch",
        "z": "e6937ad1.654d78",
        "name": "First ping?",
        "property": "flow.re_ping",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "False",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 390,
        "y": 140,
        "wires": [
            [
                "f6823855.c67f18"
            ],
            []
        ]
    },
    {
        "id": "7411b773.1a2ba8",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Get re-ping",
        "rules": [
            {
                "t": "set",
                "p": "flow.re_ping",
                "pt": "msg",
                "to": "$lookup($globalContext(\"ping.re_ping\"),flow.component)",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "flow.re_ping",
                "pt": "msg",
                "to": "$exists(flow.re_ping)  ? flow.re_ping : \"False\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 230,
        "y": 140,
        "wires": [
            [
                "e08160a8.2d31f"
            ]
        ]
    },
    {
        "id": "e6c7624f.2a70b",
        "type": "inject",
        "z": "c8979269.83b0b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 510,
        "y": 1280,
        "wires": [
            [
                "2b24df34.05f78"
            ]
        ]
    },
    {
        "id": "2b24df34.05f78",
        "type": "change",
        "z": "c8979269.83b0b",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ping.blah",
                "pt": "global",
                "to": "true",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "e1ff2adc.d49ef8",
        "type": "link in",
        "z": "e6937ad1.654d78",
        "name": "A2",
        "links": [
            "24a089a6.5a7b36",
            "af0eb4ad.ef1348"
        ],
        "x": 90,
        "y": 320,
        "wires": [
            [
                "c952a3d3.d4597"
            ]
        ],
        "l": true
    },
    {
        "id": "24a089a6.5a7b36",
        "type": "link out",
        "z": "e6937ad1.654d78",
        "name": "A1",
        "links": [
            "e1ff2adc.d49ef8"
        ],
        "x": 870,
        "y": 180,
        "wires": [],
        "l": true
    },
    {
        "id": "af0eb4ad.ef1348",
        "type": "link out",
        "z": "e6937ad1.654d78",
        "name": "A3",
        "links": [
            "e1ff2adc.d49ef8"
        ],
        "x": 1930,
        "y": 220,
        "wires": [],
        "l": true
    },
    {
        "id": "fc31a487.cd9c28",
        "type": "inject",
        "z": "e6937ad1.654d78",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 230,
        "y": 460,
        "wires": [
            [
                "7fe196ee.e51f68"
            ]
        ]
    },
    {
        "id": "7fe196ee.e51f68",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "ping",
                "pt": "global"
            },
            {
                "t": "set",
                "p": "ping.setup",
                "pt": "global",
                "to": "Blank",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "8860ac00.48b4a8",
        "type": "comment",
        "z": "cee05142.c172e8",
        "name": "Battery Level",
        "info": "",
        "x": 90,
        "y": 1680,
        "wires": []
    },
    {
        "id": "881988dd.b02088",
        "type": "inject",
        "z": "cee05142.c172e8",
        "name": "6 hr",
        "props": [],
        "repeat": "21600",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 110,
        "y": 1740,
        "wires": [
            [
                "98d61962.2fe188"
            ]
        ]
    },
    {
        "id": "98d61962.2fe188",
        "type": "ha-get-entities",
        "z": "cee05142.c172e8",
        "server": "86fae200.61af7",
        "name": "Batteries",
        "rules": [
            {
                "property": "attributes.device_class",
                "logic": "is",
                "value": "battery",
                "valueType": "str"
            },
            {
                "property": "state",
                "logic": "lt",
                "value": "25",
                "valueType": "num"
            }
        ],
        "output_type": "count",
        "output_empty_results": false,
        "output_location_type": "msg",
        "output_location": "payload",
        "output_results_count": 1,
        "x": 260,
        "y": 1740,
        "wires": [
            [
                "db42e940.e5add8"
            ]
        ]
    },
    {
        "id": "db42e940.e5add8",
        "type": "switch",
        "z": "cee05142.c172e8",
        "name": ">0",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 410,
        "y": 1740,
        "wires": [
            [
                "cf487f7b.bf727"
            ],
            []
        ]
    },
    {
        "id": "cf487f7b.bf727",
        "type": "change",
        "z": "cee05142.c172e8",
        "name": "Set Data",
        "rules": [
            {
                "t": "set",
                "p": "flow.message",
                "pt": "msg",
                "to": "{\"title\":\"Home Assistant\",\"message\": \" Error - \" & payload & \" batteries low\"}",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 560,
        "y": 1740,
        "wires": [
            [
                "c64ea2fa.6d938"
            ]
        ]
    },
    {
        "id": "9619c8b3.281798",
        "type": "api-call-service",
        "z": "9573fbce.d39958",
        "name": "Send to iOS",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "notify",
        "service": "all_ios_devices",
        "entityId": "",
        "data": "flow.message",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 590,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "727a4597.478ffc",
        "type": "time-range-switch",
        "z": "9573fbce.d39958",
        "name": "Day",
        "lat": "",
        "lon": "",
        "startTime": "07:00",
        "endTime": "23:00",
        "startOffset": 0,
        "endOffset": 0,
        "x": 330,
        "y": 440,
        "wires": [
            [
                "9619c8b3.281798"
            ],
            []
        ]
    },
    {
        "id": "c3fad48e.f49f18",
        "type": "link in",
        "z": "9573fbce.d39958",
        "name": "Send to iOS",
        "links": [
            "b7caba5e.abd198",
            "c789542a.5de338",
            "c64ea2fa.6d938",
            "25faa32c.12443c",
            "862c5056.f10d6",
            "fb1e7301.19764",
            "54179814.f57248",
            "a4ac79e6.1bbc98"
        ],
        "x": 170,
        "y": 440,
        "wires": [
            [
                "727a4597.478ffc"
            ]
        ],
        "l": true
    },
    {
        "id": "b7caba5e.abd198",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 1050,
        "y": 1120,
        "wires": [],
        "l": true
    },
    {
        "id": "c789542a.5de338",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 1370,
        "y": 1560,
        "wires": [],
        "l": true
    },
    {
        "id": "c64ea2fa.6d938",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 730,
        "y": 1740,
        "wires": [],
        "l": true
    },
    {
        "id": "25faa32c.12443c",
        "type": "link out",
        "z": "cee05142.c172e8",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 1170,
        "y": 280,
        "wires": [],
        "l": true
    },
    {
        "id": "862c5056.f10d6",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 810,
        "y": 780,
        "wires": [],
        "l": true
    },
    {
        "id": "fb1e7301.19764",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 1250,
        "y": 1940,
        "wires": [],
        "l": true
    },
    {
        "id": "54179814.f57248",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 1170,
        "y": 2320,
        "wires": [],
        "l": true
    },
    {
        "id": "a4ac79e6.1bbc98",
        "type": "link out",
        "z": "a2c447a7.7afa68",
        "name": "Notify iOS",
        "links": [
            "c3fad48e.f49f18"
        ],
        "x": 590,
        "y": 2800,
        "wires": [],
        "l": true
    },
    {
        "id": "f79f0933.ef1838",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "flow.pretty_component",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"ping failure - Time: \" & flow.downtime ",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Component",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 80,
        "wires": [
            [
                "fdfac8f6.6fb588"
            ]
        ]
    },
    {
        "id": "69f23db3.8eb074",
        "type": "link in",
        "z": "9573fbce.d39958",
        "name": "Debug Log",
        "links": [
            "254dfaa.e9f2406"
        ],
        "x": 160,
        "y": 160,
        "wires": [
            [
                "55f57a12.c366e4"
            ]
        ],
        "l": true
    },
    {
        "id": "55f57a12.c366e4",
        "type": "change",
        "z": "9573fbce.d39958",
        "name": "debug",
        "rules": [
            {
                "t": "set",
                "p": "log.level",
                "pt": "msg",
                "to": "debug",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 330,
        "y": 160,
        "wires": [
            [
                "1300cb6d.fa0705"
            ]
        ]
    },
    {
        "id": "62832c9c.855214",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "flow.pretty_component",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"re-ping down - Time: \" & flow.downtime ",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Component",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1950,
        "y": 120,
        "wires": [
            [
                "65ae682d.6f6678"
            ]
        ]
    },
    {
        "id": "254dfaa.e9f2406",
        "type": "link out",
        "z": "cee05142.c172e8",
        "d": true,
        "name": "Re-ping error",
        "links": [
            "69f23db3.8eb074"
        ],
        "x": 630,
        "y": 420,
        "wires": [],
        "l": true
    },
    {
        "id": "f78a4a2d.3f59b8",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "flow.pretty_component",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"re-ping success - Time: \" & flow.downtime ",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Component",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1950,
        "y": 260,
        "wires": [
            [
                "65ae682d.6f6678"
            ]
        ]
    },
    {
        "id": "fdfac8f6.6fb588",
        "type": "link out",
        "z": "e6937ad1.654d78",
        "name": "B1",
        "links": [
            "22d03c08.128234"
        ],
        "x": 1210,
        "y": 80,
        "wires": [],
        "l": true
    },
    {
        "id": "22d03c08.128234",
        "type": "link in",
        "z": "e6937ad1.654d78",
        "name": "B2",
        "links": [
            "65ae682d.6f6678",
            "fdfac8f6.6fb588"
        ],
        "x": 90,
        "y": 380,
        "wires": [
            []
        ],
        "l": true
    },
    {
        "id": "65ae682d.6f6678",
        "type": "link out",
        "z": "e6937ad1.654d78",
        "name": "B3",
        "links": [
            "22d03c08.128234"
        ],
        "x": 2110,
        "y": 120,
        "wires": [],
        "l": true
    },
    {
        "id": "cfc75438.f68f4",
        "type": "change",
        "z": "83b3d59c.0b8848",
        "name": "Meal Time",
        "rules": [
            {
                "t": "set",
                "p": "item.scene_name",
                "pt": "msg",
                "to": "Meal Time",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 590,
        "y": 440,
        "wires": [
            [
                "47d0f7cb.da5398"
            ]
        ]
    },
    {
        "id": "6eec332.4cf78cc",
        "type": "server-state-changed",
        "z": "83b3d59c.0b8848",
        "name": "Meal Time",
        "server": "86fae200.61af7",
        "version": 1,
        "exposeToHomeAssistant": false,
        "haConfig": [
            {
                "property": "name",
                "value": ""
            },
            {
                "property": "icon",
                "value": ""
            }
        ],
        "entityidfilter": "input_boolean.scene_meal_time",
        "entityidfiltertype": "exact",
        "outputinitially": false,
        "state_type": "str",
        "haltifstate": "on",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "outputs": 2,
        "output_only_on_state_change": true,
        "for": "",
        "forType": "num",
        "forUnits": "minutes",
        "ignorePrevStateNull": false,
        "ignorePrevStateUnknown": false,
        "ignorePrevStateUnavailable": false,
        "ignoreCurrentStateUnknown": false,
        "ignoreCurrentStateUnavailable": false,
        "x": 140,
        "y": 440,
        "wires": [
            [
                "cf27b250.1f623"
            ],
            []
        ]
    },
    {
        "id": "dc15c820.81694",
        "type": "link out",
        "z": "83b3d59c.0b8848",
        "name": "Meal Time",
        "links": [
            "86f713a9.e297d"
        ],
        "x": 575,
        "y": 1060,
        "wires": []
    },
    {
        "id": "1884d66e.975f7a",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "1 hr",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "3600",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 132,
        "y": 858,
        "wires": [
            [
                "55847a61.2386a4"
            ]
        ]
    },
    {
        "id": "880e1e20.d8992",
        "type": "api-call-service",
        "z": "26d43138.aa613e",
        "name": "Set value",
        "server": "86fae200.61af7",
        "version": 1,
        "debugenabled": false,
        "service_domain": "input_number",
        "service": "set_value",
        "entityId": "input_number.addon_updates",
        "data": "{\"value\": flow.count}",
        "dataType": "jsonata",
        "mergecontext": "",
        "output_location": "",
        "output_location_type": "none",
        "mustacheAltTags": false,
        "x": 660,
        "y": 860,
        "wires": [
            []
        ]
    },
    {
        "id": "e2ba8487.8f8dd8",
        "type": "comment",
        "z": "26d43138.aa613e",
        "name": "Addon Updates",
        "info": "",
        "x": 152,
        "y": 818,
        "wires": []
    },
    {
        "id": "b854df3c.3a556",
        "type": "http request",
        "z": "d49e449c.037e18",
        "name": "Logs",
        "method": "GET",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "authType": "",
        "x": 330,
        "y": 80,
        "wires": [
            [
                "9e7fa9ad.c06858"
            ]
        ]
    },
    {
        "id": "2bd2eeae.bf9542",
        "type": "change",
        "z": "d49e449c.037e18",
        "name": "Setup",
        "rules": [
            {
                "t": "set",
                "p": "headers[\"Authorization\"]",
                "pt": "msg",
                "to": "\"Bearer \" & $env('SUPERVISOR_TOKEN')",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "url",
                "pt": "msg",
                "to": "\"http://supervisor/supervisor/info\"",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 80,
        "wires": [
            [
                "b854df3c.3a556"
            ]
        ]
    },
    {
        "id": "9e7fa9ad.c06858",
        "type": "json",
        "z": "d49e449c.037e18",
        "name": "",
        "property": "payload",
        "action": "",
        "pretty": false,
        "x": 470,
        "y": 80,
        "wires": [
            [
                "a737ff94.d8db6"
            ]
        ]
    },
    {
        "id": "a737ff94.d8db6",
        "type": "change",
        "z": "d49e449c.037e18",
        "name": "Setup",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.data.addons",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "headers",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "url",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "statusCode",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "responseUrl",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "redirectList",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "55847a61.2386a4",
        "type": "subflow:d49e449c.037e18",
        "z": "26d43138.aa613e",
        "name": "",
        "env": [],
        "x": 290,
        "y": 860,
        "wires": [
            [
                "b43acc8c.76c1d"
            ]
        ]
    },
    {
        "id": "3362e282.f1ba6e",
        "type": "subflow:d49e449c.037e18",
        "z": "26d43138.aa613e",
        "name": "",
        "env": [],
        "x": 290,
        "y": 400,
        "wires": [
            [
                "fbe782a9.870dd"
            ]
        ]
    },
    {
        "id": "6e783329.1376ac",
        "type": "api-current-state",
        "z": "a2c447a7.7afa68",
        "name": "Not Booked",
        "server": "86fae200.61af7",
        "version": 1,
        "outputs": 2,
        "halt_if": "off",
        "halt_if_type": "str",
        "halt_if_compare": "is",
        "override_topic": false,
        "entity_id": "calendar.bookings",
        "state_type": "str",
        "state_location": "",
        "override_payload": "none",
        "entity_location": "data",
        "override_data": "msg",
        "blockInputOverrides": false,
        "x": 610,
        "y": 1580,
        "wires": [
            [
                "481026c6.d161f8"
            ],
            []
        ]
    },
    {
        "id": "13439cbc.41f423",
        "type": "switch",
        "z": "a2c447a7.7afa68",
        "name": "Drop some",
        "property": "payload.entity_id",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "input_boolean.tyrcelyn_utility_motion",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1390,
        "y": 2920,
        "wires": [
            [],
            [
                "4258f7cf.ae2b48"
            ]
        ]
    },
    {
        "id": "f6823855.c67f18",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Set endtime",
        "rules": [
            {
                "t": "set",
                "p": "flow.delay",
                "pt": "msg",
                "to": "msg.delay ? msg.delay : 20000",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "flow.endtime",
                "pt": "msg",
                "to": "$millis() + flow.delay",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 570,
        "y": 140,
        "wires": [
            [
                "c26a763b.362d58"
            ]
        ]
    },
    {
        "id": "63d7f326.15803c",
        "type": "debug",
        "z": "e6937ad1.654d78",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1120,
        "y": 260,
        "wires": []
    },
    {
        "id": "b2e0e226.46829",
        "type": "delay",
        "z": "e6937ad1.654d78",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "x": 1180,
        "y": 140,
        "wires": [
            [
                "bf364681.1fb8b8"
            ]
        ]
    },
    {
        "id": "b210a724.abd928",
        "type": "switch",
        "z": "e6937ad1.654d78",
        "name": "End?",
        "property": "flow.endtime",
        "propertyType": "msg",
        "rules": [
            {
                "t": "jsonata_exp",
                "v": "flow.endtime > $millis()",
                "vt": "jsonata"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1790,
        "y": 120,
        "wires": [
            [
                "6502a4bc.7bcfbc",
                "53815182.7d2b3"
            ],
            [
                "62832c9c.855214"
            ]
        ]
    },
    {
        "id": "6502a4bc.7bcfbc",
        "type": "link out",
        "z": "e6937ad1.654d78",
        "name": "C1",
        "links": [
            "a8b1ada6.d71"
        ],
        "x": 1930,
        "y": 40,
        "wires": [],
        "l": true
    },
    {
        "id": "53815182.7d2b3",
        "type": "change",
        "z": "e6937ad1.654d78",
        "name": "Set log item",
        "rules": [
            {
                "t": "set",
                "p": "log.item",
                "pt": "msg",
                "to": "flow.pretty_component",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "log.action",
                "pt": "msg",
                "to": "\"re-ping failure - Time: \" & flow.downtime ",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "log.type",
                "pt": "msg",
                "to": "Component",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1950,
        "y": 80,
        "wires": [
            [
                "65ae682d.6f6678"
            ]
        ]
    },
    {
        "id": "a8b1ada6.d71",
        "type": "link in",
        "z": "e6937ad1.654d78",
        "name": "C2",
        "links": [
            "6502a4bc.7bcfbc"
        ],
        "x": 870,
        "y": 220,
        "wires": [
            [
                "a589119e.02b81"
            ]
        ],
        "l": true
    },
    {
        "id": "b43acc8c.76c1d",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Count updated",
        "rules": [
            {
                "t": "set",
                "p": "flow.count",
                "pt": "msg",
                "to": "$count($filter(payload, function($v, $i){$v.update_available\t}))",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 480,
        "y": 860,
        "wires": [
            [
                "880e1e20.d8992"
            ]
        ]
    },
    {
        "id": "a11defc6.0f2c9",
        "type": "debug",
        "z": "26d43138.aa613e",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1230,
        "y": 440,
        "wires": []
    },
    {
        "id": "4caff2b7.22f23c",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Remove None",
        "rules": [
            {
                "t": "set",
                "p": "addons",
                "pt": "msg",
                "to": "$filter(addons, function($v, $i){$v\t})",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1060,
        "y": 400,
        "wires": [
            [
                "678646a6.2a9188",
                "a11defc6.0f2c9"
            ]
        ]
    },
    {
        "id": "740474d6.f4e1ec",
        "type": "inject",
        "z": "26d43138.aa613e",
        "name": "Sun",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "00 03 * * 0",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 130,
        "y": 200,
        "wires": [
            [
                "18206436.8e369c"
            ]
        ]
    },
    {
        "id": "18206436.8e369c",
        "type": "change",
        "z": "26d43138.aa613e",
        "name": "Setup",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "'Hassio Sunday (' & $now('[Y01].[M01].[D01] [H01]:[m01]:[s01]') &')'",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "data",
                "pt": "msg",
                "to": "{    \"name\": topic & \" Folders\",    \"folders\":[        \"ssl\",        \"share\",        \"homeassistant\",        \"addons/local\"    ] }",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 270,
        "y": 200,
        "wires": [
            [
                "8ea97b7b.fa0268",
                "4f482db9.e3fea4"
            ]
        ]
    }
]